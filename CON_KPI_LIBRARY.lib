Program.Sub.Preflight.Start
V.GLOBAL.SREFRESH.DECLARE(String)
V.GLOBAL.SREFRESHDATE.DECLARE(String)
V.GLOBAL.SREFRESHMTH.DECLARE(String)
V.GLOBAL.SREFRESHYR.DECLARE(String)
V.GLOBAL.SALLDATA.DECLARE(String)
V.GLOBAL.SDATESTART.DECLARE(String)
V.GLOBAL.SDATEEND.DECLARE(String)
V.GLOBAL.SADDON.DECLARE(String)
V.GLOBAL.SALLDATEE.DECLARE(String)
V.GLOBAL.SALLDATES.DECLARE(String)
V.GLOBAL.LREFRESHMTH.DECLARE(Long)
V.GLOBAL.LREFRESHYR.DECLARE(Long)
V.Global.dRefreshDate.declare(Date)
V.GLOBAL.lCurrYear.Declare(Long)
V.GLOBAL.lCurrYear.Set(0)
V.GLOBAL.lPrevYear.Declare(Long)
V.GLOBAL.lPrevYear.Set(0)
V.global.lMonth.Declare(Long)
V.GLOBAL.SFILEPATH.DECLARE(String)
V.Global.sErr.Declare(string)


V.Local.sTimeFileLog.Declare(string)
V.Local.sDateFilelog.Declare(string)
F.Intrinsic.String.TimeString(V.Ambient.Now,V.local.stimefilelog)
F.intrinsic.string.format(v.ambient.date,"YYYYMMDD",v.local.sdatefilelog)
F.Intrinsic.String.Build("{0}\gss\KPI_Library_Log_{1}_{2}.debug",V.System.Temp, V.Local.sDateFilelog, V.Local.sTimeFileLog,V.global.sFilePath)

V.Local.bLicensed.Declare(Boolean)
f.Global.General.IsLicensedByModuleName("KPI",v.Local.bLicensed)
F.Intrinsic.Control.If(V.Local.bLicensed,=,False)
	F.Intrinsic.UI.Msgbox("Not Licensed for KPI")
	F.intrinsic.CONTROL.end
F.Intrinsic.Control.EndIf

F.Intrinsic.String.Build("{0} -- CON_KPI_LIBRARY.Lib Logging Started", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.String2File(V.Global.SFILEPATH, V.Global.sErr)

Program.Sub.Preflight.End

Program.Sub.Routine.Start
V.Local.ssql.Declare(String)
V.LOCAL.FOVERHEAD.DECLARE(Float)

F.Intrinsic.Control.If(V.Global.sRefresh,=,"1")
	F.Intrinsic.String.Concat("DELETE CON_KPI_SALES WHERE ORDERDATE>='",V.Global.sRefreshDate,"'",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_SALES (SALES,GM_PERCENT,ORDER_NO,PRODUCT_LINE,ORDER_LINE,QTY,OPENHIST,CUSTOMER,ORDERDATE,OO_DUE_DATE,COST, MONTH, YEAR,MONTH_INT ) SELECT (QTY_BO*PRICE_DISC_ORD),MARGIN,ORDER_NO,PRODUCT_LINE,RECORD_NO,QTY_BO,'OPEN' AS OPENHIST,CUSTOMER,DATE_ORDER,DATE_ITEM_PROM,COST,LEFT(MONTHNAME(DATE_ITEM_PROM),'3'),YEAR(DATE_ITEM_PROM),MONTH(DATE_ITEM_PROM) FROM V_ORDER_LINES WHERE LINE_TYPE<>'P' AND DATE_ORDER>='",V.Global.sRefreshDate,"' AND QTY_BO<>0",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat(" INSERT INTO CON_KPI_SALES (SALES,GM_PERCENT,ORDER_NO,PRODUCT_LINE,ORDER_LINE,QTY,OPENHIST,CUSTOMER,ORDERDATE,COST, SALESMAN, MONTH, YEAR,DATE_SHIPPED,DATE_DUE,MONTH_INT) SELECT EXTENSION,MARGIN,ORDER_NO,PRODUCT_LINE,ORDER_LINE,QTY_SHIPPED,'HIST' AS OPENHIST,CUSTOMER,DATE_ORDER,COST, SALESPERSON, LEFT(MONTHNAME(DATE_INVOICE),'3'),YEAR(DATE_INVOICE),DATE_SHIPPED,DATE_DUE,MONTH(DATE_INVOICE) FROM V_ORDER_HIST_LINE WHERE LINE_TYPE<>'P' AND LEFT(ORDER_LINE,1)<>'8' and DATE_ORDER>='",V.Global.sRefreshDate,"'",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET NAME=(SELECT NAME_CUSTOMER FROM V_CUSTOMER_MASTER WHERE CUSTOMER=CON_KPI_SALES.CUSTOMER) WHERE ORDERDATE>='",V.Global.sRefreshDate,"'",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET CATEGORY=(SELECT IF(TOP10=1,'TOP10',IF(RISINGSTAR=1,'RISING STAR',IF(TARGET=1,'TARGET',IF(OTHER=1,'OTHER','')))) FROM CON_KPI_CUSTOMER WHERE CON_KPI_CUSTOMER.CUSTOMER=CON_KPI_SALES.CUSTOMER ) WHERE ORDERDATE>='",V.global.srefreshdate,"'",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET INDUSTRY_CODE=(SELECT IFNULL(CODE_SIC,'') FROM V_CUSTOMER_SALES WHERE CUSTOMER=CON_KPI_SALES.CUSTOMER) WHERE ORDERDATE>='",V.global.srefreshdate,"'",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET REGION=(SELECT IFNULL(COUNTRY,'') from V_ORDER_BILL_TO WHERE ORDER_NO=CON_KPI_SALES.ORDER_NO) WHERE ORDERDATE>='",V.Global.sRefreshDate,"'",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET COST=COST*(QTY) WHERE ORDERDATE>='",V.global.srefreshdate,"'",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET BUDGET=(SELECT ifnull(BUDGET,0) AS BUDGET FROM CON_KPI_CUSTOMER WHERE CUSTOMER=CON_KPI_SALES.CUSTOMER) WHERE ORDERDATE>='",V.global.srefreshdate,"'",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET BUDGET_PERCENT= IF(BUDGET=0,0,IF(BUDGET=0,0,ROUND((SALES/BUDGET)*100,2))) where ORDERDATE>='",V.global.srefreshdate," ' ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET GM_DOLLAR=(SALES-(COST)) WHERE ORDERDATE>='",V.global.srefreshdate,"'","",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)

	F.ODBC.CONNECTION!CON.ExecuteAndReturn("SELECT OH FROM CON_KPI_SETUP",V.LOCAL.FOVERHEAD)
	F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET OH=(GM_DOLLAR*",V.LOCAL.FOVERHEAD,") WHERE ORDERDATE>='",V.global.srefreshdate,"'",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)

	F.Intrinsic.string.Concat("UPDATE CON_KPI_SALES SET EBITDA=(GM_DOLLAR-OH) WHERE ORDERDATE>='",V.global.srefreshdate,"'",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET EBITDA_PERCENT=IF(EBITDA=0,0,IF(SALES=0,0,(EBITDA/SALES)*100)) WHERE ORDERDATE>='",V.global.srefreshdate,"'",V.Local.ssql)
	F.ODBC.connection!con.execute(V.Local.ssql)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET OPEN_ORDERS=(SELECT ifnull(SUM(EXTENSION),0) AS DOLLAR_TOTAL FROM V_ORDER_LINES WHERE ORDER_NO=CON_KPI_SALES.ORDER_NO) WHERE ORDERDATE>='",V.global.srefreshdate,"'",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET OO_LINES=(SELECT ifnull(COUNT(ORDER_NO),0) AS LINE_COUNT FROM V_ORDER_LINES WHERE ORDER_NO=CON_KPI_SALES.ORDER_NO) WHERE ORDERDATE>='",V.global.srefreshdate,"'",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)

F.Intrinsic.Control.Else
	F.Intrinsic.Control.If(V.Global.sAlldata,=,"1")
		F.Intrinsic.String.Concat("DELETE CON_KPI_SALES","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_SALES (SALES,GM_PERCENT,ORDER_NO,PRODUCT_LINE,ORDER_LINE,QTY,OPENHIST,CUSTOMER,ORDERDATE,OO_DUE_DATE,COST, MONTH, YEAR,MONTH_INT ) SELECT (QTY_BO*PRICE_DISC_ORD),MARGIN,ORDER_NO,PRODUCT_LINE,RECORD_NO,QTY_ORDERED,'OPEN' AS OPENHIST,CUSTOMER,DATE_ORDER,DATE_ITEM_PROM,COST,LEFT(MONTHNAME(DATE_ITEM_PROM),'3'),YEAR(DATE_ITEM_PROM),MONTH(DATE_ITEM_PROM) FROM V_ORDER_LINES WHERE LINE_TYPE<>'P' AND QTY_BO<>0","",,V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_SALES (SALES,GM_PERCENT,ORDER_NO,PRODUCT_LINE,ORDER_LINE,QTY,OPENHIST,CUSTOMER,ORDERDATE,COST, SALESMAN, MONTH, YEAR,DATE_SHIPPED,DATE_DUE,MONTH_INT) SELECT EXTENSION,MARGIN,ORDER_NO,PRODUCT_LINE,ORDER_LINE,QTY_SHIPPED,'HIST' AS OPENHIST,CUSTOMER,DATE_ORDER,COST,SALESPERSON,LEFT(MONTHNAME(DATE_INVOICE),'3'),YEAR(DATE_INVOICE),DATE_SHIPPED,DATE_DUE,MONTH(DATE_INVOICE) FROM V_ORDER_HIST_LINE WHERE LINE_TYPE<>'P' AND LEFT(ORDER_LINE,1)<>'8'","",,V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		F.Intrinsic.Control.CallSub(Z_sub_routine)
	F.Intrinsic.Control.Else
		F.Intrinsic.String.Concat("DELETE CON_KPI_SALES","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_SALES (SALES,GM_PERCENT,ORDER_NO,PRODUCT_LINE,ORDER_LINE,QTY,OPENHIST,CUSTOMER,ORDERDATE,OO_DUE_DATE,COST, MONTH, YEAR,MONTH_INT ) SELECT (QTY_BO*PRICE_DISC_ORD),MARGIN,ORDER_NO,PRODUCT_LINE,RECORD_NO,QTY_ORDERED,'OPEN' AS OPENHIST,CUSTOMER,DATE_ORDER,DATE_ITEM_PROM,COST,LEFT(MONTHNAME(DATE_ITEM_PROM),'3'),YEAR(DATE_ITEM_PROM),MONTH(DATE_ITEM_PROM) FROM V_ORDER_LINES WHERE LINE_TYPE<>'P' AND QTY_BO<>0 AND DATE_ORDER BETWEEN '",V.Global.sDateStart,"' AND '",V.Global.sDateEnd,"' ",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_SALES (SALES,GM_PERCENT,ORDER_NO,PRODUCT_LINE,ORDER_LINE,QTY,OPENHIST,CUSTOMER,ORDERDATE,COST, SALESMAN, MONTH, YEAR,DATE_SHIPPED,DATE_DUE,MONTH_INT) SELECT EXTENSION,MARGIN,ORDER_NO,PRODUCT_LINE,ORDER_LINE,QTY_SHIPPED,'HIST' AS OPENHIST,CUSTOMER,DATE_ORDER,COST,SALESPERSON,LEFT(MONTHNAME(DATE_INVOICE),'3'),YEAR(DATE_INVOICE),DATE_SHIPPED,DATE_DUE,MONTH(DATE_INVOICE) FROM V_ORDER_HIST_LINE WHERE LINE_TYPE<>'P' AND LEFT(ORDER_LINE,1)<>'8' AND DATE_INVOICE BETWEEN ' ",V.Global.sDateStart," ' AND ' ",V.Global.sDateEnd,"' ",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		F.Intrinsic.Control.CallSub(Z_sub_routine)
	F.Intrinsic.Control.EndIf
F.Intrinsic.Control.EndIf

F.Intrinsic.String.Build("{0} -- Sales Build Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)

Program.Sub.Routine.End

Program.Sub.RoutineQuality.Start
V.Local.squery.Declare(String)

F.Intrinsic.Control.If(V.Global.sRefresh,=,"1")
	F.Intrinsic.String.Concat("DELETE FROM CON_KPI_QUALITY WHERE DATE>='",V.Global.sRefreshDate,"'",V.Local.squery)
	F.ODBC.Connection!con.Execute(V.Local.squery)

	F.Intrinsic.STRING.concat("INSERT INTO CON_KPI_QUALITY (CONTROLNO, DATE, WO, WOSUFFIX,WOSEQ,PARTNO,WC,EMPLOYEENAME,QUANTITY,DOLLARS,VENDOR,VENDORNAME,SCRAPCODE,EMPLOYEEDEPT,MONTH_INT,YEAR_INT) ","",V.local.squery)
	F.intrinsic.STRING.CONCAT(V.local.squery,"select CONTROL_NUMBER,DATE_ENTERED,JOB,SUFFIX,SEQUENCE, PART,WORKCENTER, EMPLOYEE_NAME, QTY_REJECTED, ORIG_SCRAP_VALUE, VENDOR, NAME, SCRAP_CODE, EMPLOYEE_DEPT,MONTH(DATE_ENTERED),YEAR(DATE_ENTERED) FROM V_QUALITY where  DATE_QUALITY>='",V.Global.sRefreshDate,"'",V.LOCAL.SQUERY)
	F.odbc.connection!con.execute(V.local.squery)
F.Intrinsic.Control.Else
	F.odbc.Connection!con.Execute("DELETE FROM CON_KPI_QUALITY")
	F.Intrinsic.Control.If(V.Global.sAlldata,=,1)
		F.Intrinsic.STRING.concat("INSERT INTO CON_KPI_QUALITY (CONTROLNO, DATE, WO, WOSUFFIX,WOSEQ,PARTNO,WC,EMPLOYEENAME,QUANTITY,DOLLARS,VENDOR,VENDORNAME,SCRAPCODE,EMPLOYEEDEPT,MONTH_INT,YEAR_INT) ","",V.local.squery)
		F.intrinsic.STRING.CONCAT(V.local.squery,"select CONTROL_NUMBER,DATE_ENTERED,JOB,SUFFIX,SEQUENCE, PART,WORKCENTER, EMPLOYEE_NAME, QTY_REJECTED, ORIG_SCRAP_VALUE, VENDOR, NAME, SCRAP_CODE, EMPLOYEE_DEPT,MONTH(DATE_ENTERED),YEAR(DATE_ENTERED) FROM V_QUALITY","",V.LOCAL.SQUERY)
	F.Intrinsic.Control.Else
		F.Intrinsic.STRING.concat("INSERT INTO CON_KPI_QUALITY (CONTROLNO, DATE, WO, WOSUFFIX,WOSEQ,PARTNO,WC,EMPLOYEENAME,QUANTITY,DOLLARS,VENDOR,VENDORNAME,SCRAPCODE,EMPLOYEEDEPT,MONTH_INT,YEAR_INT) ","",V.local.squery)
		F.intrinsic.STRING.CONCAT(V.local.squery,"select CONTROL_NUMBER,DATE_ENTERED,JOB,SUFFIX,SEQUENCE, PART,WORKCENTER, EMPLOYEE_NAME, QTY_REJECTED, ORIG_SCRAP_VALUE, VENDOR, NAME, SCRAP_CODE, EMPLOYEE_DEPT,MONTH(DATE_ENTERED),YEAR(DATE_ENTERED) FROM V_QUALITY where  DATE_QUALITY BETWEEN '",V.Global.sDateStart,"' AND '",V.Global.sDateEnd,"'",V.LOCAL.SQUERY)
	F.Intrinsic.Control.EndIf
	F.ODBC.Connection!con.Execute(V.Local.squery)
F.Intrinsic.Control.EndIf


F.Intrinsic.String.Build("{0} -- Quality 1, Scrap Code Build Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)


Program.Sub.RoutineQuality.End

Program.Sub.RoutineQuotes.Start
V.Local.squery.Declare(String)

F.Intrinsic.Control.If(V.Global.srefresh,=,"1")
	F.Intrinsic.String.Concat("DELETE FROM CON_KPI_QUOTES WHERE DATEQUOTERECEIVED>='",V.Global.sRefreshDate,"'",V.Local.squery)
	F.ODBC.Connection!con.Execute(V.Local.squery)
	F.Intrinsic.string.Concat("INSERT INTO CON_KPI_QUOTES (WLC,QUOTENO,REFERENCE,DATEQUOTERECEIVED,DATEQUOTEDUE,DATESUBMITTED,MAXDOLLAR,MINDOLLAR,CUSTOMER,CUSTOMERNAME,QUOTELINE,MONTH_INT,YEAR_INT,SORT_1)","",V.local.squery)
	F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY,"SELECT ISNULL(TB2.QUOTE_WON,''),TB1.QUOTE_NO,TB1.CUSTOMER_PO,TB1.DATE_QUOTE,TB1.DATE_DUE,tb1.DATE_QUOTE_APPROVED, TB2.EXTENSION,TB2.EXTENSION,TB1.CUSTOMER,TB3.NAME_CUSTOMER,TB2.RECORD_NO,MONTH(DATE_QUOTE),YEAR(DATE_QUOTE),CODE_SORT FROM V_QUOTE_HEADER AS TB1  LEFT OUTER JOIN V_QUOTE_LINES AS TB2 ON TB1.QUOTE_NO = TB2.QUOTE_NO AND TB1.DATE_QUOTE >= '",V.Global.sRefreshDate,"' LEFT OUTER JOIN V_CUSTOMER_MASTER AS TB3  ON TB1.CUSTOMER = TB3.CUSTOMER",V.Local.squery)
	F.ODBC.CONNECTION!CON.Execute(V.LOCAL.SQUERY)

	'Get Min Dollar
	F.Intrinsic.String.Concat("select QUOTE_NO, MIN(EXTENSION) AS MINIMUM from V_QUOTE_LINES where DATE_QUOTE>='",V.global.srefreshdate,"' GROUP BY QUOTE_NO","",V.Local.squery)
	F.ODBC.Connection!con.OpenRecordsetRO("rsMINQT",V.Local.squery)
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsMINQT.EOF,=,True)
		F.Intrinsic.String.Concat("UPDATE CON_KPI_QUOTES SET MINDOLLAR='",V.ODBC.con!rsMINQT.FIELDVALTRIMPSQL!MINIMUM,"' WHERE QUOTENO='",V.ODBC.con!rsMINQT.FIELDVALTRIMPSQL!QUOTE_NO,"'",V.Local.squery)
		F.ODBC.Connection!con.Execute(V.Local.squery)
		F.ODBC.con!rsMINQT.MoveNext
	F.Intrinsic.Control.Loop
	F.ODBC.con!rsMINQT.Close

	'Get Max Dollar
	F.Intrinsic.String.Concat("select QUOTE_NO, MAX(EXTENSION) AS MAXIMUM from V_QUOTE_LINES where DATE_QUOTE>='",V.global.srefreshdate,"' GROUP BY QUOTE_NO","",V.Local.squery)
	F.ODBC.Connection!con.OpenRecordsetRO("rsMAXQT",V.Local.squery)
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsMAXQT.EOF,=,True)
		F.Intrinsic.String.Concat("UPDATE CON_KPI_QUOTES SET MAXDOLLAR='",V.ODBC.con!rsMAXQT.FIELDVALTRIMPSQL!MAXIMUM,"' WHERE QUOTENO='",V.ODBC.con!rsMAXQT.FIELDVALTRIMPSQL!QUOTE_NO,"'",V.Local.squery)
		F.ODBC.Connection!con.Execute(V.Local.squery)
		F.ODBC.con!rsMAXQT.MoveNext
	F.Intrinsic.Control.Loop
	F.ODBC.con!rsMAXQT.Close
F.Intrinsic.Control.Else

	F.ODBC.Connection!con.Execute("delete from CON_KPI_QUOTES")
	F.Intrinsic.Control.If(V.Global.sAlldata,=,1)
		F.Intrinsic.string.Concat("INSERT INTO CON_KPI_QUOTES (WLC,QUOTENO,REFERENCE,DATEQUOTERECEIVED,DATEQUOTEDUE,DATESUBMITTED,MAXDOLLAR,MINDOLLAR,CUSTOMER,CUSTOMERNAME,QUOTELINE,MONTH_INT,YEAR_INT,SORT_1)","",V.local.squery)
		F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY,"SELECT ISNULL(TB2.QUOTE_WON,''),TB1.QUOTE_NO,TB1.CUSTOMER_PO,TB1.DATE_QUOTE,TB1.DATE_DUE,tb1.DATE_QUOTE_APPROVED, TB2.EXTENSION,TB2.EXTENSION,TB1.CUSTOMER,","",V.LOCAL.SQUERY)
		F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY,"TB3.NAME_CUSTOMER,TB2.RECORD_NO,MONTH(DATE_Quote),YEAR(DATE_Quote),CODE_SORT FROM V_QUOTE_HEADER AS TB1  LEFT OUTER JOIN V_QUOTE_LINES AS TB2 ON TB1.QUOTE_NO = TB2.QUOTE_NO LEFT OUTER JOIN ",V.LOCAL.SQUERY)
		F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY," V_CUSTOMER_MASTER AS TB3  ON TB1.CUSTOMER = TB3.CUSTOMER",V.Local.squery)
	F.Intrinsic.Control.Else
		F.Intrinsic.string.Concat("INSERT INTO CON_KPI_QUOTES (WLC,QUOTENO,REFERENCE,DATEQUOTERECEIVED,DATEQUOTEDUE,DATESUBMITTED,MAXDOLLAR,MINDOLLAR,CUSTOMER,CUSTOMERNAME,QUOTELINE,MONTH_INT,YEAR_INT,SORT_1)","",V.local.squery)
		F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY,"SELECT ISNULL(TB2.QUOTE_WON,''),TB1.QUOTE_NO,TB1.CUSTOMER_PO,TB1.DATE_QUOTE,TB1.DATE_DUE,tb1.DATE_QUOTE_APPROVED, TB2.EXTENSION,TB2.EXTENSION,TB1.CUSTOMER, ","",V.LOCAL.SQUERY)
		F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY,"TB3.NAME_CUSTOMER,TB2.RECORD_NO,MONTH(DATE_QUOTE),YEAR(DATE_QUOTE),CODE_SORT FROM V_QUOTE_HEADER AS TB1  LEFT OUTER JOIN V_QUOTE_LINES AS TB2 ON TB1.QUOTE_NO = TB2.QUOTE_NO AND TB1.DATE_QUOTE ","",V.LOCAL.SQUERY)
		F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY,"BETWEEN '",V.Global.sDateStart,"' AND '",V.Global.sDateEnd,"' LEFT OUTER JOIN V_CUSTOMER_MASTER AS TB3  ON TB1.CUSTOMER = TB3.CUSTOMER",V.Local.squery)
	F.Intrinsic.Control.EndIf
	F.ODBC.CONNECTION!CON.Execute(V.LOCAL.SQUERY)

	'Get Min Dollar
	F.ODBC.Connection!con.OpenRecordsetRO("rsMINQT","select QUOTE_NO, MIN(EXTENSION) AS MINIMUM from V_QUOTE_LINES GROUP BY QUOTE_NO")
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsMINQT.EOF,=,True)
		F.Intrinsic.String.Concat("UPDATE CON_KPI_QUOTES SET MINDOLLAR='",V.ODBC.con!rsMINQT.FIELDVALTRIMPSQL!MINIMUM,"' WHERE QUOTENO='",V.ODBC.con!rsMINQT.FIELDVALTRIMPSQL!QUOTE_NO,"'",V.Local.squery)
		F.ODBC.Connection!con.Execute(V.Local.squery)
		F.ODBC.con!rsMINQT.MoveNext
	F.Intrinsic.Control.Loop
	F.ODBC.con!rsMINQT.Close

	'Get Max Dollar
	F.ODBC.Connection!con.OpenRecordsetRO("rsMAXQT","select QUOTE_NO, MAX(EXTENSION) AS MAXIMUM from V_QUOTE_LINES GROUP BY QUOTE_NO")
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsMAXQT.EOF,=,True)
		F.Intrinsic.String.Concat("UPDATE CON_KPI_QUOTES SET MAXDOLLAR='",V.ODBC.con!rsMAXQT.FIELDVALTRIMPSQL!MAXIMUM,"' WHERE QUOTENO='",V.ODBC.con!rsMAXQT.FIELDVALTRIMPSQL!QUOTE_NO,"'",V.Local.squery)
		F.ODBC.Connection!con.Execute(V.Local.squery)
		F.ODBC.con!rsMAXQT.MoveNext
	F.Intrinsic.Control.Loop
	F.ODBC.con!rsMAXQT.Close

F.Intrinsic.Control.EndIf


F.Intrinsic.String.Build("{0} -- Quote Build Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)

Program.Sub.RoutineQuotes.End

Program.Sub.RoutineJobs.Start
V.Local.squery.Declare(String)
V.Local.ssstring.Declare(String)

F.Intrinsic.Control.If(V.Global.sREFRESH,=,"1")
	F.Intrinsic.String.Concat(" and DATE_START>='",V.Global.sRefreshDate,"'",V.global.saddon)

	'Delete only after the refresh
	F.Intrinsic.String.Concat("DELETE FROM CON_KPI_JOBS_EST_ACT WHERE DATECLOSED>='",V.Global.sRefreshDate,"'",V.Local.squery)
	F.ODBC.connection!con.EXECUTE(V.Local.squery)

	'Start with Active Jobs
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_JOBS_EST_ACT (CUSTOMER,JOB,SUFFIX,DESCRIPTION,DATECLOSED,MONTH_INT,YEAR_INT) SELECT CUSTOMER,JOB,SUFFIX,DESCRIPTION,DATE_CLOSED,MONTH(DATE_CLOSED),YEAR(DATE_CLOSED) FROM V_JOB_HEADER WHERE DATE_CLOSED <> '1900-01-01' AND DATE_CLOSED >='",V.Global.srefreshdate,"'",V.Local.squery)
	F.ODBC.Connection!con.Execute(V.Local.squery)
	F.Intrinsic.Control.CallSub(Z_sub_routine_jobsactv)

	'Then with Historic Jobs
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_JOBS_EST_ACT (CUSTOMER,JOB,SUFFIX,DESCRIPTION,DATECLOSED,MONTH_INT,YEAR_INT) SELECT CUSTOMER,JOB,SUFFIX,DESCRIPTION,DATE_CLOSED,MONTH(DATE_CLOSED),YEAR(DATE_CLOSED) FROM V_JOB_HIST_MAST WHERE DATE_CLOSED <> '1900-01-01' AND DATE_CLOSED >= '",V.Global.srefreshdate,"'",V.Local.squery)
	F.ODBC.Connection!con.Execute(V.Local.squery)
	F.Intrinsic.Control.CallSub(Z_sub_routine_jobshist)
	
F.Intrinsic.Control.Else
	'Delete only after the refresh
	F.Intrinsic.String.Concat("DELETE FROM CON_KPI_JOBS_EST_ACT","",V.Local.squery)
	F.ODBC.connection!con.EXECUTE(V.Local.squery)

	F.Intrinsic.Control.If(V.Global.sAlldata,=,1)
		'Active Jobs
		F.intrinsic.string.concat("INSERT INTO CON_KPI_JOBS_EST_ACT (CUSTOMER,JOB,SUFFIX,DESCRIPTION,DATECLOSED,MONTH_INT,YEAR_INT) SELECT CUSTOMER,JOB,SUFFIX,DESCRIPTION,DATE_CLOSED,MONTH(DATE_CLOSED),YEAR(DATE_CLOSED) FROM V_JOB_HEADER WHERE DATE_CLOSED<>'1900-01-01'","",V.Local.squery)
		F.ODBC.Connection!con.Execute(V.Local.squery)
		F.Intrinsic.Control.CallSub(Z_sub_routine_jobsactv)

		'History Jobs
		F.Intrinsic.String.concat("INSERT INTO CON_KPI_JOBS_EST_ACT (CUSTOMER,JOB,SUFFIX,DESCRIPTION,DATECLOSED,MONTH_INT,YEAR_INT) SELECT CUSTOMER,JOB,SUFFIX,DESCRIPTION,DATE_CLOSED,MONTH(DATE_CLOSED),YEAR(DATE_CLOSED) FROM v_JOB_HIST_MAST","",V.Local.squery)
		F.ODBC.Connection!con.Execute(V.Local.squery)
		F.Intrinsic.Control.CallSub(Z_sub_routine_jobshist)

	F.Intrinsic.Control.Else
		'Active Jobs
		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_JOBS_EST_ACT (CUSTOMER,JOB,SUFFIX,DESCRIPTION,DATECLOSED,MONTH_INT,YEAR_INT) SELECT CUSTOMER,JOB,SUFFIX,DESCRIPTION,DATE_CLOSED,MONTH(DATE_CLOSED),YEAR(DATE_CLOSED) FROM V_JOB_HEADER WHERE DATE_CLOSED <> '1900-01-01' AND DATE_CLOSED BETWEEN '",V.Global.sDateStart,"' AND '",V.Global.sDateEnd,"'",V.Local.squery)
		F.ODBC.Connection!con.Execute(V.Local.squery)
		F.Intrinsic.Control.CallSub(Z_sub_routine_jobsactv)

		'History Jobs
		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_JOBS_EST_ACT (CUSTOMER,JOB,SUFFIX,DESCRIPTION,DATECLOSED,MONTH_INT,YEAR_INT) SELECT CUSTOMER,JOB,SUFFIX,DESCRIPTION,DATE_CLOSED,MONTH(DATE_CLOSED),YEAR(DATE_CLOSED) FROM V_JOB_HIST_MAST WHERE DATE_CLOSED <> '1900-01-01' AND DATE_CLOSED BETWEEN '",V.Global.sDateStart,"' AND '",V.Global.sDateEnd,"'",V.Local.squery)
		F.ODBC.Connection!con.Execute(V.Local.squery)
		F.Intrinsic.Control.CallSub(Z_sub_routine_jobshist)

	F.Intrinsic.Control.EndIf
F.Intrinsic.Control.EndIf


'Then Customer Names
V.Local.squery.Set("")
F.Intrinsic.String.Concat("SELECT CUSTOMER,NAME_CUSTOMER FROM V_CUSTOMER_MASTER","",V.Local.squery)
V.Local.scustomer.Declare(String)
F.ODBC.connection!con.OpenRecordsetRW("rsJOBOP",V.local.squery)
F.Intrinsic.Control.DoUntil(V.ODBC.con!rsJOBOP.EOF,=,True)
	V.Local.scustomer.Set(V.ODBC.con!rsJOBOP.FIELDVALTRIMPSQL!NAME_CUSTOMER)
	F.Intrinsic.String.Replace(V.Local.scustomer,"'","",V.Local.scustomer)
	F.Intrinsic.String.Concat("UPDATE CON_KPI_JOBS_EST_ACT SET CUSTOMERNAME='",V.Local.scustomer,"' ",V.Local.squery)
	F.Intrinsic.String.Concat(V.local.squery," WHERE CUSTOMER='",V.ODBC.con!rsjobop.FIELDVALTRIMPSQL!CUSTOMER,"'",V.Local.squery)
	F.ODBC.Connection!con.Execute(V.Local.squery)
	F.ODBC.con!rsJOBOP.MoveNext
F.Intrinsic.Control.Loop
F.ODBC.con!rsJOBOP.Close

F.Intrinsic.String.Build("{0} -- Jobs Est/Act Build Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)


Program.Sub.RoutineJobs.End

Program.Sub.RoutineInvHist.Start
V.Local.squery.Declare(String)

F.Intrinsic.Control.If(V.Global.sRefresh,=,"1")
	F.Intrinsic.String.Concat("DELETE FROM CON_KPI_INV_HIST WHERE DATE>='",V.Global.sRefreshDate,"'",V.Local.squery)
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_INV_HIST (TC,PART,PL,DESCRIPTION,REFERENCE,QTY,COST,DATE) SELECT CODE_TRANSACTION,PART,PRODUCT_LINE,TRANSACTION_DESC,REFER_2,QUANTITY,COST,DATE_HISTORY FROM V_INVENTORY_HIST WHERE PROGRAM_A <> 'PUR100GI@' AND CODE_TRANSACTION='P16' AND DATE_HISTORY >='",V.Global.sRefreshDate,"'",V.Local.squery)
	F.ODBC.Connection!con.Execute(V.Local.squery)
F.Intrinsic.Control.Else
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_INV_HIST")
	F.Intrinsic.Control.If(V.Global.sAlldata,=,1)
		V.Local.squery.Set("INSERT INTO CON_KPI_INV_HIST (TC,PART,PL,DESCRIPTION,REFERENCE,QTY,COST,DATE) SELECT CODE_TRANSACTION,PART,PRODUCT_LINE,TRANSACTION_DESC,REFER_2,QUANTITY,COST,DATE_HISTORY FROM V_INVENTORY_HIST WHERE PROGRAM_A <> 'PUR100GI@' AND CODE_TRANSACTION='P16'")
	F.Intrinsic.Control.Else
		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_INV_HIST (TC,PART,PL,DESCRIPTION,REFERENCE,QTY,COST,DATE) SELECT CODE_TRANSACTION,PART,PRODUCT_LINE,TRANSACTION_DESC,REFER_2,QUANTITY,COST,DATE_HISTORY FROM V_INVENTORY_HIST WHERE PROGRAM_A <> 'PUR100GI@' AND CODE_TRANSACTION='P16' AND DATE_HISTORY BETWEEN '",V.Global.sDateStart,"' AND '",V.Global.sDateEnd,"'",V.Local.squery)
	F.Intrinsic.Control.EndIf

	F.ODBC.Connection!con.Execute(V.Local.squery)
F.Intrinsic.Control.EndIf

F.Intrinsic.String.Build("{0} -- Inventory History Build Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)

Program.Sub.RoutineInvHist.End

Program.Sub.RoutineSimpInv.Start
V.Local.squery.Declare(String)
V.Local.dtempdate.Declare(Date)
V.Local.dtempdate.Set(V.Ambient.Date)

V.Local.squery3.Declare(String)
V.Local.squery3.Set("DELETE FROM CON_KPI_SIMP_INV")
F.ODBC.Connection!con.Execute(V.Local.squery3)

V.Local.squery.Set("INSERT INTO CON_KPI_SIMP_INV (PL,PART,DESCRIPTION,QUANTITY,COST) SELECT PRODUCT_LINE,PART,DESCRIPTION,QTY_ONHAND,AMT_COST FROM V_INVENTORY_MSTR")
F.ODBC.Connection!con.Execute(V.Local.squery)

F.Intrinsic.string.concat("UPDATE CON_KPI_SIMP_INV SET DATE_HISTORY='",V.Local.dtempdate.PervasiveDate,"'",V.Local.squery)
F.ODBC.Connection!con.Execute(V.Local.squery)

F.Intrinsic.String.Build("{0} -- Simple Inventory Build Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)

Program.Sub.RoutineSimpInv.End

Program.Sub.RoutineLateCosts.Start
V.Local.squery.Declare(String)

F.Intrinsic.Control.If(V.Global.sRefresh,=,"1")
	F.Intrinsic.String.Concat("DELETE FROM CON_KPI_LATE_COSTS WHERE DATETRANSACTION>='",V.Global.sRefreshDate,"'",V.Local.squery)
	F.ODBC.Connection!con.Execute(V.Local.squery)

	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_LATE_COSTS (WORKORDER,COST,DATETRANSACTION) SELECT REFERENCE,AMOUNT,POST_DATE FROM V_GL_DETAIL WHERE LEFT(BATCH_NUM,1)='M' AND DB_CR_FLAG='D' AND REFERENCE <> '' AND T_DATE>='",V.Global.sRefreshDate,"'",V.Local.squery)
	F.ODBC.Connection!con.execute(V.Local.squery)

	F.Intrinsic.String.Concat("SELECT ID, WORKORDER FROM CON_KPI_LATE_COSTS where DATETRANSACTION>='",V.Global.sRefreshDate,"'",V.Local.squery)
F.Intrinsic.Control.Else
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_LATE_COSTS")
	F.Intrinsic.Control.If(V.Global.sAlldata,=,1)
		V.Local.squery.Set("INSERT INTO CON_KPI_LATE_COSTS (WORKORDER,COST,DATETRANSACTION) SELECT REFERENCE,AMOUNT,POST_DATE FROM V_GL_DETAIL WHERE LEFT(BATCH_NUM,1)='M' AND DB_CR_FLAG='D' AND REFERENCE <> ''")
	F.Intrinsic.Control.Else
		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_LATE_COSTS (WORKORDER,COST,DATETRANSACTION) SELECT REFERENCE,AMOUNT,POST_DATE FROM V_GL_DETAIL WHERE LEFT(BATCH_NUM,1)='M' AND DB_CR_FLAG='D' AND REFERENCE <> '' AND T_DATE BETWEEN '",V.Global.sDateStart,"' AND '",V.Global.sDateEnd,"'",V.Local.squery)
	F.Intrinsic.Control.EndIf
	F.ODBC.Connection!con.Execute(V.Local.squery)

	V.Local.squery.Set("SELECT ID, WORKORDER FROM CON_KPI_LATE_COSTS")
F.Intrinsic.Control.EndIf

V.Local.stempquery.Declare(String)
V.Local.sret.Declare(String)
V.Local.lfind.Declare(Long)
F.ODBC.Connection!con.OpenRecordsetRW("RSGD",V.Local.squery)
F.Intrinsic.Control.DoUntil(V.ODBC.con!rsGD.EOF,=,True)
		F.Intrinsic.String.Instr(V.ODBC.con!rsGD.FIELDVALTRIMPSQL!WORKORDER,"-",0,V.Local.lfind)
		F.Intrinsic.Control.If(V.Local.lfind,>,0)
			F.Intrinsic.String.Split(V.ODBC.con!rsGD.FIELDVALTRIMPSQL!WORKORDER,"-",V.Local.sret)
			F.Intrinsic.String.Concat("UPDATE CON_KPI_LATE_COSTS SET DESCRIPTION=(","",V.Local.stempquery)
			F.Intrinsic.String.Concat(V.local.stempquery,"select DESCRIPTION from v_job_header where job='",V.Local.sret(0),"' and suffix='",V.Local.sret(1),"') where ID='",V.odbc.con!rsgd.FIELDVALTRIMPSQL!ID,"'",V.Local.stempquery)
			F.ODBC.Connection!con.Execute(V.Local.stempquery)
			V.Local.stempquery.Set("")
			F.Intrinsic.String.Concat("UPDATE CON_KPI_LATE_COSTS SET CUSTOMER=(","",V.Local.stempquery)
			F.Intrinsic.String.Concat(V.local.stempquery,"select CUSTOMER from v_job_header where job='",V.Local.sret(0),"' and suffix='",V.Local.sret(1),"') where ID='",V.odbc.con!rsgd.FIELDVALTRIMPSQL!ID,"'",V.Local.stempquery)
			F.ODBC.Connection!con.Execute(V.Local.stempquery)
		F.Intrinsic.Control.EndIf
	F.ODBC.con!rsGD.MoveNext
F.Intrinsic.Control.Loop
F.ODBC.con!RSGD.Close


F.Intrinsic.String.Build("{0} -- Late Costs Build Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)

Program.Sub.RoutineLateCosts.End

Program.Sub.RoutineMachine.Start
V.Local.sSQL.Declare(String)

'GATHERING DATA FOR CON_KPI_MACHINE

F.Intrinsic.Control.If(V.Global.sRefresh,=,"1")
	'CON_KPI_MACHINE
	F.Intrinsic.String.Concat("DELETE FROM CON_KPI_MACHINE","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_MACHINE (MACHINE) SELECT DISTINCT PART FROM V_JOB_OPERATIONS WHERE V_JOB_OPERATIONS.LMO = 'L' AND V_JOB_OPERATIONS.PART <> ''","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)
	F.Intrinsic.String.Concat("DELETE CON_KPI_MACHINE WHERE MACHINE = ''","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	'CON_KPI_JOBOPER
	F.Intrinsic.String.Concat("DELETE FROM CON_KPI_JOBOPER where DATE_DUE>='",V.Global.sRefreshDate,"'",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_JOBOPER (JOB,SUFFIX,SEQ,LMO,PART,UNITS_OPEN,UNITS_COMPLETE,UNITS_SCRAP,HOURS_ESTIMATED,HOURS_ACTUAL,DATE_START,DATE_DUE) SELECT JOB,SUFFIX,SEQ,LMO,PART,UNITS_OPEN,UNITS_COMPLETE,UNITS_SCRAP,HOURS_ESTIMATED,HOURS_ACTUAL,DATE_START,DATE_DUE FROM V_JOB_OPERATIONS WHERE V_JOB_OPERATIONS.LMO = 'L' AND V_JOB_OPERATIONS.FLAG_CLOSED = 'Y' AND V_JOB_OPERATIONS.HOURS_ACTUAL > 0 AND DATE_DUE>='",V.Global.sRefreshDAte,"'",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)
	F.Intrinsic.String.Concat("DELETE CON_KPI_JOBOPER WHERE PART = ''","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	'CON_KPI_JOBDETL
	F.Intrinsic.String.Concat("DELETE CON_KPI_JOBDETL WHERE DATE_SEQUENCE>='",V.global.srefreshdate,"'",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_JOBDETL (JOB,SUFFIX,SEQ,DATE_SEQUENCE,MACHINE,EDITED_WO_DTL,LMO,PIECES_COMPLTD,HOURS_WORKED) SELECT JOB,SUFFIX,SEQ,DATE_SEQUENCE,MACHINE,EDITED_WO_DTL,LMO,PIECES_COMPLTD,HOURS_WORKED FROM V_JOB_DETAIL WHERE LMO = 'L' AND EDITED_WO_DTL <> 'R' AND DATE_SEQUENCE >= '",V.Global.srefreshdate,"'",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)
	F.Intrinsic.String.Concat("DELETE CON_KPI_JOBDETL WHERE MACHINE = ''","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.Control.Else
	F.Intrinsic.String.Concat("DELETE CON_KPI_MACHINE","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)
	
	F.Intrinsic.String.Concat("DELETE CON_KPI_JOBOPER","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("DELETE CON_KPI_JOBDETL","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.Control.If(V.Global.sAlldata,=,1)
		'GATHERING DATA FOR CON_KPI_MACHINE
		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_MACHINE (MACHINE) SELECT DISTINCT PART FROM V_JOB_OPERATIONS WHERE V_JOB_OPERATIONS.LMO = 'L' AND V_JOB_OPERATIONS.PART <> ''","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)
		F.Intrinsic.String.Concat("DELETE CON_KPI_MACHINE WHERE MACHINE = ''","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		'GATHERING DATA FOR CON_KPI_JOBOPER
		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_JOBOPER (JOB,SUFFIX,SEQ,LMO,PART,UNITS_OPEN,UNITS_COMPLETE,UNITS_SCRAP,HOURS_ESTIMATED,HOURS_ACTUAL,DATE_START,DATE_DUE) SELECT JOB,SUFFIX,SEQ,LMO,PART,UNITS_OPEN,UNITS_COMPLETE,UNITS_SCRAP,HOURS_ESTIMATED,HOURS_ACTUAL,DATE_START,DATE_DUE FROM V_JOB_OPERATIONS WHERE V_JOB_OPERATIONS.LMO = 'L' AND V_JOB_OPERATIONS.FLAG_CLOSED = 'Y' AND V_JOB_OPERATIONS.HOURS_ACTUAL > 0","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)
		F.Intrinsic.String.Concat("DELETE CON_KPI_JOBOPER WHERE PART = ''","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		'GATHERING DATA FOR CON_KPI_JOBDETL
		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_JOBDETL (JOB,SUFFIX,SEQ,DATE_SEQUENCE,MACHINE,EDITED_WO_DTL,LMO,PIECES_COMPLTD,HOURS_WORKED) SELECT JOB,SUFFIX,SEQ,DATE_SEQUENCE,MACHINE,EDITED_WO_DTL,LMO,PIECES_COMPLTD,HOURS_WORKED FROM V_JOB_DETAIL WHERE LMO = 'L' AND EDITED_WO_DTL <> 'R'","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)
		F.Intrinsic.String.Concat("DELETE CON_KPI_JOBDETL WHERE MACHINE = ''","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.Control.Else
		'GATHERING DATA FOR CON_KPI_MACHINE, take in all machines
		'F.Intrinsic.String.Concat("INSERT INTO CON_KPI_MACHINE (MACHINE) SELECT DISTINCT PART FROM V_JOB_OPERATIONS WHERE V_JOB_OPERATIONS.LMO = 'L' AND V_JOB_OPERATIONS.PART <> '' AND DATE_DUE BETWEEN '",V.Global.sDateStart,"' AND '",V.Global.sDateEnd,"'",V.Local.sSQL)
		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_MACHINE (MACHINE) SELECT DISTINCT PART FROM V_JOB_OPERATIONS WHERE V_JOB_OPERATIONS.LMO = 'L' AND V_JOB_OPERATIONS.PART <> ''","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)
		F.Intrinsic.String.Concat("DELETE CON_KPI_MACHINE WHERE MACHINE = ''","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)
		
		'GATHERING DATA FOR CON_KPI_JOBOPER
		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_JOBOPER (JOB,SUFFIX,SEQ,LMO,PART,UNITS_OPEN,UNITS_COMPLETE,UNITS_SCRAP,HOURS_ESTIMATED,HOURS_ACTUAL,DATE_START,DATE_DUE) SELECT JOB,SUFFIX,SEQ,LMO,PART,UNITS_OPEN,UNITS_COMPLETE,UNITS_SCRAP,HOURS_ESTIMATED,HOURS_ACTUAL,DATE_START,DATE_DUE FROM V_JOB_OPERATIONS WHERE V_JOB_OPERATIONS.LMO = 'L' AND V_JOB_OPERATIONS.FLAG_CLOSED = 'Y' AND V_JOB_OPERATIONS.HOURS_ACTUAL > 0 AND DATE_DUE BETWEEN '",V.Global.sDateStart,"' AND '",V.Global.sDateEnd,"'",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)
		F.Intrinsic.String.Concat("DELETE CON_KPI_JOBOPER WHERE PART = ''","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		'GATHERING DATA FOR CON_KPI_JOBDETL
		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_JOBDETL (JOB,SUFFIX,SEQ,DATE_SEQUENCE,MACHINE,EDITED_WO_DTL,LMO,PIECES_COMPLTD,HOURS_WORKED) SELECT JOB,SUFFIX,SEQ,DATE_SEQUENCE,MACHINE,EDITED_WO_DTL,LMO,PIECES_COMPLTD,HOURS_WORKED FROM V_JOB_DETAIL WHERE LMO = 'L' AND EDITED_WO_DTL <> 'R' AND DATE_SEQUENCE BETWEEN '",V.Global.sDateStart,"' AND '",V.Global.sDateEnd,"'",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)
		F.Intrinsic.String.Concat("DELETE CON_KPI_JOBDETL WHERE MACHINE = ''","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.Control.EndIf
F.Intrinsic.Control.EndIf

F.Intrinsic.String.Build("{0} -- Machine Job Detail Build Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)


Program.Sub.RoutineMachine.End

Program.Sub.RoutineLaborCost.Start

V.Local.sSQL.Declare(String)

F.Intrinsic.Control.If(V.Global.sRefresh,=,"1")
	F.Intrinsic.String.Concat("DELETE FROM CON_KPI_LABORCOST WHERE DATE_CLOSED >='",V.global.srefreshdate,"'",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_LABORCOST (JOB,SUFFIX,PART,PRODUCT_LINE,QTY_COMPLETED,AMT_LABOR,DATE_CLOSED) ","",V.Local.sSQL)
	F.intrinsic.STRING.concat(V.local.ssql," SELECT JOB,SUFFIX,PART,PRODUCT_LINE,QTY_COMPLETED,AMT_LABOR,DATE_CLOSED FROM V_JOB_HEADER WHERE DATE_CLOSED <> '1900-1-1' AND DATE_CLOSED>= '",V.Global.srefreshdate,"' AND QTY_COMPLETED > 0","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_LABORCOST SET COST_PER_UNIT = (AMT_LABOR / QTY_COMPLETED) WHERE QTY_COMPLETED > 0 and DATE_CLOSED>='",V.Global.sRefreshDate,"'",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)
F.Intrinsic.Control.Else
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_LABORCOST")
	F.Intrinsic.Control.If(V.Global.sAlldata,=,1)
		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_LABORCOST (JOB,SUFFIX,PART,PRODUCT_LINE,QTY_COMPLETED,AMT_LABOR,DATE_CLOSED)","",V.LOCAL.SSQL)
		F.intrinsic.STRING.concat(V.local.ssql," SELECT JOB,SUFFIX,PART,PRODUCT_LINE,QTY_COMPLETED,AMT_LABOR,DATE_CLOSED FROM V_JOB_HEADER WHERE DATE_CLOSED <> '1900-1-1' AND QTY_COMPLETED > 0","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)
	F.Intrinsic.Control.Else
		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_LABORCOST (JOB,SUFFIX,PART,PRODUCT_LINE,QTY_COMPLETED,AMT_LABOR,DATE_CLOSED) ","",V.Local.sSQL)
		F.intrinsic.STRING.concat(V.local.ssql," SELECT JOB,SUFFIX,PART,PRODUCT_LINE,QTY_COMPLETED,AMT_LABOR,DATE_CLOSED FROM V_JOB_HEADER WHERE DATE_CLOSED <> '1900-1-1' AND DATE_CLOSED>= '",V.Global.sDateStart,"' AND DATE_CLOSED<='",V.Global.sDateEnd,"' AND QTY_COMPLETED > 0","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)
	F.Intrinsic.Control.EndIf

	F.Intrinsic.String.Concat("UPDATE CON_KPI_LABORCOST SET COST_PER_UNIT = (AMT_LABOR / QTY_COMPLETED) WHERE QTY_COMPLETED > 0","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)
F.Intrinsic.Control.EndIf

F.Intrinsic.String.Build("{0} -- Labor Cost Build Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)

Program.Sub.RoutineLaborCost.End

Program.Sub.RoutineWCavailability.Start
V.Local.sSQL.Declare(String)
V.Local.sDatediff.Declare(String)
V.Local.sNumbweek.Declare(String)
V.Local.sRemaindays.Declare(String)
V.Local.sStartweekday.Declare(String)
V.Local.sEndweekday.Declare(String)

F.Intrinsic.String.Concat("DELETE CON_KPI_WCAVAIL","",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.String.Concat("INSERT INTO CON_KPI_WCAVAIL (WORKCENTER,WC_NAME) SELECT MACHINE,WC_NAME FROM V_WORKCENTERS","",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET LEN_MON = (SELECT SUM (LENGTH_HRS_1_1+LENGTH_HRS_1_2+LENGTH_HRS_1_3+LENGTH_HRS_1_4+LENGTH_HRS_1_5+LENGTH_HRS_1_6) FROM V_WC_CALENDAR WHERE V_WC_CALENDAR.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER)","",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET LEN_TUE = (SELECT SUM (LENGTH_HRS_2_1+LENGTH_HRS_2_2+LENGTH_HRS_2_3+LENGTH_HRS_2_4+LENGTH_HRS_2_5+LENGTH_HRS_2_6) FROM V_WC_CALENDAR WHERE V_WC_CALENDAR.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER)","",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET LEN_WED = (SELECT SUM (LENGTH_HRS_3_1+LENGTH_HRS_3_2+LENGTH_HRS_3_3+LENGTH_HRS_3_4+LENGTH_HRS_3_5+LENGTH_HRS_3_6) FROM V_WC_CALENDAR WHERE V_WC_CALENDAR.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER)","",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET LEN_THU = (SELECT SUM (LENGTH_HRS_4_1+LENGTH_HRS_4_2+LENGTH_HRS_4_3+LENGTH_HRS_4_4+LENGTH_HRS_4_5+LENGTH_HRS_4_6) FROM V_WC_CALENDAR WHERE V_WC_CALENDAR.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER)","",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET LEN_FRI = (SELECT SUM (LENGTH_HRS_5_1+LENGTH_HRS_5_2+LENGTH_HRS_5_3+LENGTH_HRS_5_4+LENGTH_HRS_5_5+LENGTH_HRS_5_6) FROM V_WC_CALENDAR WHERE V_WC_CALENDAR.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER)","",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET LEN_SAT = (SELECT SUM (LENGTH_HRS_6_1+LENGTH_HRS_6_2+LENGTH_HRS_6_3+LENGTH_HRS_6_4+LENGTH_HRS_6_5+LENGTH_HRS_6_6) FROM V_WC_CALENDAR WHERE V_WC_CALENDAR.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER)","",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET LEN_SUN = (SELECT SUM (LENGTH_HRS_7_1+LENGTH_HRS_7_2+LENGTH_HRS_7_3+LENGTH_HRS_7_4+LENGTH_HRS_7_5+LENGTH_HRS_7_6) FROM V_WC_CALENDAR WHERE V_WC_CALENDAR.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER)","",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)


F.Intrinsic.String.Build("{0} -- Workcenter Availability Build Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)

Program.Sub.RoutineWCavailability.End

Program.Sub.Spare_data.Start
V.Local.sSQL.Declare(String)
V.Local.sDatediff.Declare(String)
V.Local.sNumbweek.Declare(String)
V.Local.sRemaindays.Declare(String)
V.Local.sStartweekday.Declare(String)
V.Local.sEndweekday.Declare(String)

F.Intrinsic.String.Concat("DELETE CON_KPI_WCAVAIL","",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.String.Concat("INSERT INTO CON_KPI_WCAVAIL (WORKCENTER,WC_NAME) SELECT MACHINE,WC_NAME FROM V_WORKCENTERS","",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET LEN_MON = (SELECT SUM (LENGTH_HRS_1_1+LENGTH_HRS_1_2+LENGTH_HRS_1_3+LENGTH_HRS_1_4+LENGTH_HRS_1_5+LENGTH_HRS_1_6) FROM V_WC_CALENDAR WHERE V_WC_CALENDAR.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER)","",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET LEN_TUE = (SELECT SUM (LENGTH_HRS_2_1+LENGTH_HRS_2_2+LENGTH_HRS_2_3+LENGTH_HRS_2_4+LENGTH_HRS_2_5+LENGTH_HRS_2_6) FROM V_WC_CALENDAR WHERE V_WC_CALENDAR.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER)","",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET LEN_WED = (SELECT SUM (LENGTH_HRS_3_1+LENGTH_HRS_3_2+LENGTH_HRS_3_3+LENGTH_HRS_3_4+LENGTH_HRS_3_5+LENGTH_HRS_3_6) FROM V_WC_CALENDAR WHERE V_WC_CALENDAR.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER)","",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET LEN_THU = (SELECT SUM (LENGTH_HRS_4_1+LENGTH_HRS_4_2+LENGTH_HRS_4_3+LENGTH_HRS_4_4+LENGTH_HRS_4_5+LENGTH_HRS_4_6) FROM V_WC_CALENDAR WHERE V_WC_CALENDAR.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER)","",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET LEN_FRI = (SELECT SUM (LENGTH_HRS_5_1+LENGTH_HRS_5_2+LENGTH_HRS_5_3+LENGTH_HRS_5_4+LENGTH_HRS_5_5+LENGTH_HRS_5_6) FROM V_WC_CALENDAR WHERE V_WC_CALENDAR.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER)","",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET LEN_SAT = (SELECT SUM (LENGTH_HRS_6_1+LENGTH_HRS_6_2+LENGTH_HRS_6_3+LENGTH_HRS_6_4+LENGTH_HRS_6_5+LENGTH_HRS_6_6) FROM V_WC_CALENDAR WHERE V_WC_CALENDAR.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER)","",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET LEN_SUN = (SELECT SUM (LENGTH_HRS_7_1+LENGTH_HRS_7_2+LENGTH_HRS_7_3+LENGTH_HRS_7_4+LENGTH_HRS_7_5+LENGTH_HRS_7_6) FROM V_WC_CALENDAR WHERE V_WC_CALENDAR.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER)","",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)


F.Intrinsic.Control.If(V.Global.sAlldata,=,1)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET START_DATE = '",V.Global.sallDateS,"'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET END_DATE = '",V.Global.sallDateE,"'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.Date.Weekday(V.Global.sallDateS,V.Local.sStartweekday)
	F.Intrinsic.Date.Weekday(V.Global.sallDateE,V.Local.sEndweekday)


F.Intrinsic.Control.Else

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET START_DATE = '",V.Global.sDateStart,"'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET END_DATE = '",V.Global.sallDateE,"'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.Date.Weekday(V.Global.sDateStart,V.Local.sStartweekday)
	F.Intrinsic.Date.Weekday(V.Global.sDateEnd,V.Local.sEndweekday)

F.Intrinsic.Control.EndIf

F.ODBC.Connection!con.OpenRecordsetRW("rstWCavail","SELECT * FROM CON_KPI_WCAVAIL")

F.Intrinsic.Date.DateDiff("d",V.ODBC.con!rstWCavail.FIELDVALTRIMPSQL!START_DATE,V.ODBC.con!rstWCavail.FIELDVALTRIMPSQL!END_DATE,V.Local.sDatediff)
F.Intrinsic.Math.Div(V.Local.sDatediff,7,V.Local.sNumbweek)
F.Intrinsic.Math.Round(V.Local.sNumbweek,0,0,V.Local.sNumbweek)

F.Intrinsic.Math.Mult(V.Local.sNumbweek,7,V.Local.sRemaindays)
F.Intrinsic.Math.Sub(V.Local.sDatediff,V.Local.sRemaindays,V.Local.sRemaindays)

F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET TOTAL_DAYS = '",V.Local.sDatediff,"'",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET NUMB_WEEK = '",V.Local.sNumbweek,"'",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET REMAIN_DAYS = '",V.Local.sRemaindays,"'",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET START_WEEKDAY = '",V.Local.sStartweekday,"'",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET END_WEEKDAY = '",V.Local.sEndweekday,"'",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.Control.SelectCase(V.Local.sStartweekday)

	F.Intrinsic.Control.Case(1)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET START_WDNAME = 'SUNDAY'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.Control.Case(2)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET START_WDNAME = 'MONDAY'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.Control.Case(3)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET START_WDNAME = 'TUESDAY'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.Control.Case(4)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET START_WDNAME = 'WEDNESDAY'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.Control.Case(5)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET START_WDNAME = 'THURSDAY'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.Control.Case(6)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET START_WDNAME = 'FRIDAY'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.Control.Case(7)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET START_WDNAME = 'SATURDAY'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.Control.EndSelect


F.Intrinsic.Control.SelectCase(V.Local.sEndweekday)

	F.Intrinsic.Control.Case(1)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET END_WDNAME = 'SUNDAY'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.Control.Case(2)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET END_WDNAME = 'MONDAY'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.Control.Case(3)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET END_WDNAME = 'TUESDAY'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.Control.Case(4)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET END_WDNAME = 'WEDNESDAY'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.Control.Case(5)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET END_WDNAME = 'THURSDAY'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.Control.Case(6)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET END_WDNAME = 'FRIDAY'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.Control.Case(7)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCAVAIL SET END_WDNAME = 'SATURDAY'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.Control.EndSelect


Program.Sub.Spare_data.End

Program.Sub.RoutineWCusage.Start
V.Local.sSQL.Declare(String)
V.Local.sDatediff.Declare(String)
V.Local.sNumbweek.Declare(String)
V.Local.sRemaindays.Declare(String)
V.Local.sStartweekday.Declare(String)
V.Local.sDate.Declare(String)
V.Local.sCont.Declare(String)
V.Local.sDayweek.Declare(String)
V.Local.sret.Declare(String)
V.Local.iCount.Declare(Long)
V.Local.iCount.Set(0)

F.Intrinsic.Control.If(V.Global.sRefresh,=,"1")
	F.Intrinsic.String.Concat("DELETE CON_KPI_WCUSE where WORK_DATE_N>='",V.global.srefreshdate,"'",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_WCUSE (WORKCENTER,WORK_DATE,WORK_DATE_N,MONTH_INT,YEAR_INT) SELECT DISTINCT MACHINE,DATE_SEQUENCE,DATE_SEQUENCE,MONTH(DATE_SEQUENCE),YEAR(DATE_SEQUENCE) FROM V_JOB_DETAIL WHERE LMO = 'L' AND MACHINE <> '' AND FLAG_INDIRECT <> 'I' AND EDITED_WO_DTL <> 'R' AND DATE_SEQUENCE>='",V.Global.srefreshdate,"'",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCUSE SET WC_NAME = V_WORKCENTERS.WC_NAME FROM V_WORKCENTERS WHERE CON_KPI_WCUSE.WORKCENTER = V_WORKCENTERS.MACHINE AND CON_KPI_WCUSE.WORK_DATE_N>='",V.Global.sRefreshDate,"'",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCUSE SET AVAIL_TIME=(SELECT LEN_MON FROM CON_KPI_WCAVAIL WHERE CON_KPI_WCUSE.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER) WHERE DAYNAME(WORK_DATE)='Monday'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCUSE SET AVAIL_TIME=(SELECT LEN_TUE FROM CON_KPI_WCAVAIL WHERE CON_KPI_WCUSE.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER) WHERE DAYNAME(WORK_DATE)='Tuesday'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCUSE SET AVAIL_TIME=(SELECT LEN_WED FROM CON_KPI_WCAVAIL WHERE CON_KPI_WCUSE.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER) WHERE DAYNAME(WORK_DATE)='Wednesday'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCUSE SET AVAIL_TIME=(SELECT LEN_THU FROM CON_KPI_WCAVAIL WHERE CON_KPI_WCUSE.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER) WHERE DAYNAME(WORK_DATE)='Thursday'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCUSE SET AVAIL_TIME=(SELECT LEN_FRI FROM CON_KPI_WCAVAIL WHERE CON_KPI_WCUSE.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER) WHERE DAYNAME(WORK_DATE)='Friday'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCUSE SET AVAIL_TIME=(SELECT LEN_SAT FROM CON_KPI_WCAVAIL WHERE CON_KPI_WCUSE.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER) WHERE DAYNAME(WORK_DATE)='Saturday'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCUSE SET AVAIL_TIME=(SELECT LEN_SUN FROM CON_KPI_WCAVAIL WHERE CON_KPI_WCUSE.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER) WHERE DAYNAME(WORK_DATE)='Sunday'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("SELECT * FROM CON_KPI_WCUSE WHERE WORK_DATE_N>='",V.global.srefreshdate,"' ORDER BY WORK_DATE_N DESC",V.Local.sSQL)
	F.ODBC.Connection!con.OpenLocalRecordsetRW("rs",V.Local.sSQL)
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rs.EOF,=,True)
			F.Intrinsic.String.Concat("SELECT SUM(PIECES_COMPLTD) FROM V_JOB_DETAIL WHERE MACHINE='{0}' AND DATE_SEQUENCE = '{1}'","",V.Local.sSQL)
			F.Intrinsic.String.Build(V.Local.sSQL,V.ODBC.con!rs.FIELDVALTRIMPSQL!workcenter,V.ODBC.con!rs.FieldValPervasiveDate!work_date_n,V.Local.sSQL)
			F.ODBC.connection!con.ExecuteAndReturn(V.Local.sSQL,V.Local.sret)
			F.ODBC.con!rs.SET!PIECES_COMPLTD(V.Local.sret)

			F.Intrinsic.String.Concat("SELECT SUM(PIECES_SCRAP) FROM V_JOB_DETAIL WHERE MACHINE='{0}' AND DATE_SEQUENCE = '{1}'","",V.Local.sSQL)
			F.Intrinsic.String.Build(V.Local.sSQL,V.ODBC.con!rs.FIELDVALTRIMPSQL!workcenter,V.ODBC.con!rs.FieldValPervasiveDate!work_date_n,V.Local.sSQL)
			F.ODBC.connection!con.ExecuteAndReturn(V.Local.sSQL,V.Local.sret)
			F.ODBC.con!rs.SET!PIECES_SCRAP(V.Local.sret)

			F.Intrinsic.String.Concat("SELECT SUM(HOURS_WORKED) FROM V_JOB_DETAIL  WHERE MACHINE='{0}' AND DATE_SEQUENCE = '{1}'","",V.Local.sSQL)
			F.Intrinsic.String.Build(V.Local.sSQL,V.ODBC.con!rs.FIELDVALTRIMPSQL!workcenter,V.ODBC.con!rs.FieldValPervasiveDate!work_date_n,V.Local.sSQL)
			F.ODBC.Connection!con.Execute(V.Local.sSQL)
			F.Intrinsic.Math.Add(V.Local.iCount,1,V.Local.iCount)
			F.Intrinsic.Control.If(V.local.iCount,=,100)
				F.Intrinsic.Control.CallSub(Calcwc)
				V.Local.iCount.Set(0)
			F.Intrinsic.Control.EndIf

		F.ODBC.con!rs.MoveNext
	F.Intrinsic.Control.Loop

F.Intrinsic.Control.Else
	F.Intrinsic.String.Concat("DELETE CON_KPI_WCUSE","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.Control.If(V.Global.sAlldata,=,1)
		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_WCUSE (WORKCENTER,WORK_DATE,WORK_DATE_N,MONTH_INT,YEAR_INT) SELECT DISTINCT MACHINE,DATE_SEQUENCE,DATE_SEQUENCE,MONTH(DATE_SEQUENCE),YEAR(DATE_SEQUENCE) FROM V_JOB_DETAIL WHERE LMO = 'L' AND MACHINE <> '' AND FLAG_INDIRECT <> 'I' AND EDITED_WO_DTL <> 'R'","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)
	F.Intrinsic.Control.Else
		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_WCUSE (WORKCENTER,WORK_DATE,WORK_DATE_N,MONTH_INT,YEAR_INT) SELECT DISTINCT MACHINE,DATE_SEQUENCE,DATE_SEQUENCE,MONTH(DATE_SEQUENCE),YEAR(DATE_SEQUENCE) FROM V_JOB_DETAIL WHERE LMO = 'L' AND MACHINE <> '' AND FLAG_INDIRECT <> 'I' AND EDITED_WO_DTL <> 'R' AND DATE_SEQUENCE BETWEEN '",V.Global.sDateStart,"' AND '",V.Global.sDateEnd,"'",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)
	F.Intrinsic.Control.EndIf

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCUSE SET WC_NAME = V_WORKCENTERS.WC_NAME FROM V_WORKCENTERS WHERE CON_KPI_WCUSE.WORKCENTER = V_WORKCENTERS.MACHINE","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCUSE SET AVAIL_TIME=(SELECT LEN_MON FROM CON_KPI_WCAVAIL WHERE CON_KPI_WCUSE.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER) WHERE DAYNAME(WORK_DATE)='Monday'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCUSE SET AVAIL_TIME=(SELECT LEN_TUE FROM CON_KPI_WCAVAIL WHERE CON_KPI_WCUSE.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER) WHERE DAYNAME(WORK_DATE)='Tuesday'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCUSE SET AVAIL_TIME=(SELECT LEN_WED FROM CON_KPI_WCAVAIL WHERE CON_KPI_WCUSE.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER) WHERE DAYNAME(WORK_DATE)='Wednesday'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCUSE SET AVAIL_TIME=(SELECT LEN_THU FROM CON_KPI_WCAVAIL WHERE CON_KPI_WCUSE.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER) WHERE DAYNAME(WORK_DATE)='Thursday'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCUSE SET AVAIL_TIME=(SELECT LEN_FRI FROM CON_KPI_WCAVAIL WHERE CON_KPI_WCUSE.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER) WHERE DAYNAME(WORK_DATE)='Friday'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCUSE SET AVAIL_TIME=(SELECT LEN_SAT FROM CON_KPI_WCAVAIL WHERE CON_KPI_WCUSE.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER) WHERE DAYNAME(WORK_DATE)='Saturday'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_WCUSE SET AVAIL_TIME=(SELECT LEN_SUN FROM CON_KPI_WCAVAIL WHERE CON_KPI_WCUSE.WORKCENTER = CON_KPI_WCAVAIL.WORKCENTER) WHERE DAYNAME(WORK_DATE)='Sunday'","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("SELECT * FROM CON_KPI_WCUSE ORDER BY WORK_DATE_N DESC","",V.Local.sSQL)
	F.ODBC.Connection!con.OpenLocalRecordsetRW("rs",V.Local.sSQL)
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rs.EOF,=,True)
			F.Intrinsic.String.Concat("SELECT SUM(PIECES_COMPLTD) FROM V_JOB_DETAIL WHERE MACHINE='{0}' AND DATE_SEQUENCE = '{1}'","",V.Local.sSQL)
			F.Intrinsic.String.Build(V.Local.sSQL,V.ODBC.con!rs.FIELDVALTRIMPSQL!workcenter,V.ODBC.con!rs.FieldValPervasiveDate!work_date_n,V.Local.sSQL)
			F.ODBC.connection!con.ExecuteAndReturn(V.Local.sSQL,V.Local.sret)
			F.ODBC.con!rs.SET!PIECES_COMPLTD(V.Local.sret)

			F.Intrinsic.String.Concat("SELECT SUM(PIECES_SCRAP) FROM V_JOB_DETAIL WHERE MACHINE='{0}' AND DATE_SEQUENCE = '{1}'","",V.Local.sSQL)
			F.Intrinsic.String.Build(V.Local.sSQL,V.ODBC.con!rs.FIELDVALTRIMPSQL!workcenter,V.ODBC.con!rs.FieldValPervasiveDate!work_date_n,V.Local.sSQL)
			F.ODBC.connection!con.ExecuteAndReturn(V.Local.sSQL,V.Local.sret)
			F.ODBC.con!rs.SET!PIECES_SCRAP(V.Local.sret)

			F.Intrinsic.String.Concat("SELECT SUM(HOURS_WORKED) FROM V_JOB_DETAIL  WHERE MACHINE='{0}' AND DATE_SEQUENCE = '{1}'","",V.Local.sSQL)
			F.Intrinsic.String.Build(V.Local.sSQL,V.ODBC.con!rs.FIELDVALTRIMPSQL!workcenter,V.ODBC.con!rs.FieldValPervasiveDate!work_date_n,V.Local.sSQL)
			F.ODBC.connection!con.ExecuteAndReturn(V.Local.sSQL,V.Local.sret)
			F.ODBC.con!rs.SET!HOURS_WORKED(V.Local.sret)
			F.Intrinsic.Math.Add(V.Local.iCount,1,V.Local.iCount)
			F.Intrinsic.Control.If(V.local.iCount,=,100)
				F.Intrinsic.Control.CallSub(Calcwc)
				V.Local.iCount.Set(0)
			F.Intrinsic.Control.EndIf

		F.ODBC.con!rs.MoveNext
	F.Intrinsic.Control.Loop

F.Intrinsic.Control.EndIf

F.Intrinsic.String.Build("{0} -- WC Usage Build Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)


Program.Sub.RoutineWCusage.End

Program.Sub.RoutineIndirectlabor.Start
V.Local.sSQL.Declare(String)
V.Local.squery.Declare(String)

F.Intrinsic.Control.If(V.Global.sRefresh,=,"1")
	F.Intrinsic.String.Concat("DELETE CON_KPI_LABORTYPE where date_sequence>='",V.global.srefreshdate,"'",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)
	F.Intrinsic.String.Concat("insert into CON_KPI_LABORTYPE (DATE_SEQUENCE,DATE_SEQUENCE_N,FLAG_INDIRECT) SELECT DISTINCT DATE_SEQUENCE,DATE_SEQUENCE,FLAG_INDIRECT FROM V_JOB_DETAIL WHERE LMO = 'L' and edited_wo_dtl <> 'Y' and flag_indirect <> '' and date_sequence>='",V.Global.sRefreshDate,"'",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.Control.Else
	F.Intrinsic.String.Concat("DELETE CON_KPI_LABORTYPE","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.Control.If(V.Global.sAlldata,=,1)
		F.Intrinsic.String.Concat("insert into CON_KPI_LABORTYPE (DATE_SEQUENCE,DATE_SEQUENCE_N,FLAG_INDIRECT) SELECT DISTINCT DATE_SEQUENCE,DATE_SEQUENCE,FLAG_INDIRECT FROM V_JOB_DETAIL WHERE LMO = 'L' and edited_wo_dtl <> 'Y' and flag_indirect <> ''","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)
	F.Intrinsic.Control.Else
		F.Intrinsic.String.Concat("insert into CON_KPI_LABORTYPE (DATE_SEQUENCE,DATE_SEQUENCE_N,FLAG_INDIRECT) SELECT DISTINCT DATE_SEQUENCE,DATE_SEQUENCE,FLAG_INDIRECT FROM V_JOB_DETAIL WHERE LMO = 'L' and edited_wo_dtl <> 'Y' and flag_indirect <> '' AND DATE_SEQUENCE BETWEEN '",V.Global.sDateStart,"' AND '",V.Global.sDateEnd,"'",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)
	F.Intrinsic.Control.EndIf

	V.Local.dDate.Declare(Date)
	V.Local.fHours.Declare(Float)
	F.ODBC.CONNECTION!CON.OPENRECORDSETRW("rsKL","SELECT * FROM CON_KPI_LABORTYPE")
	F.INTRINSIC.CONTROL.DOUNTIL(V.ODBC.CON!RSKL.EOF,=,True)
		V.Local.dDate.Set(V.ODBC.con!rsKL.FIELDVALTRIMPSQL!DATE_SEQUENCE)
		F.Intrinsic.String.BUILD("SELECT SUM(HOURS_WORKED) FROM V_JOB_DETAIL WHERE V_JOB_DETAIL.DATE_SEQUENCE = '{0}' AND V_JOB_DETAIL.FLAG_INDIRECT = '{1}'",V.Local.dDate.PervasiveDate,V.ODBC.CON!RSKL.FIELDVALTRIMPSQL!FLAG_INDIRECT,V.Local.sSQL)
		F.ODBC.Connection!con.ExecuteAndReturn(v.Local.sSQL,v.Local.fhours)
		F.ODBC.con!rsKL.Set!HOURS_WORKED(V.local.fHours)
		F.ODBC.CON!RSKL.MOVENEXT
	F.INTRINSIC.CONTROL.LOOP
	F.ODBC.CON!RSKL.CLOSE
F.Intrinsic.Control.EndIf

F.Intrinsic.String.Build("{0} -- Indirect Labor Build Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)


Program.Sub.RoutineIndirectlabor.End

Program.Sub.RoutineARopen.Start
V.Local.sSQL.Declare(String)

F.Intrinsic.Control.If(V.Global.sRefresh,=,"1")
	F.Intrinsic.String.Concat("DELETE CON_KPI_AROPEN where DATE_INVOICE>='",V.Global.sRefreshDate,"'",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_AROPEN (CUSTOMER,INVOICE,DATE_INVOICE) SELECT DISTINCT CUSTOMER,INVOICE,DATE_INVOICE FROM V_AR_OPEN_ITEMS where DATE_INVOICE>='",V.global.sRefreshDate,"'",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("UPDATE CON_KPI_AROPEN SET AMT_INVOICE = (SELECT SUM(AMT_INVOICE) FROM V_AR_OPEN_ITEMS WHERE CON_KPI_AROPEN.CUSTOMER = V_AR_OPEN_ITEMS.CUSTOMER AND CON_KPI_AROPEN.INVOICE = V_AR_OPEN_ITEMS.INVOICE) where DATE_INVOICE>='",V.Global.sRefreshDate,"'",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("DELETE CON_KPI_AROPEN WHERE AMT_INVOICE = 0 and date_invoice>='",V.global.srefreshdate,"'",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)
F.Intrinsic.Control.Else
	F.Intrinsic.Control.If(V.Global.sAlldata,=,1)
		F.Intrinsic.String.Concat("DELETE CON_KPI_AROPEN","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_AROPEN (CUSTOMER,INVOICE,DATE_INVOICE) SELECT DISTINCT CUSTOMER,INVOICE,DATE_INVOICE FROM V_AR_OPEN_ITEMS","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		F.Intrinsic.String.Concat("UPDATE CON_KPI_AROPEN SET AMT_INVOICE = (SELECT SUM(AMT_INVOICE) FROM V_AR_OPEN_ITEMS WHERE CON_KPI_AROPEN.CUSTOMER = V_AR_OPEN_ITEMS.CUSTOMER AND CON_KPI_AROPEN.INVOICE = V_AR_OPEN_ITEMS.INVOICE)","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		F.Intrinsic.String.Concat("DELETE CON_KPI_AROPEN WHERE AMT_INVOICE = 0","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)
	F.Intrinsic.Control.Else
		F.Intrinsic.String.Concat("DELETE CON_KPI_AROPEN","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_AROPEN (CUSTOMER,INVOICE,DATE_INVOICE) SELECT DISTINCT CUSTOMER,INVOICE,DATE_INVOICE FROM V_AR_OPEN_ITEMS where DATE_INVOICE>='",V.global.sdatestart,"'",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		F.Intrinsic.String.Concat("UPDATE CON_KPI_AROPEN SET AMT_INVOICE = (SELECT SUM(AMT_INVOICE) FROM V_AR_OPEN_ITEMS WHERE CON_KPI_AROPEN.CUSTOMER = V_AR_OPEN_ITEMS.CUSTOMER AND CON_KPI_AROPEN.INVOICE = V_AR_OPEN_ITEMS.INVOICE) where DATE_INVOICE>='",V.global.sdatestart,"'",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		F.Intrinsic.String.Concat("DELETE CON_KPI_AROPEN WHERE AMT_INVOICE = 0 and DATE_INVOICE>='",V.Global.sDateStart,"'",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)
	F.Intrinsic.Control.EndIf
F.Intrinsic.Control.EndIf

F.Intrinsic.String.Build("{0} -- AR Build Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)


Program.Sub.RoutineARopen.End

Program.Sub.RoutineAPopen.Start
V.Local.sSQL.Declare(String)
V.Local.sDate1.Declare(String)
V.Local.sDate.Declare(String)
V.Local.sTotal.Declare(String)


F.Intrinsic.Control.If(V.Global.sRefresh,=,"1")
	F.Intrinsic.String.Concat("DELETE CON_KPI_APOPEN WHERE DATE_INVOICE>='",V.Global.sRefreshDate,"'",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("DELETE FROM CON_KPI_APOPEN_TEMP WHERE DATE_INVOICE>='",V.Global.sRefreshDate,"'",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_APOPEN_TEMP (INVOICE,VENDOR,AMT_INVOICE,DATE_INVOICE) SELECT INVOICE, VENDOR, AMT_TRANSACTION,DATE_INVOICE FROM V_AP_OPEN_ITEMS WHERE BATCH_CODE='09' AND AREA='XX' AND DATE_INVOICE>='",V.Global.sRefreshDate,"'",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("DELETE FROM CON_KPI_APOPEN_TEMP WHERE EXISTS(SELECT INVOICE FROM AP_OPEN_ITEMS WHERE AP_OPEN_ITEMS.INVOICE=CON_KPI_APOPEN_TEMP.INVOICE AND AREA='' AND DATE_INVOICE>='",V.Global.sRefreshDate,"');","",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_APOPEN_TEMP (INVOICE,VENDOR,AMT_INVOICE,DATE_INVOICE) SELECT INVOICE, VENDOR, IF(BATCH_CODE='11' OR BATCH_CODE='12',AMT_TRANSACTION*-1,AMT_TRANSACTION) AS TOTAL, DATE_INVOICE FROM V_AP_OPEN_ITEMS WHERE (BATCH_CODE='10' OR BATCH_CODE='11' OR BATCH_CODE='12' OR BATCH_CODE='13' OR BATCH_CODE='17') AND DATE_INVOICE>='",V.Global.sRefreshDate,"'",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_APOPEN (INVOICE, VENDOR,AMT_INVOICE,DATE_INVOICE) SELECT INVOICE, VENDOR, AMT_INVOICE, DATE_INVOICE FROM CON_KPI_APOPEN_TEMP WHERE DATE_INVOICE>='",V.Global.sRefreshDate,"'",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.sSQL)
F.Intrinsic.Control.Else
	F.Intrinsic.Control.If(V.Global.sAlldata,=,1)
		F.Intrinsic.String.Concat("DELETE CON_KPI_APOPEN","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		F.Intrinsic.String.Concat("DELETE FROM CON_KPI_APOPEN_TEMP","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_APOPEN_TEMP (INVOICE,VENDOR,AMT_INVOICE,DATE_INVOICE) SELECT INVOICE, VENDOR, AMT_TRANSACTION,DATE_INVOICE FROM V_AP_OPEN_ITEMS WHERE BATCH_CODE='09' AND AREA='XX';","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		F.Intrinsic.String.Concat("DELETE FROM CON_KPI_APOPEN_TEMP WHERE EXISTS(SELECT INVOICE FROM AP_OPEN_ITEMS WHERE AP_OPEN_ITEMS.INVOICE=CON_KPI_APOPEN_TEMP.INVOICE AND AREA='');","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_APOPEN_TEMP (INVOICE,VENDOR,AMT_INVOICE,DATE_INVOICE) SELECT INVOICE, VENDOR, IF(BATCH_CODE='11' OR BATCH_CODE='12',AMT_TRANSACTION*-1,AMT_TRANSACTION) AS TOTAL, DATE_INVOICE FROM V_AP_OPEN_ITEMS WHERE BATCH_CODE='10' OR BATCH_CODE='11' OR BATCH_CODE='12' OR BATCH_CODE='13' OR BATCH_CODE='17';","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_APOPEN (INVOICE, VENDOR,AMT_INVOICE,DATE_INVOICE) SELECT INVOICE, VENDOR, AMT_INVOICE, DATE_INVOICE FROM CON_KPI_APOPEN_TEMP;","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)
	F.Intrinsic.Control.Else
		F.Intrinsic.String.Concat("DELETE CON_KPI_APOPEN","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		F.Intrinsic.String.Concat("DELETE FROM CON_KPI_APOPEN_TEMP","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_APOPEN_TEMP (INVOICE,VENDOR,AMT_INVOICE,DATE_INVOICE) SELECT INVOICE, VENDOR, AMT_TRANSACTION,DATE_INVOICE FROM V_AP_OPEN_ITEMS WHERE BATCH_CODE='09' AND AREA='XX' AND DATE_INVOICE>='",V.Global.sDateSTart,"'",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		F.Intrinsic.String.Concat("DELETE FROM CON_KPI_APOPEN_TEMP WHERE EXISTS(SELECT INVOICE FROM AP_OPEN_ITEMS WHERE AP_OPEN_ITEMS.INVOICE=CON_KPI_APOPEN_TEMP.INVOICE AND AREA='' AND DATE_INVOICE>='",V.global.sDateStart,"');","",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_APOPEN_TEMP (INVOICE,VENDOR,AMT_INVOICE,DATE_INVOICE) SELECT INVOICE, VENDOR, IF(BATCH_CODE='11' OR BATCH_CODE='12',AMT_TRANSACTION*-1,AMT_TRANSACTION) AS TOTAL, DATE_INVOICE FROM V_AP_OPEN_ITEMS WHERE (BATCH_CODE='10' OR BATCH_CODE='11' OR BATCH_CODE='12' OR BATCH_CODE='13' OR BATCH_CODE='17') AND DATE_INVOICE>='",V.global.sDateStart,"'",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_APOPEN (INVOICE, VENDOR,AMT_INVOICE,DATE_INVOICE) SELECT INVOICE, VENDOR, AMT_INVOICE, DATE_INVOICE FROM CON_KPI_APOPEN_TEMP WHERE DATE_INVOICE>='",V.global.sDateStart,"'",V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)

	F.Intrinsic.Control.EndIf

F.Intrinsic.Control.EndIf

F.Intrinsic.String.Build("{0} -- AP Build Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)

Program.Sub.RoutineAPopen.End

Program.Sub.RoutineDirectIndirect.Start
V.Local.squery.Declare(String)

F.Intrinsic.UI.ChangeWaitStatus("Processing Direct / Indirect Labour", 50, 0, 100)

F.Intrinsic.Control.If(V.Global.sRefresh,=,"1")
	F.INTRINSIC.STRING.CONCAT("DELETE FROM CON_KPI_DIR_IND WHERE MONTH>='",V.GLOBAL.sRefreshMth,"' AND YEAR>='",V.global.srefreshyr,"'",V.local.squery)
	F.ODBC.Connection!con.Execute(V.local.squery)
	
	F.Intrinsic.String.Concat("insert into CON_KPI_DIR_IND (HOURS_WORKED,YEAR,MONTH,DIRECT_INDIRECT) select sum(hours_worked) as total, LEFT(CHARGE_DATE,4) AS MyYear, Substring(Charge_date,5,2) as MyMonth, 'I' AS Category  FROM JOB_HIST_DTL where CHARGE_DATE>='",V.global.srefreshdate,"' and flag_indirect='I' AND employee<>'UNATTENDED O/H' GROUP by MyYear, MyMonth","",V.Local.squery)
	F.Intrinsic.UI.ChangeWaitStatus("Processing Direct / Indirect Labour - Active", 50, 0, 100)
	F.ODBC.Connection!con.Execute(V.Local.squery)
	
	F.Intrinsic.String.Concat("insert into CON_KPI_DIR_IND (HOURS_WORKED,YEAR,MONTH,DIRECT_INDIRECT) select sum(hours_worked) as total, LEFT(CHARGE_DATE,4) AS MyYear, Substring(Charge_date,5,2) as MyMonth, 'I' AS Category  FROM JOB_DETAIL where CHARGE_DATE>='",V.global.srefreshdate,"' and flag_indirect='I' AND employee<>'UNATTENDED O/H' GROUP by MyYear, MyMonth","",V.Local.squery)
	F.Intrinsic.UI.ChangeWaitStatus("Processing Direct / Indirect Labour - History", 50, 0, 100)
	F.ODBC.Connection!con.Execute(V.Local.squery)
	
	F.Intrinsic.String.Concat("insert into CON_KPI_DIR_IND (HOURS_WORKED,YEAR,MONTH,DIRECT_INDIRECT) select sum(hours_worked) as total, LEFT(CHARGE_DATE,4) AS MyYear, Substring(Charge_date,5,2) as MyMonth, 'D' AS Category  FROM JOB_HIST_DTL where CHARGE_DATE>='",V.global.srefreshdate,"' and flag_indirect<>'I' and LMO='L' AND employee<>'UNATTENDED O/H' GROUP by MyYear, MyMonth","",V.Local.squery)
	F.Intrinsic.UI.ChangeWaitStatus("Processing Direct / Indirect Labour - Active", 50, 0, 100)
	F.ODBC.Connection!con.Execute(V.Local.squery)
	
	F.Intrinsic.String.Concat("insert into CON_KPI_DIR_IND (HOURS_WORKED,YEAR,MONTH,DIRECT_INDIRECT) select sum(hours_worked) as total, LEFT(CHARGE_DATE,4) AS MyYear, Substring(Charge_date,5,2) as MyMonth, 'D' AS Category  FROM JOB_DETAIL where  CHARGE_DATE>='",V.global.srefreshdate,"' and flag_indirect<>'I' and LMO='L' AND employee<>'UNATTENDED O/H' GROUP by MyYear, MyMonth","",V.Local.squery)
	F.Intrinsic.UI.ChangeWaitStatus("Processing Direct / Indirect Labour - History", 50, 0, 100)
	F.ODBC.Connection!con.Execute(V.Local.squery)
	
	F.intrinsic.string.concat("DELETE FROM CON_KPI_INDIRECT_SUM WHERE MONTH>='",V.GLOBAL.sRefreshMth,"' AND YEAR>='",V.global.srefreshyr,"'",V.local.squery)
	F.ODBC.Connection!con.Execute(V.local.squery)
	F.Intrinsic.UI.ChangeWaitStatus("Processing Indirect Summary", 50, 0, 100)
	F.ODBC.Connection!con.OpenRecordsetRO("rsINDWO","select * from V_IND_LBR_ACCTS")
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsINDWO.EOF,=,True)
			F.Intrinsic.String.Concat("insert into CON_KPI_INDIRECT_SUM (HOURS_WORKED, YEAR, MONTH, JOB, SUFFIX, SEQUENCE,DESCRIPTION)","",V.Local.squery)
			F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY," select sum(TB1.hours_worked) as total, LEFT(TB1.CHARGE_DATE,4) AS MyYear, Substring(TB1.Charge_date,5,2) as MyMonth,   TB1.job, TB1.suffix, TB1.seq, TB2.DESCRIPTION  FROM JOB_DETAIL TB1 left join JOB_OPERATIONS TB2 ON TB1.JOB = TB2.JOB AND TB1.SUFFIX = TB2.SUFFIX and tb1.seq = tb2.seq where tb1.JOB='",V.odbc.con!rsINDWO.FIELDVALTRIMPSQL!JOB,"' AND tb1.SUFFIX='",V.odbc.con!rsINDWO.FIELDVALTRIMPSQL!SUFFIX,"' AND tb1.SEQ='",V.odbc.con!rsINDWO.FIELDVALTRIMPSQL!SEQUENCE,"' AND flag_indirect='I' and TB1.CHARGE_DATE>'",V.GLOBAL.srefreshdate,"' GROUP by MyYear, MyMonth, TB1.job, TB1.suffix, TB1.seq, TB2.description",V.LOCAL.SQUERY)
			F.Intrinsic.UI.ChangeWaitStatus("Processing Indirect Summary - Active", 50, 0, 100)
			F.ODBC.connection!con.Execute(V.Local.squery)
			F.Intrinsic.String.Concat("insert into CON_KPI_INDIRECT_SUM (HOURS_WORKED, YEAR, MONTH, JOB, SUFFIX, SEQUENCE,DESCRIPTION) ","",V.LOCAL.SQUERY)
			F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY,"select sum(TB1.hours_worked) as total, LEFT(TB1.CHARGE_DATE,4) AS MyYear, Substring(TB1.Charge_date,5,2)","",V.LOCAL.SQUERY)
			F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY,"as MyMonth,  TB1.job, TB1.suffix, TB1.seq, TB2.DESCRIPTION  FROM JOB_HIST_DTL TB1 ",V.LOCAL.SQUERY)
			F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY,"left join JOB_HIST_OPS TB2 ON TB1.JOB = TB2.JOB AND TB1.SUFFIX = TB2.SUFFIX and ",V.LOCAL.SQUERY)
			F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY,"tb1.seq = tb2.seq where tb1.JOB='",V.odbc.con!rsINDWO.FIELDVALTRIMPSQL!JOB,"' ",V.LOCAL.SQUERY)
			F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY,"AND tb1.SUFFIX='",V.odbc.con!rsINDWO.FIELDVALTRIMPSQL!SUFFIX,"' AND ",V.LOCAL.SQUERY)
			F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY,"tb1.SEQ='",V.odbc.con!rsINDWO.FIELDVALTRIMPSQL!SEQUENCE,"' AND flag_indirect='I' AND ",V.LOCAL.SQUERY)
			F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY,"TB1.CHARGE_DATE>='",V.global.srefreshdate,"' GROUP by MyYear, MyMonth, TB1.job, ",V.LOCAL.SQUERY)
			F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY,"TB1.suffix, TB1.seq, TB2.description","",V.Local.squery)
			F.Intrinsic.UI.ChangeWaitStatus("Processing Indirect Summary - History", 50, 0, 100)
			F.ODBC.connection!con.Execute(V.Local.squery)

		F.ODBC.con!rsINDWO.MoveNext
	F.Intrinsic.Control.Loop
		
F.Intrinsic.Control.Else
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_DIR_IND")
	F.Intrinsic.Control.If(V.Global.sAlldata,=,1)
		F.Intrinsic.String.Concat("insert into CON_KPI_DIR_IND (HOURS_WORKED,YEAR,MONTH,DIRECT_INDIRECT) select sum(hours_worked) as total, LEFT(CHARGE_DATE,4) AS MyYear, Substring(Charge_date,5,2) as MyMonth, 'I' AS Category  FROM JOB_HIST_DTL where flag_indirect='I' AND employee<>'UNATTENDED O/H' GROUP by MyYear, MyMonth","",V.Local.squery)
		F.Intrinsic.UI.ChangeWaitStatus("Processing Direct / Indirect Labour - Active", 50, 0, 100)
		F.ODBC.Connection!con.Execute(V.Local.squery)
		F.Intrinsic.String.Concat("insert into CON_KPI_DIR_IND (HOURS_WORKED,YEAR,MONTH,DIRECT_INDIRECT) select sum(hours_worked) as total, LEFT(CHARGE_DATE,4) AS MyYear, Substring(Charge_date,5,2) as MyMonth, 'I' AS Category  FROM JOB_DETAIL where flag_indirect='I' AND employee<>'UNATTENDED O/H' GROUP by MyYear, MyMonth","",V.Local.squery)
		F.Intrinsic.UI.ChangeWaitStatus("Processing Direct / Indirect Labour - History", 50, 0, 100)
		F.ODBC.Connection!con.Execute(V.Local.squery)
		F.Intrinsic.String.Concat("insert into CON_KPI_DIR_IND (HOURS_WORKED,YEAR,MONTH,DIRECT_INDIRECT) select sum(hours_worked) as total, LEFT(CHARGE_DATE,4) AS MyYear, Substring(Charge_date,5,2) as MyMonth, 'D' AS Category  FROM JOB_HIST_DTL WHERE flag_indirect<>'I' and LMO='L' AND employee<>'UNATTENDED O/H' GROUP by MyYear, MyMonth","",V.Local.squery)
		F.Intrinsic.UI.ChangeWaitStatus("Processing Direct / Indirect Labour - Active", 50, 0, 100)
		F.ODBC.Connection!con.Execute(V.Local.squery)
		F.Intrinsic.String.Concat("insert into CON_KPI_DIR_IND (HOURS_WORKED,YEAR,MONTH,DIRECT_INDIRECT) select sum(hours_worked) as total, LEFT(CHARGE_DATE,4) AS MyYear, Substring(Charge_date,5,2) as MyMonth, 'D' AS Category  FROM JOB_DETAIL WHERE flag_indirect<>'I' and LMO='L' AND employee<>'UNATTENDED O/H' GROUP by MyYear, MyMonth","",V.Local.squery)
		F.Intrinsic.UI.ChangeWaitStatus("Processing Direct / Indirect Labour - History", 50, 0, 100)
		F.ODBC.Connection!con.Execute(V.Local.squery)
	F.Intrinsic.Control.Else
		F.Intrinsic.String.Concat("insert into CON_KPI_DIR_IND (HOURS_WORKED,YEAR,MONTH,DIRECT_INDIRECT) select sum(hours_worked) as total, LEFT(CHARGE_DATE,4) AS MyYear, Substring(Charge_date,6,2) as MyMonth, 'I' AS Category  FROM V_JOB_HIST_DTL where flag_indirect='I' AND Charge_date BETWEEN '",V.Global.sDateStart,"' AND '",V.Global.sDateEnd,"' AND employee<>'UNATTENDED O/H' GROUP by MyYear, MyMonth","",V.Local.squery)
		F.ODBC.Connection!con.Execute(V.Local.squery)
		F.Intrinsic.String.Concat("insert into CON_KPI_DIR_IND (HOURS_WORKED,YEAR,MONTH,DIRECT_INDIRECT) select sum(hours_worked) as total, LEFT(CHARGE_DATE,4) AS MyYear, Substring(Charge_date,6,2) as MyMonth, 'I' AS Category  FROM V_JOB_DETAIL where flag_indirect='I' AND Charge_date BETWEEN '",V.Global.sDateStart,"' AND '",V.Global.sDateEnd,"' AND employee<>'UNATTENDED O/H' GROUP by MyYear, MyMonth","",V.Local.squery)
		F.ODBC.Connection!con.Execute(V.Local.squery)
		F.Intrinsic.String.Concat("insert into CON_KPI_DIR_IND (HOURS_WORKED,YEAR,MONTH,DIRECT_INDIRECT) select sum(hours_worked) as total, LEFT(CHARGE_DATE,4) AS MyYear, Substring(Charge_date,6,2) as MyMonth, 'D' AS Category  FROM V_JOB_HIST_DTL where  flag_indirect<>'I' and LMO='L' AND Charge_date BETWEEN '",V.Global.sDateStart,"' AND '",V.Global.sDateEnd,"' AND employee<>'UNATTENDED O/H' GROUP by MyYear, MyMonth","",V.Local.squery)
		F.ODBC.Connection!con.Execute(V.Local.squery)
		F.Intrinsic.String.Concat("insert into CON_KPI_DIR_IND (HOURS_WORKED,YEAR,MONTH,DIRECT_INDIRECT) select sum(hours_worked) as total, LEFT(CHARGE_DATE,4) AS MyYear, Substring(Charge_date,6,2) as MyMonth, 'D' AS Category  FROM V_JOB_DETAIL where   flag_indirect<>'I' and LMO='L' AND Charge_date BETWEEN '",V.Global.sDateStart,"' AND '",V.Global.sDateEnd,"' AND employee<>'UNATTENDED O/H' GROUP by MyYear, MyMonth","",V.Local.squery)
		F.ODBC.Connection!con.Execute(V.Local.squery)
	F.Intrinsic.Control.EndIf

	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_INDIRECT_SUM")
	F.Intrinsic.UI.ChangeWaitStatus("Processing Indirect Summary", 50, 0, 100)
	F.ODBC.Connection!con.OpenRecordsetRO("rsINDWO","select * from V_IND_LBR_ACCTS")
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsINDWO.EOF,=,True)
		F.Intrinsic.Control.If(V.Global.sAlldata,=,1)
			F.Intrinsic.String.Concat("insert into CON_KPI_INDIRECT_SUM (HOURS_WORKED, YEAR, MONTH, JOB, SUFFIX, SEQUENCE,DESCRIPTION)","",V.Local.squery)
			F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY," select sum(TB1.hours_worked) as total, LEFT(TB1.CHARGE_DATE,4) AS MyYear, Substring(TB1.Charge_date,5,2) as MyMonth,  TB1.job, TB1.suffix, TB1.seq, TB2.DESCRIPTION  FROM JOB_DETAIL TB1 left join JOB_OPERATIONS TB2 ON TB1.JOB = TB2.JOB AND TB1.SUFFIX = TB2.SUFFIX and tb1.seq = tb2.seq where tb1.JOB='",V.odbc.con!rsINDWO.FIELDVALTRIMPSQL!JOB,"' AND tb1.SUFFIX='",V.odbc.con!rsINDWO.FIELDVALTRIMPSQL!SUFFIX,"' AND tb1.SEQ='",V.odbc.con!rsINDWO.FIELDVALTRIMPSQL!SEQUENCE,"' AND flag_indirect='I' GROUP by MyYear, MyMonth, TB1.job, TB1.suffix, TB1.seq, TB2.description",V.LOCAL.SQUERY)
			F.Intrinsic.UI.ChangeWaitStatus("Processing Indirect Summary - Active", 50, 0, 100)
			F.ODBC.connection!con.Execute(V.Local.squery)
			F.Intrinsic.String.Concat("insert into CON_KPI_INDIRECT_SUM (HOURS_WORKED, YEAR, MONTH, JOB, SUFFIX, SEQUENCE,DESCRIPTION) select sum(TB1.hours_worked) as total, LEFT(TB1.CHARGE_DATE,4) AS MyYear, Substring(TB1.Charge_date,5,2) as MyMonth,  TB1.job, TB1.suffix, TB1.seq, TB2.DESCRIPTION  FROM JOB_HIST_DTL TB1 left join JOB_HIST_OPS TB2 ON TB1.JOB = TB2.JOB AND TB1.SUFFIX = TB2.SUFFIX and tb1.seq = tb2.seq where tb1.JOB='",V.odbc.con!rsINDWO.FIELDVALTRIMPSQL!JOB,"' AND tb1.SUFFIX='",V.odbc.con!rsINDWO.FIELDVALTRIMPSQL!SUFFIX,"' AND tb1.SEQ='",V.odbc.con!rsINDWO.FIELDVALTRIMPSQL!SEQUENCE,"' AND flag_indirect='I' GROUP by MyYear, MyMonth, TB1.job, TB1.suffix, TB1.seq, TB2.description","",V.Local.squery)
			F.Intrinsic.UI.ChangeWaitStatus("Processing Indirect Summary - History", 50, 0, 100)
			F.ODBC.connection!con.Execute(V.Local.squery)
		F.Intrinsic.Control.Else
			F.Intrinsic.String.Concat("insert into CON_KPI_INDIRECT_SUM (HOURS_WORKED, YEAR, MONTH, JOB, SUFFIX, SEQUENCE,DESCRIPTION)","",V.local.squery)
			F.intrinsic.string.concat(V.local.squery," select sum(TB1.hours_worked) as total, LEFT(TB1.CHARGE_DATE,4) AS MyYear, Substring(TB1.Charge_date,6,2) as MyMonth,  TB1.job, TB1.suffix, TB1.seq, TB2.DESCRIPTION  FROM V_JOB_DETAIL TB1 left join JOB_OPERATIONS TB2 ON TB1.JOB = TB2.JOB AND TB1.SUFFIX = TB2.SUFFIX and tb1.seq = tb2.seq where tb1.JOB='",V.odbc.con!rsINDWO.FIELDVALTRIMPSQL!JOB,"' AND tb1.SUFFIX='",V.odbc.con!rsINDWO.FIELDVALTRIMPSQL!SUFFIX,"' AND tb1.SEQ='",V.odbc.con!rsINDWO.FIELDVALTRIMPSQL!SEQUENCE,"' AND flag_indirect='I' AND Charge_date BETWEEN '",V.Global.sDateStart,"' AND '",V.Global.sDateEnd,"' GROUP by MyYear, MyMonth, TB1.job, TB1.suffix, TB1.seq, TB2.description","",V.Local.squery)
			F.Intrinsic.UI.ChangeWaitStatus("Processing Indirect Summary - Active", 50, 0, 100)
			F.ODBC.connection!con.Execute(V.Local.squery)
			F.Intrinsic.String.Concat("insert into CON_KPI_INDIRECT_SUM (HOURS_WORKED, YEAR, MONTH, JOB, SUFFIX, SEQUENCE,DESCRIPTION) select sum(TB1.hours_worked) as total, LEFT(TB1.CHARGE_DATE,4) AS MyYear, Substring(TB1.Charge_date,6,2) as MyMonth,  TB1.job, TB1.suffix, TB1.seq, TB2.DESCRIPTION  FROM V_JOB_HIST_DTL TB1 left join JOB_HIST_OPS TB2 ON TB1.JOB = TB2.JOB AND TB1.SUFFIX = TB2.SUFFIX and tb1.seq = tb2.seq where tb1.JOB='",V.odbc.con!rsINDWO.FIELDVALTRIMPSQL!JOB,"' AND tb1.SUFFIX='",V.odbc.con!rsINDWO.FIELDVALTRIMPSQL!SUFFIX,"' AND tb1.SEQ='",V.odbc.con!rsINDWO.FIELDVALTRIMPSQL!SEQUENCE,"' AND flag_indirect='I' AND Charge_date BETWEEN '",V.Global.sDateStart,"' AND '",V.Global.sDateEnd,"' GROUP by MyYear, MyMonth, TB1.job, TB1.suffix, TB1.seq, TB2.description","",V.Local.squery)
			F.Intrinsic.UI.ChangeWaitStatus("Processing Indirect Summary - History", 50, 0, 100)
			F.ODBC.connection!con.Execute(V.Local.squery)
		F.Intrinsic.Control.EndIf
		F.ODBC.con!rsINDWO.MoveNext
	F.Intrinsic.Control.Loop
f.in.control.endif

F.Intrinsic.String.Build("{0} -- Direct/Indirect Build Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)

Program.Sub.RoutineDirectIndirect.End

Program.Sub.RoutineQuality2.Start
V.Local.squery.Declare(String)

F.Intrinsic.Control.If(V.Global.sRefresh,=,"1")
	F.Intrinsic.String.Concat("DELETE FROM CON_KPI_QUALITY2 WHERE DATE>='",V.Global.sRefreshDate,"'",V.Local.squery)
	F.ODBC.Connection!con.Execute(V.Local.squery)

	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_QUALITY2 (CONTROLNO, DATE,SEQ,WO,WOSUFFIX,WOSEQ,PARTNO,WC,EMPLOYEENAME,DISCREPANCY,QUANTITY,DOLLARS,DISPOSITIONACTION,VENDORNAME,SCRAPCODE,EMPLOYEEDEPT,MONTH_INT,YEAR_INT) ","",V.Local.squery)
	F.Intrinsic.string.concat(V.local.SQUERY,"select TB2.CONTROL_NUMBER, TB2.DATE_DISPOSED, TB2.DISPOSITION_SEQ,  TB1.JOB, TB1.SUFFIX, TB1.SEQUENCE, TB1.PART, TB1.WORKCENTER,","",V.local.squery)
	F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY,"TB1.EMPLOYEE_NAME, TB2.DISCREPANCY,TB2.QTY_DISPOSED, TB2.DISPOSED_VALUE,TB2.DISPOSITION_ACTION, TB1.NAME, TB1.SCRAP_CODE, TB1.EMPLOYEE_DEPT,MONTH(TB2.DATE_DISPOSED),YEAR(TB2.DATE_DISPOSED) ",V.LOCAL.SQUERY)
	F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY,"from V_QUALITY TB1 LEFT JOIN V_QUALITY_DISP TB2 ON TB1.CONTROL_NUMBER = TB2.CONTROL_NUMBER WHERE DATE_DISPOSED>='",V.Global.sRefreshDate,"'",V.LOCAL.SQUERY)
	F.ODBC.Connection!con.Execute(V.Local.squery)

F.Intrinsic.Control.Else
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_QUALITY2")
	F.Intrinsic.Control.If(V.Global.sAlldata,=,1)
		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_QUALITY2 (CONTROLNO, DATE,SEQ,WO,WOSUFFIX,WOSEQ,PARTNO,WC,EMPLOYEENAME,DISCREPANCY,QUANTITY,DOLLARS,DISPOSITIONACTION,VENDORNAME,SCRAPCODE,EMPLOYEEDEPT,MONTH_INT,YEAR_INT) ","",V.Local.squery)
		F.Intrinsic.string.concat(V.local.SQUERY,"select TB2.CONTROL_NUMBER, TB2.DATE_DISPOSED, TB2.DISPOSITION_SEQ,  TB1.JOB, TB1.SUFFIX, TB1.SEQUENCE, TB1.PART, TB1.WORKCENTER,","",V.local.squery)
		F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY,"TB1.EMPLOYEE_NAME, TB2.DISCREPANCY,TB2.QTY_DISPOSED, TB2.DISPOSED_VALUE,TB2.DISPOSITION_ACTION, TB1.NAME, TB1.SCRAP_CODE, TB1.EMPLOYEE_DEPT,MONTH(TB2.DATE_DISPOSED),YEAR(TB2.DATE_DISPOSED) ",V.LOCAL.SQUERY)
		F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY,"from V_QUALITY TB1 LEFT JOIN V_QUALITY_DISP TB2 ON TB1.CONTROL_NUMBER = TB2.CONTROL_NUMBER",V.LOCAL.SQUERY)
	F.Intrinsic.Control.Else
		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_QUALITY2 (CONTROLNO, DATE,SEQ,WO,WOSUFFIX,WOSEQ,PARTNO,WC,EMPLOYEENAME,DISCREPANCY,QUANTITY,DOLLARS,DISPOSITIONACTION,VENDORNAME,SCRAPCODE,EMPLOYEEDEPT,MONTH_INT,YEAR_INT) ","",V.Local.squery)
		F.Intrinsic.string.concat(V.local.SQUERY,"select TB2.CONTROL_NUMBER, TB2.DATE_DISPOSED, TB2.DISPOSITION_SEQ,  TB1.JOB, TB1.SUFFIX, TB1.SEQUENCE, TB1.PART, TB1.WORKCENTER,","",V.local.squery)
		F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY,"TB1.EMPLOYEE_NAME, TB2.DISCREPANCY,TB2.QTY_DISPOSED, TB2.DISPOSED_VALUE,TB2.DISPOSITION_ACTION, TB1.NAME, TB1.SCRAP_CODE, TB1.EMPLOYEE_DEPT,MONTH(TB2.DATE_DISPOSED),YEAR(TB2.DATE_DISPOSED) ",V.LOCAL.SQUERY)
		F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY,"from V_QUALITY TB1 LEFT JOIN V_QUALITY_DISP TB2 ON TB1.CONTROL_NUMBER = TB2.CONTROL_NUMBER and tb2.DATE_DISPOSED BETWEEN '",V.Global.sDateStart,"' AND '",V.Global.sDateEnd,"' ",V.LOCAL.SQUERY)
	F.Intrinsic.Control.EndIf
	F.ODBC.Connection!con.Execute(V.Local.squery)
F.Intrinsic.Control.EndIf


V.Local.squery.Set("")
F.Intrinsic.String.Concat("UPDATE CON_KPI_QUALITY2 SET DISCREPANCYNAME=(SELECT DISCREP_CODE FROM V_QUALITY_DISCRP_CD WHERE DISCREP_CODE=CON_KPI_QUALITY2.DISCREPANCY)","",V.Local.squery)
F.ODBC.Connection!con.Execute(V.Local.squery)

F.Intrinsic.String.Build("{0} -- Quality 2, Discrepancy Build Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)


Program.Sub.RoutineQuality2.End

Program.Sub.RoutineDupont.Start
V.Local.sSnippetCash.Declare(String)
V.Local.sSnippetRaw.Declare(String)
V.Local.sSnippetFG.Declare(String)
V.Local.sSnippetWIP.Declare(String)
V.Local.sSnippetAR.Declare(String)
V.Local.sSnippetOtherCA.Declare(String)
V.Local.sSnippetFA.Declare(String)
V.Local.sSnippetAP.Declare(String)
V.Local.sSnippetOtherCL.Declare(String)
V.Local.sSnippetLongTerm.Declare(String)
V.Local.sSnippetSales.Declare(String)
V.Local.sSnippetCogsFre.Declare(String)
V.Local.sSnippetCogsLab.Declare(String)
V.Local.sSnippetCogsOut.Declare(String)
V.Local.sSnippetCogsOth.Declare(String)
V.Local.sSnippetCogsOvh.Declare(String)
V.Local.sSnippetCogsMat.Declare(String)
V.Local.sSnippetVarExp.Declare(String)
V.Local.sSnippetFixExp.Declare(String)
V.Local.sSnippetTaxes.Declare(String)
V.Local.sSnippetShares.Declare(String)

V.Local.sSnippetCash2.Declare(String)
V.Local.sSnippetRaw2.Declare(String)
V.Local.sSnippetFG2.Declare(String)
V.Local.sSnippetWIP2.Declare(String)
V.Local.sSnippetAR2.Declare(String)
V.Local.sSnippetOtherCA2.Declare(String)
V.Local.sSnippetFA2.Declare(String)
V.Local.sSnippetAP2.Declare(String)
V.Local.sSnippetOtherCL2.Declare(String)
V.Local.sSnippetLongTerm2.Declare(String)
V.Local.sSnippetSales2.Declare(String)
V.Local.sSnippetCogsFre2.Declare(String)
V.Local.sSnippetCogsLab2.Declare(String)
V.Local.sSnippetCogsOut2.Declare(String)
V.Local.sSnippetCogsOth2.Declare(String)
V.Local.sSnippetCogsOvh2.Declare(String)
V.Local.sSnippetCogsMat2.Declare(String)
V.Local.sSnippetVarExp2.Declare(String)
V.Local.sSnippetFixExp2.Declare(String)
V.Local.sSnippetTaxes2.Declare(String)
V.Local.sSnippetShares2.Declare(String)
V.LOCAL.STEMP.DECLARE(String)
V.LOCAL.SGL.DECLARE(String)

V.Local.sSQL.Declare(String)

F.ODBC.connection!con.Execute("DELETE FROM CON_KPI_DUPONT_DATA")

F.Intrinsic.String.Concat("insert into CON_KPI_DUPONT_DATA (YEAR,MONTH) SELECT DISTINCT YEAR(POST_DATE) AS MYYEAR,MONTH(POST_DATE) AS MYMONTH FROM V_GL_DETAIL ","  GROUP BY GL_ACCOUNT, MYYEAR,MYMONTH",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_DUPONT_TEMP")
F.Intrinsic.String.Concat("INSERT INTO CON_KPI_DUPONT_TEMP (GL_ACCOUNT, TOTAL, YEAR,MONTH) select GL_ACCOUNT,SUM(AMOUNT) AS TOTAL,YEAR(POST_DATE) AS MYYEAR, MONTH(POST_DATE) AS MYMONTH from V_GL_DETAIL","  GROUP BY GL_ACCOUNT, MYYEAR,MYMONTH",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

V.Local.ssql.set("INSERT INTO CON_KPI_DUPONT_TEMP (GL_ACCOUNT, TOTAL, YEAR,MONTH) select ACCT_NUMBER,SUM(AMOUNT) AS TOTAL,YEAR(POST_DATE) AS MYYEAR, MONTH(POST_DATE) AS MYMONTH from V_GL_PR_DETAIL GROUP BY ACCT_NUMBER, MYYEAR,MYMONTH")
F.ODBC.Connection!CON.Execute(V.Local.sSQL)

F.ODBC.Connection!con.OpenLocalRecordsetRO("rs","SELECT * FROM CON_KPI_GL_ACCOUNTS")
F.Intrinsic.Control.DoUntil(V.ODBC.con!rs.EOF,=,True)

	F.INTRINSIC.STRING.TRIM(V.ODBC.CON!RS.FIELDVALTRIMPSQL!ACCOUNT_TYPE,V.LOCAL.STEMP)
	F.INTRINSIC.STRING.TRIM(V.ODBC.CON!RS.FIELDVALTRIMPSQL!GL_ACCOUNT,V.LOCAL.SGL)
	F.Intrinsic.Control.If(V.LOCAL.STEMP,=,"Cash")
		F.Intrinsic.String.concat(V.Local.sSnippetCash," OR GL_ACCOUNT='",V.LOCAL.SGL,"'",V.Local.sSnippetCash)
	F.Intrinsic.Control.ElseIf(V.LOCAL.STEMP,=,"Accounts Payable")
		F.Intrinsic.String.concat(V.Local.sSnippetAP," OR GL_ACCOUNT='",V.LOCAL.SGL,"'",V.Local.sSnippetAP)
	F.Intrinsic.Control.ElseIf(V.LOCAL.STEMP,=,"Accounts Receivable")
		F.Intrinsic.String.concat(V.Local.sSnippetAR," OR GL_ACCOUNT='",V.LOCAL.SGL,"'",V.Local.sSnippetAR)
	F.Intrinsic.Control.ElseIf(V.LOCAL.STEMP,=,"Cost of Goods Sold - Freight")
		F.Intrinsic.String.concat(V.Local.sSnippetCogsFre," OR GL_ACCOUNT='",V.LOCAL.SGL,"'",V.Local.sSnippetCogsFre)
	F.Intrinsic.Control.ElseIf(V.LOCAL.STEMP,=,"Cost of Goods Sold - Labor")
		F.Intrinsic.String.concat(V.Local.sSnippetCogsLab," OR GL_ACCOUNT='",V.LOCAL.SGL,"'",V.Local.sSnippetCogsLab)
	F.Intrinsic.Control.ElseIf(V.LOCAL.STEMP,=,"Cost of Goods Sold - Outside")
		F.Intrinsic.String.concat(V.Local.sSnippetCogsOut," OR GL_ACCOUNT='",V.LOCAL.SGL,"'",V.Local.sSnippetCogsOut)
	F.Intrinsic.Control.ElseIf(V.LOCAL.STEMP,=,"Cost of Goods Sold - Overhead")
		F.Intrinsic.String.concat(V.Local.sSnippetCogsOvh," OR GL_ACCOUNT='",V.LOCAL.SGL,"'",V.Local.sSnippetCogsOvh)
	F.Intrinsic.Control.ElseIf(V.LOCAL.STEMP,=,"Cost of Goods Sold - Other")
		F.Intrinsic.String.concat(V.Local.sSnippetCogsOth," OR GL_ACCOUNT='",V.LOCAL.SGL,"'",V.Local.sSnippetCogsOth)
	F.Intrinsic.Control.ElseIf(V.LOCAL.STEMP,=,"Cost of Goods Sold - Material")
		F.Intrinsic.String.concat(V.Local.sSnippetCogsMat," OR GL_ACCOUNT='",V.LOCAL.SGL,"'",V.Local.sSnippetCogsMat)
	F.Intrinsic.Control.ElseIf(V.LOCAL.STEMP,=,"Inventory - Finished Good")
		F.Intrinsic.String.concat(V.Local.sSnippetFG," OR GL_ACCOUNT='",V.LOCAL.SGL,"'",V.Local.sSnippetFG)
	F.Intrinsic.Control.ElseIf(V.LOCAL.STEMP,=,"Inventory - Raw Material")
		F.Intrinsic.String.concat(V.Local.sSnippetRaw," OR GL_ACCOUNT='",V.LOCAL.SGL,"'",V.Local.sSnippetRaw)
	F.Intrinsic.Control.ElseIf(V.LOCAL.STEMP,=,"Inventory - Work In Progress")
		F.Intrinsic.String.concat(V.Local.sSnippetWIP," OR GL_ACCOUNT='",V.LOCAL.SGL,"'",V.Local.sSnippetWIP)
	F.Intrinsic.Control.ElseIf(V.LOCAL.STEMP,=,"Fixed Assets")
		F.Intrinsic.String.concat(V.Local.sSnippetFA," OR GL_ACCOUNT='",V.LOCAL.SGL,"'",V.Local.sSnippetFA)
	F.Intrinsic.Control.ElseIf(V.LOCAL.STEMP,=,"Fixed Expenses")
		F.Intrinsic.String.concat(V.Local.sSnippetFixExp," OR GL_ACCOUNT='",V.LOCAL.SGL,"'",V.Local.sSnippetFixExp)
	F.Intrinsic.Control.ElseIf(V.LOCAL.STEMP,=,"Long-Term Debt")
		F.Intrinsic.String.concat(V.Local.sSnippetLongTerm," OR GL_ACCOUNT='",V.LOCAL.SGL,"'",V.Local.sSnippetLongTerm)
	F.Intrinsic.Control.ElseIf(V.LOCAL.STEMP,=,"Other Current Assets")
		F.Intrinsic.String.concat(V.Local.sSnippetOtherCA," OR GL_ACCOUNT='",V.LOCAL.SGL,"'",V.Local.sSnippetOtherCA)
	F.Intrinsic.Control.ElseIf(V.LOCAL.STEMP,=,"Other Current Liabilities")
		F.Intrinsic.String.concat(V.Local.sSnippetOtherCL," OR GL_ACCOUNT='",V.LOCAL.SGL,"'",V.Local.sSnippetOtherCL)
	F.Intrinsic.Control.ElseIf(V.LOCAL.STEMP,=,"Revenue")
		F.Intrinsic.String.concat(V.Local.sSnippetSales," OR GL_ACCOUNT='",V.LOCAL.SGL,"'",V.Local.sSnippetSales)
	F.Intrinsic.Control.ElseIf(V.LOCAL.STEMP,=,"Shares")
			F.Intrinsic.String.concat(V.Local.sSnippetShares," OR GL_ACCOUNT='",V.LOCAL.SGL,"'",V.Local.sSnippetShares)
	F.Intrinsic.Control.ElseIf(V.LOCAL.STEMP,=,"Taxes")
		F.Intrinsic.String.concat(V.Local.sSnippetTaxes," OR GL_ACCOUNT='",V.LOCAL.SGL,"'",V.Local.sSnippetTaxes)
	F.Intrinsic.Control.ElseIf(V.LOCAL.STEMP,=,"Variable Expenses")
		F.Intrinsic.String.concat(V.Local.sSnippetVarExp," OR GL_ACCOUNT='",V.LOCAL.SGL,"'",V.Local.sSnippetVarExp)
	F.Intrinsic.Control.EndIf
	
	F.ODBC.con!rs.MoveNext
F.Intrinsic.Control.Loop
V.Local.smonth.Declare(String)
V.Local.sret.Declare(String)
F.ODBC.Connection!con.ExecuteAndReturn("select month(beg_date) from V_CON_KPI_CALENDAR where period='01'",V.Local.sret)
V.Local.svalues.Declare(String)
F.Intrinsic.String.Split(V.Local.sret,"*!*",V.Local.svalues)
V.Local.smonth.Set(V.Local.svalues(0))
'F.Intrinsic.UI.Msgbox(V.Local.smonth)
V.local.sfyear.declare(String)
V.Local.lminyear.Declare(Long)
V.Local.lminmonth.Declare(Long)
F.ODBC.Connection!con.ExecuteAndReturn("SELECT MIN(YEAR) FROM CON_KPI_DUPONT_DATA",V.Local.lminyear)
F.ODBC.Connection!con.ExecuteAndReturn("SELECT MIN(MONTH) FROM CON_KPI_DUPONT_DATA",V.Local.lminmonth)

V.Local.smessage.Declare(String)
V.Local.syear.Declare(String)


F.ODBC.Connection!con.OpenLocalRecordsetRW("rsDD","SELECT * FROM CON_KPI_DUPONT_DATA ORDER BY YEAR, MONTH")
F.Intrinsic.Control.DoUntil(V.ODBC.con!rsDD.EOF,=,True)
	F.intrinsic.string.concat("SELECT start_year FROM V_CON_KPI_CALENDAR WHERE month(beg_date)='",V.odbc.con!rsdd.FIELDVALTRIMPSQL!month,"' AND YEAR(beg_date)='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"'",V.LOCAL.stemp)
	F.odbc.connection!con.executeandreturn(V.local.stemp,V.local.sfyear)
	'F.Intrinsic.String.Concat("fiscal yr = ",V.Local.sfyear," | post month/yr= ",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!YEAR,"/",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,V.Local.smessage)
	'F.Intrinsic.UI.Msgbox(V.Local.smessage)
	
	'F.Intrinsic.UI.Msgbox(V.ODBC.con!rsDD.FIELDVALTRIMPSQL!YEAR)
	V.Local.sSQL.Set("")
	F.intrinsic.string.concat("UPDATE CON_KPI_DUPONT_DATA SET CASH=(SELECT SUM(TOTAL) AS TOTAL FROM CON_KPI_DUPONT_TEMP WHERE (GL_ACCOUNT='' ",V.local.sSnippetCash,") AND YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"') WHERE YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"';",V.Local.sSQL)
	F.ODBC.connection!con.Execute(V.Local.sSQL)

	F.intrinsic.string.concat("UPDATE CON_KPI_DUPONT_DATA SET RAW=(SELECT SUM(TOTAL) AS TOTAL FROM CON_KPI_DUPONT_TEMP WHERE (GL_ACCOUNT='' ",V.local.sSnippetRaw,") AND YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"') WHERE YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"';",V.Local.sSQL)
	F.ODBC.connection!con.Execute(V.Local.sSQL)

	F.intrinsic.string.concat("UPDATE CON_KPI_DUPONT_DATA SET FG=(SELECT SUM(TOTAL) AS TOTAL FROM CON_KPI_DUPONT_TEMP WHERE (GL_ACCOUNT='' ",V.local.sSnippetFG,") AND YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"') WHERE YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"';",V.Local.sSQL)
	F.ODBC.connection!con.Execute(V.Local.sSQL)

	F.intrinsic.string.concat("UPDATE CON_KPI_DUPONT_DATA SET WIP=(SELECT SUM(TOTAL) AS TOTAL FROM CON_KPI_DUPONT_TEMP WHERE (GL_ACCOUNT='' ",V.local.sSnippetWIP,") AND YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"') WHERE YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"';",V.Local.sSQL)
	F.ODBC.connection!con.Execute(V.Local.sSQL)

	F.intrinsic.string.concat("UPDATE CON_KPI_DUPONT_DATA SET AR=(SELECT SUM(TOTAL) AS TOTAL FROM CON_KPI_DUPONT_TEMP WHERE (GL_ACCOUNT='' ",V.local.sSnippetAR,") AND YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"') WHERE YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"';",V.Local.sSQL)
	F.ODBC.connection!con.Execute(V.Local.sSQL)

	F.intrinsic.string.concat("UPDATE CON_KPI_DUPONT_DATA SET OTHER_ASSET=(SELECT SUM(TOTAL) AS TOTAL FROM CON_KPI_DUPONT_TEMP WHERE (GL_ACCOUNT='' ",V.local.sSnippetOtherCA,") AND YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"') WHERE YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"';",V.Local.sSQL)
	F.ODBC.connection!con.Execute(V.Local.sSQL)

	F.intrinsic.string.concat("UPDATE CON_KPI_DUPONT_DATA SET FIXED_ASSET=(SELECT SUM(TOTAL) AS TOTAL FROM CON_KPI_DUPONT_TEMP WHERE (GL_ACCOUNT='' ",V.local.sSnippetFA,") AND YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"') WHERE YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"';",V.LOCAL.SSQL)
	F.ODBC.connection!con.Execute(V.Local.sSQL)

	F.intrinsic.string.concat("UPDATE CON_KPI_DUPONT_DATA SET AP=(SELECT SUM(TOTAL) AS TOTAL FROM CON_KPI_DUPONT_TEMP WHERE (GL_ACCOUNT='' ",V.local.sSnippetAP,") AND YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"') WHERE YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"';",V.local.sSQL)
	F.ODBC.connection!con.Execute(V.Local.sSQL)

	F.intrinsic.string.concat("UPDATE CON_KPI_DUPONT_DATA SET OTHER_CURRENT=(SELECT SUM(TOTAL) AS TOTAL FROM CON_KPI_DUPONT_TEMP WHERE (GL_ACCOUNT='' ",V.local.sSnippetOtherCL,") AND YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"') WHERE YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"';",V.Local.sSQL)
	F.ODBC.connection!con.Execute(V.Local.sSQL)

	F.intrinsic.string.concat("UPDATE CON_KPI_DUPONT_DATA SET LONG_TERM_DEBT=(SELECT SUM(TOTAL) AS TOTAL FROM CON_KPI_DUPONT_TEMP WHERE (GL_ACCOUNT='' ",V.local.sSnippetLongTerm,") AND YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"') WHERE YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"';",V.Local.sSQL)
	F.ODBC.connection!con.Execute(V.Local.sSQL)

	F.intrinsic.string.concat("UPDATE CON_KPI_DUPONT_DATA SET SALES=(SELECT SUM(TOTAL) AS TOTAL FROM CON_KPI_DUPONT_TEMP WHERE (GL_ACCOUNT='' ",V.local.sSnippetSales,") AND YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"') WHERE YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"';",V.Local.sSQL)
	F.ODBC.connection!con.Execute(V.Local.sSQL)

	F.intrinsic.string.concat("UPDATE CON_KPI_DUPONT_DATA SET COGS_FREIGHT=(SELECT SUM(TOTAL) AS TOTAL FROM CON_KPI_DUPONT_TEMP WHERE (GL_ACCOUNT='' ",V.local.sSnippetCogsFre,") AND YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"') WHERE YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"';",V.Local.sSQL)
	F.ODBC.connection!con.Execute(V.Local.sSQL)

	F.intrinsic.string.concat("UPDATE CON_KPI_DUPONT_DATA SET COGS_LABOR=(SELECT SUM(TOTAL) AS TOTAL FROM CON_KPI_DUPONT_TEMP WHERE (GL_ACCOUNT='' ",V.local.sSnippetCogsLab,") AND YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"') WHERE YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"';",V.Local.sSQL)
	F.ODBC.connection!con.Execute(V.Local.sSQL)

	F.intrinsic.string.concat("UPDATE CON_KPI_DUPONT_DATA SET COGS_OUTSIDE=(SELECT SUM(TOTAL) AS TOTAL FROM CON_KPI_DUPONT_TEMP WHERE (GL_ACCOUNT='' ",V.local.sSnippetCogsOut,") AND YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"') WHERE YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"';",V.Local.sSQL)
	F.ODBC.connection!con.Execute(V.Local.sSQL)

	F.intrinsic.string.concat("UPDATE CON_KPI_DUPONT_DATA SET COGS_OVERHEAD=(SELECT SUM(TOTAL) AS TOTAL FROM CON_KPI_DUPONT_TEMP WHERE (GL_ACCOUNT='' ",V.local.sSnippetCogsOvh,") AND YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"') WHERE YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"';",V.Local.sSQL)
	F.ODBC.connection!con.Execute(V.Local.sSQL)

	F.intrinsic.string.concat("UPDATE CON_KPI_DUPONT_DATA SET COGS_OTHER=(SELECT SUM(TOTAL) AS TOTAL FROM CON_KPI_DUPONT_TEMP WHERE (GL_ACCOUNT='' ",V.local.sSnippetCogsOth,") AND YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"') WHERE YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"';",V.Local.sSQL)
	F.ODBC.connection!con.Execute(V.Local.sSQL)

	F.intrinsic.string.concat("UPDATE CON_KPI_DUPONT_DATA SET COGS_MATERIAL=(SELECT SUM(TOTAL) AS TOTAL FROM CON_KPI_DUPONT_TEMP WHERE (GL_ACCOUNT='' ",V.local.sSnippetCogsMat,") AND YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"') WHERE YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"';",V.Local.sSQL)
	F.ODBC.connection!con.Execute(V.Local.sSQL)

	F.intrinsic.string.concat("UPDATE CON_KPI_DUPONT_DATA SET VARIABLE_EXPENSES=(SELECT SUM(TOTAL) AS TOTAL FROM CON_KPI_DUPONT_TEMP WHERE (GL_ACCOUNT='' ",V.local.sSnippetVarExp,") AND YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"') WHERE YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"';",V.Local.sSQL)
	F.ODBC.connection!con.Execute(V.Local.sSQL)

	F.intrinsic.string.concat("UPDATE CON_KPI_DUPONT_DATA SET FIXED_EXPENSES=(SELECT SUM(TOTAL) AS TOTAL FROM CON_KPI_DUPONT_TEMP WHERE (GL_ACCOUNT='' ",V.local.sSnippetFixExp,") AND YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"') WHERE YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"';",V.Local.sSQL)
	F.ODBC.connection!con.Execute(V.Local.sSQL)

	F.intrinsic.string.concat("UPDATE CON_KPI_DUPONT_DATA SET TAXES=(SELECT SUM(TOTAL) AS TOTAL FROM CON_KPI_DUPONT_TEMP WHERE (GL_ACCOUNT='' ",V.local.sSnippetTaxes,") AND YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"') WHERE YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"';",V.Local.sSQL)
	F.ODBC.connection!con.Execute(V.Local.sSQL)

	F.intrinsic.string.concat("UPDATE CON_KPI_DUPONT_DATA SET SHARES=(SELECT SUM(TOTAL) AS TOTAL FROM CON_KPI_DUPONT_TEMP WHERE (GL_ACCOUNT='' ",V.local.sSnippetShares,") AND YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"') WHERE YEAR='",V.ODBC.CON!RSDD.FIELDVALTRIMPSQL!YEAR,"' AND MONTH = '",V.ODBC.con!rsDD.FIELDVALTRIMPSQL!MONTH,"';",V.Local.sSQL)
	F.ODBC.connection!con.Execute(V.Local.sSQL)

	F.ODBC.con!rsDD.MoveNext
F.Intrinsic.Control.Loop
F.ODBC.Connection!con.ExecuteAndReturn("select BEG_BAL from V_GL_BALANCES where type='S'",V.Local.sret)


F.Intrinsic.String.Replace(V.Local.sSnippetRaw,"GL_ACCOUNT","ACCT",V.Local.sSnippetRaw2)
F.intrinsic.string.concat("DELETE FROM CON_KPI_DUPONT_DATA WHERE MONTH=0 ","",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.SSQL)


F.intrinsic.string.concat("INSERT INTO CON_KPI_DUPONT_DATA (RAW,YEAR,MONTH) SELECT sum(BEG_BAL),'",V.local.lminyear,"','0' FROM V_GL_BALANCES WHERE (ACCT='' ",V.local.sSnippetRaw2,") AND TYPE='S'",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.SSQL)

F.Intrinsic.String.Replace(V.Local.sSnippetFG,"GL_ACCOUNT","ACCT",V.Local.sSnippetFG2)
F.intrinsic.string.concat("update CON_KPI_DUPONT_DATA SET FG=(SELECT sum(BEG_BAL) FROM V_GL_BALANCES WHERE (ACCT='' ",V.local.sSnippetFG2,") AND TYPE='S') WHERE MONTH='0' AND YEAR='",V.local.lminyear,"'",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.sSQL)

F.Intrinsic.String.Replace(V.Local.sSnippetWIP,"GL_ACCOUNT","ACCT",V.Local.sSnippetWIP2)
F.intrinsic.string.concat("update CON_KPI_DUPONT_DATA SET WIP=(SELECT sum(BEG_BAL) FROM V_GL_BALANCES WHERE (ACCT='' ",V.local.sSnippetWIP2,") AND TYPE='S') WHERE MONTH='0' AND YEAR='",V.local.lminyear,"'",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.local.ssql)

F.Intrinsic.String.Replace(V.Local.sSnippetAR,"GL_ACCOUNT","ACCT",V.Local.sSnippetAR2)
F.intrinsic.string.concat("update CON_KPI_DUPONT_DATA SET AR=(SELECT sum(BEG_BAL)  FROM V_GL_BALANCES WHERE (ACCT='' ",V.local.sSnippetAR2,") AND TYPE='S') WHERE MONTH='0' AND YEAR='",V.local.lminyear,"'",V.Local.sSQL)
F.ODBC.Connection!con.execute(V.Local.ssql)

F.Intrinsic.String.Replace(V.Local.sSnippetOtherCA,"GL_ACCOUNT","ACCT",V.Local.sSnippetOtherCA2)
F.intrinsic.string.concat("update CON_KPI_DUPONT_DATA SET OTHER_ASSET=(SELECT sum(BEG_BAL)  FROM V_GL_BALANCES WHERE (ACCT='' ",V.local.sSnippetOtherCA2,") AND TYPE='S') WHERE MONTH='0' AND YEAR='",V.local.lminyear,"'",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.ssql)

F.Intrinsic.String.Replace(V.Local.sSnippetFA,"GL_ACCOUNT","ACCT",V.Local.sSnippetFA2)
F.intrinsic.string.concat("update CON_KPI_DUPONT_DATA SET FIXED_ASSET=(SELECT sum(BEG_BAL) FROM V_GL_BALANCES WHERE (ACCT='' ",V.local.sSnippetFA2,") AND TYPE='S') WHERE MONTH='0' AND YEAR='",V.local.lminyear,"'",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.local.ssql)

F.Intrinsic.String.Replace(V.Local.sSnippetAP,"GL_ACCOUNT","ACCT",V.Local.sSnippetAP2)
F.intrinsic.string.concat("update CON_KPI_DUPONT_DATA SET AP=(SELECT sum(BEG_BAL)  FROM V_GL_BALANCES WHERE (ACCT='' ",V.local.sSnippetAP2,") AND TYPE='S') WHERE MONTH='0' AND YEAR='",V.local.lminyear,"'",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.ssql)

F.Intrinsic.String.Replace(V.Local.sSnippetOtherCL,"GL_ACCOUNT","ACCT",V.Local.sSnippetOtherCL2)
F.intrinsic.string.concat("update CON_KPI_DUPONT_DATA SET OTHER_CURRENT=(SELECT sum(BEG_BAL)  FROM V_GL_BALANCES WHERE (ACCT='' ",V.local.sSnippetOtherCL2,") AND TYPE='S') WHERE MONTH='0' AND YEAR='",V.local.lminyear,"'",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.ssql)

F.Intrinsic.String.Replace(V.Local.sSnippetLongTerm,"GL_ACCOUNT","ACCT",V.Local.sSnippetLongTerm2)
F.intrinsic.string.concat("update CON_KPI_DUPONT_DATA SET LONG_TERM_DEBT=(SELECT sum(BEG_BAL)  FROM V_GL_BALANCES WHERE (ACCT='' ",V.local.sSnippetLongTerm2,") AND TYPE='S') WHERE MONTH='0' AND YEAR='",V.local.lminyear,"'",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.ssql)

F.Intrinsic.String.Replace(V.Local.sSnippetSales,"GL_ACCOUNT","ACCT",V.Local.sSnippetSales2)
F.intrinsic.string.concat("update CON_KPI_DUPONT_DATA SET SALES=(SELECT sum(BEG_BAL)  FROM V_GL_BALANCES WHERE (ACCT='' ",V.local.sSnippetSales2,") AND TYPE='S') WHERE MONTH='0' AND YEAR='",V.local.lminyear,"'",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.local.ssql)

F.Intrinsic.String.Replace(V.Local.sSnippetCogsFre,"GL_ACCOUNT","ACCT",V.Local.sSnippetCogsFre2)
F.intrinsic.string.concat("update CON_KPI_DUPONT_DATA SET COGS_FREIGHT=(SELECT sum(BEG_BAL)  FROM V_GL_BALANCES WHERE (ACCT='' ",V.local.sSnippetCogsFre2,") AND TYPE='S') WHERE MONTH='0' AND YEAR='",V.local.lminyear,"'",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.ssql)

F.Intrinsic.String.Replace(V.Local.sSnippetCogsLab,"GL_ACCOUNT","ACCT",V.Local.sSnippetCogsLab2)
F.intrinsic.string.concat("update CON_KPI_DUPONT_DATA SET COGS_LABOR=(SELECT sum(BEG_BAL) FROM V_GL_BALANCES WHERE (ACCT='' ",V.local.sSnippetCogsLab2,") AND TYPE='S') WHERE MONTH='0' AND YEAR='",V.local.lminyear,"'",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.ssql)

F.Intrinsic.String.Replace(V.Local.sSnippetCogsOut,"GL_ACCOUNT","ACCT",V.Local.sSnippetCogsOut2)
F.intrinsic.string.concat("update CON_KPI_DUPONT_DATA SET COGS_OUTSIDE=(SELECT sum(BEG_BAL)  FROM V_GL_BALANCES WHERE (ACCT='' ",V.local.sSnippetCogsOut2,") AND TYPE='S') WHERE MONTH='0' AND YEAR='",V.local.lminyear,"'",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.ssql)

F.Intrinsic.String.Replace(V.Local.sSnippetCogsOvh,"GL_ACCOUNT","ACCT",V.Local.sSnippetCogsOvh2)
F.intrinsic.string.concat("update CON_KPI_DUPONT_DATA SET COGS_OVERHEAD=(SELECT sum(BEG_BAL)  FROM V_GL_BALANCES WHERE (ACCT='' ",V.local.sSnippetCogsOvh2,") AND TYPE='S') WHERE MONTH='0' AND YEAR='",V.local.lminyear,"'",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.ssql)

F.Intrinsic.String.Replace(V.Local.sSnippetCogsOth,"GL_ACCOUNT","ACCT",V.Local.sSnippetCogsOth2)
F.intrinsic.string.concat("update CON_KPI_DUPONT_DATA SET COGS_OTHER=(SELECT sum(BEG_BAL)  FROM V_GL_BALANCES WHERE (ACCT='' ",V.local.sSnippetCogsOth2,") AND TYPE='S') WHERE MONTH='0' AND YEAR='",V.local.lminyear,"'",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.ssql)

F.Intrinsic.String.Replace(V.Local.sSnippetCogsMat,"GL_ACCOUNT","ACCT",V.Local.sSnippetCogsMat2)
F.intrinsic.string.concat("update CON_KPI_DUPONT_DATA SET COGS_MATERIAL=(SELECT sum(BEG_BAL)  FROM V_GL_BALANCES WHERE (ACCT='' ",V.local.sSnippetCogsMat2,") AND TYPE='S') WHERE MONTH='0' AND YEAR='",V.local.lminyear,"'",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.ssql)

F.Intrinsic.String.Replace(V.Local.sSnippetVarExp,"GL_ACCOUNT","ACCT",V.Local.sSnippetVarExp2)
F.intrinsic.string.concat("update CON_KPI_DUPONT_DATA SET VARIABLE_EXPENSES=(SELECT sum(BEG_BAL) FROM V_GL_BALANCES WHERE (ACCT='' ",V.local.sSnippetVarExp2,") AND TYPE='S') WHERE MONTH='0' AND YEAR='",V.local.lminyear,"'",V.Local.sSQL)
F.ODBC.Connection!con.Execute(V.Local.ssql)

F.Intrinsic.String.Replace(V.Local.sSnippetFixExp,"GL_ACCOUNT","ACCT",V.Local.sSnippetFixExp2)
F.intrinsic.string.concat("update CON_KPI_DUPONT_DATA SET FIXED_EXPENSES=(SELECT sum(BEG_BAL)  FROM V_GL_BALANCES WHERE (ACCT='' ",V.local.sSnippetFixExp2,") AND TYPE='S') WHERE MONTH='0' AND YEAR='",V.local.lminyear,"'",V.Local.sSQL)
F.ODBC.connection!con.Execute(V.Local.ssql)

F.Intrinsic.String.Replace(V.Local.sSnippetTaxes,"GL_ACCOUNT","ACCT",V.Local.sSnippetTaxes2)
F.intrinsic.string.concat("update CON_KPI_DUPONT_DATA SET TAXES=(SELECT sum(BEG_BAL) FROM V_GL_BALANCES WHERE (ACCT='' ",V.local.sSnippetTaxes2,") AND TYPE='S') WHERE MONTH='0' AND YEAR='",V.local.lminyear,"'",V.Local.sSQL)
F.ODBC.connection!con.Execute(V.Local.ssql)

F.Intrinsic.String.Replace(V.Local.sSnippetShares,"GL_ACCOUNT","ACCT",V.Local.sSnippetShares2)
F.intrinsic.string.concat("update CON_KPI_DUPONT_DATA SET SHARES=(SELECT sum(BEG_BAL)  FROM V_GL_BALANCES WHERE (ACCT='' ",V.local.sSnippetShares2,") AND TYPE='S') WHERE MONTH='0' AND YEAR='",V.local.lminyear,"'",V.Local.sSQL)
F.ODBC.connection!con.Execute(V.Local.ssql)
	
F.Intrinsic.String.Replace(V.Local.sSnippetCash,"GL_ACCOUNT","ACCT",V.Local.sSnippetCash2)
F.intrinsic.string.concat("update CON_KPI_DUPONT_DATA SET CASH=(SELECT sum(BEG_BAL)  FROM V_GL_BALANCES WHERE (ACCT='' ",V.local.sSnippetCash2,") AND TYPE='S') WHERE MONTH='0' AND YEAR='",V.local.lminyear,"'",V.Local.sSQL)
F.ODBC.connection!con.Execute(V.Local.sSQL)

F.ODBC.con!rs.Close

F.Intrinsic.String.Build("{0} -- Dupont Build Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)


Program.Sub.RoutineDupont.End

Program.Sub.z_sub_routine.Start
V.Local.ssql.Declare(String)
F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET NAME=(SELECT NAME_CUSTOMER FROM V_CUSTOMER_MASTER WHERE CUSTOMER=CON_KPI_SALES.CUSTOMER)","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)

F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET CATEGORY=(SELECT IF(TOP10=1,'TOP10',IF(RISINGSTAR=1,'RISING STAR',IF(TARGET=1,'TARGET',IF(OTHER=1,'OTHER','')))) FROM CON_KPI_CUSTOMER WHERE CON_KPI_CUSTOMER.CUSTOMER=CON_KPI_SALES.CUSTOMER)","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)

'F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET SALESMAN=(SELECT SALESPERSON FROM V_CUSTOMER_MASTER WHERE CUSTOMER=CON_KPI_SALES.CUSTOMER)","",V.Local.ssql)
'F.ODBC.Connection!con.Execute(V.Local.ssql)

F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET INDUSTRY_CODE=(SELECT IFNULL(CODE_SIC,'') FROM V_CUSTOMER_SALES WHERE CUSTOMER=CON_KPI_SALES.CUSTOMER)","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)

F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET REGION=(SELECT IFNULL(COUNTRY,'') from V_ORDER_BILL_TO WHERE ORDER_NO=CON_KPI_SALES.ORDER_NO)","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)

F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET COST=COST*(QTY)","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)

F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET BUDGET=(SELECT ifnull(BUDGET,0) AS BUDGET FROM CON_KPI_CUSTOMER WHERE CUSTOMER=CON_KPI_SALES.CUSTOMER)","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)

F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET BUDGET_PERCENT= IF(BUDGET=0,0,IF(BUDGET=0,0,ROUND((SALES/BUDGET)*100,2)))","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)

F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET GM_DOLLAR=(SALES-(COST))","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)

V.Local.fOverhead.Declare(Float)
F.ODBC.CONNECTION!CON.ExecuteAndReturn("SELECT OH FROM CON_KPI_SETUP",V.LOCAL.FOVERHEAD)
F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET OH=(GM_DOLLAR*",V.LOCAL.FOVERHEAD,")","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)

F.Intrinsic.string.Concat("UPDATE CON_KPI_SALES SET EBITDA=(GM_DOLLAR-OH)","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)

F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET EBITDA_PERCENT=IF(EBITDA=0,0,IF(SALES=0,0,(EBITDA/SALES)*100))","",V.Local.ssql)
F.ODBC.connection!con.execute(V.Local.ssql)

F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET OPEN_ORDERS=(SELECT ifnull(SUM(EXTENSION),0) AS DOLLAR_TOTAL FROM V_ORDER_LINES WHERE ORDER_NO=CON_KPI_SALES.ORDER_NO)","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)

F.Intrinsic.String.Concat("UPDATE CON_KPI_SALES SET OO_LINES=(SELECT ifnull(COUNT(ORDER_NO),0) AS LINE_COUNT FROM V_ORDER_LINES WHERE ORDER_NO=CON_KPI_SALES.ORDER_NO)","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)

Program.Sub.z_sub_routine.End

Program.Sub.z_sub_routine_jobsActv.Start
V.Local.squery.Declare(String)

''Update Jobs
'Start with Active Labour
F.INTRINSIC.STRING.CONCAT("SELECT JOB, SUFFIX, LMO, sum(hours_estimated) as hours_estimated, sum(hours_actual) as hours_actual, sum(dollars_estimated) as dollars_est, sum(dollars_actual) as dollars_act ","",V.LOCAL.SQUERY)
F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY,"FROM V_JOB_OPERATIONS WHERE LMO='L' ",V.global.saddon," GROUP BY job, suffix, LMO",V.LOCAL.SQUERY)
F.ODBC.CONNECTION!CON.OPENRECORDSETRW("RSJOBOP",V.LOCAL.SQUERY)
F.INTRINSIC.CONTROL.DOUNTIL(V.ODBC.CON!RSJOBOP.EOF,=,True)
	F.Intrinsic.String.Concat("UPDATE CON_KPI_JOBS_EST_ACT SET ESTLABOUR=",V.odbc.con!rsjobop.FIELDVALTRIMPSQL!DOLLARS_EST,", ",V.Local.squery)
	F.Intrinsic.String.Concat(V.local.squery," ACTLABOUR=",V.ODBC.con!rsJOBOP.FIELDVALTRIMPSQL!DOLLARS_ACT,", ",V.local.SQUERY)
	F.Intrinsic.String.Concat(V.Local.squery," ESTLABOHHRS=",V.ODBC.con!rsJOBOP.FIELDVALTRIMPSQL!HOURS_ESTIMATED,", ",V.Local.squery)
	F.Intrinsic.String.Concat(V.Local.squery," ACTLABOHHRS=",V.ODBC.con!rsJOBOP.FIELDVALTRIMPSQL!HOURS_ACTUAL," ",V.Local.squery)
	F.intrinsic.STRING.concat(V.local.SQUERY," WHERE JOB='",V.ODBC.con!rsjobop.FIELDVALTRIMPSQL!JOB,"'",V.Local.squery)
	F.Intrinsic.String.Concat(V.Local.squery,"  AND SUFFIX='",V.odbc.con!rsjobop.FIELDVALTRIMPSQL!SUFFIX,"'",V.Local.squery)
	F.ODBC.Connection!con.Execute(V.Local.squery)
	F.ODBC.CON!RSJOBOP.MoveNext
F.INTRINSIC.CONTROL.Loop
F.ODBC.con!rsJOBOP.Close

'Then active material
F.INTRINSIC.STRING.CONCAT("SELECT JOB, SUFFIX, LMO, sum(hours_estimated) as hours_estimated, sum(hours_actual) as hours_actual, sum(dollars_estimated) as dollars_est, sum(dollars_actual) as dollars_act ","",V.LOCAL.SQUERY)
F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY,"FROM V_JOB_OPERATIONS WHERE LMO='M' ",V.global.saddon,"  GROUP BY job, suffix, LMO",V.LOCAL.SQUERY)
F.ODBC.CONNECTION!CON.OPENRECORDSETRW("RSJOBOP",V.LOCAL.SQUERY)
F.INTRINSIC.CONTROL.DOUNTIL(V.ODBC.CON!RSJOBOP.EOF,=,True)
	F.Intrinsic.String.Concat("UPDATE CON_KPI_JOBS_EST_ACT SET ESTMATERIAL=",V.odbc.con!rsjobop.FIELDVALTRIMPSQL!DOLLARS_EST,", ",V.Local.squery)
	F.Intrinsic.String.Concat(V.local.squery," ACTMATERIAL=",V.ODBC.con!rsJOBOP.FIELDVALTRIMPSQL!DOLLARS_ACT," WHERE JOB='",V.ODBC.con!rsjobop.FIELDVALTRIMPSQL!JOB,"'",V.Local.squery)
	F.Intrinsic.String.Concat(V.Local.squery,"  AND SUFFIX='",V.odbc.con!rsjobop.FIELDVALTRIMPSQL!SUFFIX,"'",V.Local.squery)
	F.ODBC.Connection!con.Execute(V.Local.squery)
	F.ODBC.CON!RSJOBOP.MoveNext
F.INTRINSIC.CONTROL.Loop
F.ODBC.con!rsJOBOP.Close

'Then Outside Processes material
F.INTRINSIC.STRING.CONCAT("SELECT JOB, SUFFIX, LMO, sum(hours_estimated) as hours_estimated, sum(hours_actual) as hours_actual, sum(dollars_estimated) as dollars_est, sum(dollars_actual) as dollars_act ","",V.LOCAL.SQUERY)
F.INTRINSIC.STRING.CONCAT(V.LOCAL.SQUERY,"FROM V_JOB_OPERATIONS WHERE LMO='O' ",V.global.saddon,"  GROUP BY job, suffix, LMO",V.LOCAL.SQUERY)
F.ODBC.CONNECTION!CON.OPENRECORDSETRW("RSJOBOP",V.LOCAL.SQUERY)
F.INTRINSIC.CONTROL.DOUNTIL(V.ODBC.CON!RSJOBOP.EOF,=,True)
	F.Intrinsic.String.Concat("UPDATE CON_KPI_JOBS_EST_ACT SET ESTOUTSIDE=",V.odbc.con!rsjobop.FIELDVALTRIMPSQL!DOLLARS_EST,", ",V.Local.squery)
	F.Intrinsic.String.Concat(V.local.squery," ACTOUTSIDE=",V.ODBC.con!rsJOBOP.FIELDVALTRIMPSQL!DOLLARS_ACT," WHERE JOB='",V.ODBC.con!rsjobop.FIELDVALTRIMPSQL!JOB,"'",V.Local.squery)
	F.Intrinsic.String.Concat(V.Local.squery,"  AND SUFFIX='",V.odbc.con!rsjobop.FIELDVALTRIMPSQL!SUFFIX,"'",V.Local.squery)
	F.ODBC.Connection!con.Execute(V.Local.squery)
	F.ODBC.CON!RSJOBOP.MoveNext
F.INTRINSIC.CONTROL.Loop
F.ODBC.con!rsJOBOP.Close

Program.Sub.z_sub_routine_jobsActv.End

Program.Sub.z_sub_routine_jobsHist.Start
V.Local.squery.Declare(String)

'Update hist Jobs
'Start with Labour
V.Local.squery.Set("")
F.Intrinsic.String.Concat("SELECT TB1.job, TB1.suffix,  LMO, sum(TB1.hours_estimated) as hours_estimated, sum(TB1.hours_actual) as hours_actual,","",V.Local.squery)
F.Intrinsic.String.Concat(V.Local.squery,"sum(TB1.dollars_estimated) as dollars_est, sum(TB1.dollars_actual) as dollars_act ",V.local.squery)
F.Intrinsic.String.Concat(V.Local.squery,"FROM V_JOB_HIST_OPS AS TB1 WHERE LMO='L' ",V.global.saddon," group by job, suffix, LMO",V.Local.squery)

F.ODBC.connection!con.OpenRecordsetRW("rsJOBOP",V.local.squery)
F.Intrinsic.Control.DoUntil(V.ODBC.con!rsJOBOP.EOF,=,True)
	F.Intrinsic.String.Concat("UPDATE CON_KPI_JOBS_EST_ACT SET ESTLABOUR=",V.odbc.con!rsjobop.FIELDVALTRIMPSQL!DOLLARS_EST,", ",V.Local.squery)
	F.Intrinsic.String.Concat(V.local.squery," ACTLABOUR=",V.ODBC.con!rsJOBOP.FIELDVALTRIMPSQL!DOLLARS_ACT,", ",V.local.SQUERY)
	F.Intrinsic.String.Concat(V.Local.squery," ESTLABOHHRS=",V.ODBC.con!rsJOBOP.FIELDVALTRIMPSQL!HOURS_ESTIMATED,", ",V.Local.squery)
	F.Intrinsic.String.Concat(V.Local.squery," ACTLABOHHRS=",V.ODBC.con!rsJOBOP.FIELDVALTRIMPSQL!HOURS_ACTUAL," ",V.Local.squery)
	F.intrinsic.STRING.concat(V.local.SQUERY," WHERE JOB='",V.ODBC.con!rsjobop.FIELDVALTRIMPSQL!JOB,"'",V.Local.squery)
	F.Intrinsic.String.Concat(V.Local.squery,"  AND SUFFIX='",V.odbc.con!rsjobop.FIELDVALTRIMPSQL!SUFFIX,"'",V.Local.squery)
	F.ODBC.Connection!con.Execute(V.Local.squery)
	F.ODBC.con!rsJOBOP.MoveNext
F.Intrinsic.Control.Loop
F.ODBC.con!rsJOBOP.Close

'Then material
V.Local.squery.Set("")
F.Intrinsic.String.Concat("SELECT TB1.job, TB1.suffix,  LMO, sum(TB1.hours_estimated) as hours_estimated, sum(TB1.hours_actual) as hours_actual,","",V.Local.squery)
F.Intrinsic.String.Concat(V.Local.squery,"sum(TB1.dollars_estimated) as dollars_est, sum(TB1.dollars_actual) as dollars_act ",V.local.squery)
F.Intrinsic.String.Concat(V.Local.squery,"FROM V_JOB_HIST_OPS AS TB1 WHERE LMO='M' ",V.global.saddon," group by job, suffix, LMO",V.Local.squery)

F.ODBC.connection!con.OpenRecordsetRW("rsJOBOP",V.local.squery)
F.Intrinsic.Control.DoUntil(V.ODBC.con!rsJOBOP.EOF,=,True)
	F.Intrinsic.String.Concat("UPDATE CON_KPI_JOBS_EST_ACT SET ESTMATERIAL=",V.odbc.con!rsjobop.FIELDVALTRIMPSQL!DOLLARS_EST,", ",V.Local.squery)
	F.Intrinsic.String.Concat(V.local.squery," ACTMATERIAL=",V.ODBC.con!rsJOBOP.FIELDVALTRIMPSQL!DOLLARS_ACT," WHERE JOB='",V.ODBC.con!rsjobop.FIELDVALTRIMPSQL!JOB,"'",V.Local.squery)
	F.Intrinsic.String.Concat(V.Local.squery,"  AND SUFFIX='",V.odbc.con!rsjobop.FIELDVALTRIMPSQL!SUFFIX,"'",V.Local.squery)
	F.ODBC.Connection!con.Execute(V.Local.squery)
	F.ODBC.con!rsJOBOP.MoveNext
F.Intrinsic.Control.Loop
F.ODBC.con!rsJOBOP.Close

'Then Outside Processes
V.Local.squery.Set("")
F.Intrinsic.String.Concat("SELECT TB1.job, TB1.suffix,  LMO, sum(TB1.hours_estimated) as hours_estimated, sum(TB1.hours_actual) as hours_actual,","",V.Local.squery)
F.Intrinsic.String.Concat(V.Local.squery,"sum(TB1.dollars_estimated) as dollars_est, sum(TB1.dollars_actual) as dollars_act ",V.local.squery)
F.Intrinsic.String.Concat(V.Local.squery,"FROM V_JOB_HIST_OPS AS TB1 WHERE LMO='O'  and (tb1.hours_estimated<>0 or tb1.hours_actual<>0 or tb1.dollars_estimated<>0 or tb1.dollars_actual<>0) ",V.global.saddon," group by job, suffix, LMO",V.Local.squery)

F.ODBC.connection!con.OpenRecordsetRW("rsJOBOP",V.local.squery)
F.Intrinsic.Control.DoUntil(V.ODBC.con!rsJOBOP.EOF,=,True)
	F.Intrinsic.String.Concat("UPDATE CON_KPI_JOBS_EST_ACT SET ESTOUTSIDE=",V.odbc.con!rsjobop.FIELDVALTRIMPSQL!DOLLARS_EST,", ",V.Local.squery)
	F.Intrinsic.String.Concat(V.local.squery," ACTOUTSIDE=",V.ODBC.con!rsJOBOP.FIELDVALTRIMPSQL!DOLLARS_ACT," WHERE JOB='",V.ODBC.con!rsjobop.FIELDVALTRIMPSQL!JOB,"'",V.Local.squery)
	F.Intrinsic.String.Concat(V.Local.squery,"  AND SUFFIX='",V.odbc.con!rsjobop.FIELDVALTRIMPSQL!SUFFIX,"'",V.Local.squery)
	F.ODBC.Connection!con.Execute(V.Local.squery)
	F.ODBC.con!rsJOBOP.MoveNext
F.Intrinsic.Control.Loop
F.ODBC.con!rsJOBOP.Close

Program.Sub.z_sub_routine_jobsHist.End

Program.Sub.calcQuotes2.Start
V.Local.ssql.Declare(String)
F.Intrinsic.String.Concat("","",V.Local.ssql)
V.Local.ltemp.Declare(Long)


'CON_KPI_RU_33
F.Intrinsic.Control.Try
	F.ODBC.connection!con.Execute("DELETE FROM CON_KPI_RU_33")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_33(RU_YEAR,RU_MONTH,ACTUAL,ESTIMATE)","",V.local.ssql)
	F.intrinsiC.String.concat(V.local.ssql,"SELECT If(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year_int+1,year_int) as FY,MONTH_INT, ",V.local.ssql)
	F.intrinsic.string.concat(V.local.ssql,"SUM(IFNULL(ACTMATERIAL,0)+IFNULL(ACTOUTSIDE,0)+IFNULL(ACTLABOUR,0)), ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SUM(IFNULL(ESTMATERIAL,0)+IFNULL(ESTOUTSIDE,0)+IFNULL(ESTLABOUR,0)) ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_JOBS_EST_ACT GROUP BY MONTH_INT,FY",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_33 SET PERCENTAGE=(IF(ACTUAL=0,0,IF(ESTIMATE=0,0,(ACTUAL/ESTIMATE)*100)))")
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_33 SET MONTH_CHAR=LEFT(MONTHNAME(CONCAT(CONCAT('1900-',RU_MONTH),'-1')),3)")
	F.ODBC.Connection!CON.OpenRecordsetRW("rsU","SELECT * FROM CON_KPI_RU_33")
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsU.EOF,=,True)
		F.Intrinsic.String.Concat("SELECT PERIOD FROM V_CON_KPI_CALENDAR WHERE MONTH(BEG_DATE)=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!ru_month," AND START_YEAR=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!RU_YEAR," AND PERIOD<>'13' ",V.LOCAL.ssql)
		F.ODBC.connection!con.ExecuteANDReturn(V.Local.ssql,V.Local.ltemp)
		F.ODBC.con!rsU.Set!PERIOD(V.Local.ltemp)
		F.ODBC.con!rsU.MoveNext
	F.Intrinsic.Control.Loop
	F.ODBC.con!rsu.Close
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_33 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_34
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_34")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_34(RU_YEAR,RU_MONTH,ACTUAL,ESTIMATE)","",V.local.ssql)
	F.intrinsiC.String.concat(V.local.ssql,"SELECT RU_YEAR,'0',SUM(ACTUAL),SUM(ESTIMATE) ",V.local.ssql)
	F.intrinsic.string.concat(V.local.ssql,"FROM CON_KPI_RU_33 ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"WHERE RU_YEAR=",V.global.lprevyear," ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"GROUP BY RU_YEAR",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_34 SET PERCENTAGE=(IF(ACTUAL=0,0,IF(ESTIMATE=0,0,(ACTUAL/ESTIMATE)*100)))")
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_34 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_35
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_35")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_35(RU_YEAR,RU_MONTH,ACTUAL,ESTIMATE)","",V.local.ssql)
	F.intrinsiC.String.concat(V.local.ssql,"SELECT RU_YEAR,'0',SUM(ACTUAL),SUM(ESTIMATE) ",V.local.ssql)
	F.intrinsic.string.concat(V.local.ssql,"FROM CON_KPI_RU_33 ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"WHERE RU_YEAR=",V.global.lcurryear," ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"GROUP BY RU_YEAR",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_35 SET PERCENTAGE=(IF(ACTUAL=0,0,IF(ESTIMATE=0,0,(ACTUAL/ESTIMATE)*100)))")
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_35 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_36
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_36")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_36(RU_YEAR,RU_MONTH,ACTUAL,ESTIMATE)","",V.local.ssql)
	F.intrinsiC.String.concat(V.local.ssql,"SELECT If(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year_int+1,year_int) as FY,MONTH_INT, ",V.local.ssql)
	F.intrinsic.string.concat(V.local.ssql,"SUM(IFNULL(ACTLABOUR,0)), ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SUM(IFNULL(ESTLABOUR,0)) ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_JOBS_EST_ACT GROUP BY MONTH_INT,FY",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_36 SET MONTH_CHAR=LEFT(MONTHNAME(CONCAT(CONCAT('1900-',RU_MONTH),'-1')),3)")
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_36 SET PERCENTAGE=(IF(ACTUAL=0,0,IF(ESTIMATE=0,0,(ACTUAL/ESTIMATE)*100)))")
	F.ODBC.Connection!CON.OpenRecordsetRW("rsU","SELECT * FROM CON_KPI_RU_36")
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsU.EOF,=,True)
		F.Intrinsic.String.Concat("SELECT PERIOD FROM V_CON_KPI_CALENDAR WHERE MONTH(BEG_DATE)=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!ru_month," AND START_YEAR=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!RU_YEAR," AND PERIOD<>'13' ",V.LOCAL.ssql)
		F.ODBC.connection!con.ExecuteANDReturn(V.Local.ssql,V.Local.ltemp)
		F.ODBC.con!rsU.Set!PERIOD(V.Local.ltemp)
		F.ODBC.con!rsU.MoveNext
	F.Intrinsic.Control.Loop
	F.ODBC.con!rsu.Close
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_36 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_37
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_37")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_37(RU_YEAR,RU_MONTH,ACTUAL,ESTIMATE)","",V.local.ssql)
	F.intrinsiC.String.concat(V.local.ssql,"SELECT If(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year_int+1,year_int) as FY,MONTH_INT, ",V.local.ssql)
	F.intrinsic.string.concat(V.local.ssql,"SUM(IFNULL(ACTMATERIAL,0)), ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SUM(IFNULL(ESTMATERIAL,0)) ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_JOBS_EST_ACT GROUP BY MONTH_INT,FY",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_37 SET MONTH_CHAR=LEFT(MONTHNAME(CONCAT(CONCAT('1900-',RU_MONTH),'-1')),3)")
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_37 SET PERCENTAGE=(IF(ACTUAL=0,0,IF(ESTIMATE=0,0,(ACTUAL/ESTIMATE)*100)))")
	F.ODBC.Connection!CON.OpenRecordsetRW("rsU","SELECT * FROM CON_KPI_RU_37")
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsU.EOF,=,True)
		F.Intrinsic.String.Concat("SELECT PERIOD FROM V_CON_KPI_CALENDAR WHERE MONTH(BEG_DATE)=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!ru_month," AND START_YEAR=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!RU_YEAR," AND PERIOD<>'13' ",V.LOCAL.ssql)
		F.ODBC.connection!con.ExecuteANDReturn(V.Local.ssql,V.Local.ltemp)
		F.ODBC.con!rsU.Set!PERIOD(V.Local.ltemp)
		F.ODBC.con!rsU.MoveNext
	F.Intrinsic.Control.Loop
	F.ODBC.con!rsu.Close
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_37 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

F.Intrinsic.String.Build("{0} -- Quotes Calculation 2 Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)


Program.Sub.calcQuotes2.End

Program.Sub.calcSales.Start
V.Local.sReturn.Declare(String)
V.Local.fReturn.Declare(Float)
V.Local.fReturn2.Declare(Float)
V.Local.fTempSales.Declare(Float)
V.Local.fTempBudget.Declare(Float)
V.Local.fTempPercent.Declare(Float)
V.Local.fTempNumb.Declare(Float)
V.Local.ssql.Declare(String)
V.Local.ltemp.Declare(Long)


'Check if there are sales, if not, exit sub
V.Local.ssql.Set("select ifnull(sum(sales),0) from con_kpi_sales ")
F.ODBC.Connection!CON.ExecuteAndReturn(v.Local.ssql,v.Local.fReturn)
F.Intrinsic.Control.If(V.Local.fReturn,=,0)
	F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.ENDIF

'Open Sales Orders by Customer
F.ODBC.connection!con.execute("DELETE FROM CON_KPI_RU_01")
F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_01(TOTAL_SALES,CUSTOMER_NAME) SELECT ROUND(SUM(SALES),2), NAME FROM CON_KPI_SALES WHERE OPENHIST='OPEN' GROUP BY NAME","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.local.ssql)



'Open Sales Orders by Month/Year
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_02")
F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_02(RU_YEAR,RU_MONTH,OPEN_ORDER_TOTAL,OPEN_ORDER_LINES) SELECT if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) AS FY,MONTH_INT,ROUND(SUM(SALES),2),COUNT(MONTH_INT) FROM CON_KPI_SALES WHERE OPENHIST='OPEN' GROUP BY MONTH_INT,FY",V.Local.ssql)
F.ODBC.Connection!con.execute(V.local.ssql)
F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_02 SET MONTH_CHAR=LEFT(MONTHNAME(CONCAT(CONCAT('1900-',RU_MONTH),'-1')),3)")
F.ODBC.Connection!CON.OpenRecordsetRW("rsU","SELECT * FROM CON_KPI_RU_02")
F.Intrinsic.Control.DoUntil(V.ODBC.con!rsU.EOF,=,True)
	F.Intrinsic.String.Concat("SELECT PERIOD FROM V_CON_KPI_CALENDAR WHERE MONTH(BEG_DATE)=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!ru_month," AND START_YEAR=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!RU_YEAR," AND PERIOD<>'13' ",V.LOCAL.ssql)
	F.ODBC.connection!con.ExecuteANDReturn(V.Local.ssql,V.Local.ltemp)
	F.ODBC.con!rsU.Set!PERIOD(V.Local.ltemp)
	F.ODBC.con!rsU.MoveNext
F.Intrinsic.Control.Loop
F.ODBC.con!rsU.Close

'Percent of Budget by Month,Year
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_03")
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_TEMP")
F.ODBC.Connection!con.Execute("INSERT INTO CON_KPI_RU_TEMP (FIGURE1,CUSTOMER) SELECT DISTINCT BUDGET, CUSTOMER FROM CON_KPI_SALES GROUP BY CUSTOMER ORDER BY CUSTOMER")
F.ODBC.Connection!con.ExecuteAndReturn("SELECT SUM(FIGURE1) FROM CON_KPI_RU_TEMP",V.Local.fReturn)
F.Intrinsic.Math.Div(V.Local.fReturn,12,V.Local.fReturn)
F.intrinsic.string.concat("INSERT INTO CON_KPI_RU_03(RU_YEAR,RU_MONTH,SALES,BUDGET,PER_OF_BUDGET) select if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year),MONTH_INT,ROUND(SUM(SALES),2) AS SALES,",V.local.freturn,", IF(",V.local.freturn,"=0,0,IF(SUM(SALES)=0,0,ROUND((SUM(SALES)/",V.local.freturn,"*100),2))) from CON_KPI_SALES where OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8'  GROUP BY MONTH_INT,YEAR",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_03 SET MONTH_CHAR=LEFT(MONTHNAME(CONCAT(CONCAT('1900-',RU_MONTH),'-1')),3)")
F.Intrinsic.Math.Mult(V.Local.fReturn,12,V.Local.fReturn)
F.ODBC.Connection!CON.OpenRecordsetRW("rsU","SELECT * FROM CON_KPI_RU_03")
F.Intrinsic.Control.DoUntil(V.ODBC.con!rsU.EOF,=,True)
	F.Intrinsic.String.Concat("SELECT PERIOD FROM V_CON_KPI_CALENDAR WHERE MONTH(BEG_DATE)=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!ru_month," AND START_YEAR=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!RU_YEAR," AND PERIOD<>'13' ",V.LOCAL.ssql)
	F.ODBC.connection!con.ExecuteANDReturn(V.Local.ssql,V.Local.ltemp)
	F.ODBC.con!rsU.Set!PERIOD(V.Local.ltemp)
	F.ODBC.con!rsU.MoveNext
F.Intrinsic.Control.Loop
F.ODBC.con!rsU.Close

'Set Current and Previous year

'Percent of Budget Previous year
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_04")
'ACCOMODATE FOR 0 PREVIOUS YEAR SALES
V.Local.fReturnPrev.Declare(Float)
F.Intrinsic.String.Build("SELECT IFNULL(SUM(SALES),0) FROM CON_KPI_RU_03 WHERE RU_YEAR='{0}'",V.Global.lPrevYear,V.Local.ssql)
F.ODBC.connection!con.ExecuteAndReturn(v.Local.ssql,v.Local.fReturn)
F.Intrinsic.Control.If(V.Local.fReturn,=,0)
	
	F.Intrinsic.String.Build("{0} -- Error in script {1}{2}Sub: {3}{2}Error: Previous Year Data not found for Percent Budget, inserting temporary value of zero.",V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	
	F.intrinsic.string.concat("INSERT INTO CON_KPI_RU_04(RU_YEAR,RU_MONTH,SALES,BUDGET,PER_OF_BUDGET) VALUES (",V.Global.lPrevYear,",0,0,0,0)",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.local.ssql)
F.Intrinsic.Control.Else
	F.intrinsic.string.concat("INSERT INTO CON_KPI_RU_04(RU_YEAR,RU_MONTH,SALES,BUDGET,PER_OF_BUDGET) select if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) as FY,MONTH_INT,ROUND(SUM(SALES),2) AS SALES,",V.Local.fReturn,",IF(",V.local.freturn,"=0,0,IF(SUM(SALES)=0,0,ROUND((SUM(SALES)/",V.local.freturn,"*100),2))) from CON_KPI_SALES WHERE OPENHIST='HIST' AND FY=",V.global.lprevyear," GROUP BY MONTH_INT,YEAR",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.local.ssql)
	F.Intrinsic.STRING.concat("SELECT SUM(SALES),",V.Local.freturn,",IF(SUM(SALES)=0,0,IF(",V.local.freturn,"=0,0,ROUND(SUM(SALES)/",V.Local.fReturn,",2)*100)) FROM CON_KPI_RU_04",V.Local.ssql)
	F.ODBC.Connection!con.ExecuteAndReturn(V.Local.ssql,V.Local.sReturn)
	F.Intrinsic.String.Split(V.Local.sReturn,"*!*",V.Local.sReturn)
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_04")
	F.intrinsic.String.concat("INSERT INTO CON_KPI_RU_04(RU_YEAR,RU_MONTH,SALES,BUDGET,PER_OF_BUDGET) VALUES (",V.global.lPrevYear,",0,",V.Local.sReturn(0),",",V.Local.sReturn(1),",",V.Local.sReturn(2),")",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.EndIf


'Percent of Budget Current year
'ACCOMODATE FOR 0 CURRENT YEAR SALES
F.Intrinsic.String.Build("SELECT IFNULL(SUM(SALES),0) FROM CON_KPI_RU_03 WHERE RU_YEAR='{0}'",V.Global.lCurrYear,V.Local.ssql)
F.ODBC.connection!con.ExecuteAndReturn(v.Local.ssql,v.Local.fReturn)
F.Intrinsic.Control.If(V.Local.fReturn,=,0)
	F.intrinsic.string.concat("INSERT INTO CON_KPI_RU_05(RU_YEAR,RU_MONTH,SALES,BUDGET,PER_OF_BUDGET) VALUES (",V.Global.lCurrYear,",0,0,0,0)",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.local.ssql)
F.Intrinsic.Control.Else
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_05")
	F.intrinsic.string.concat("INSERT INTO CON_KPI_RU_05(RU_YEAR,RU_MONTH,SALES,BUDGET,PER_OF_BUDGET) select if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) as FY,MONTH_INT,ROUND(SUM(SALES),2) AS SALES,",V.local.freturn,", IF(",V.local.freturn,"=0,0,IF(SUM(SALES)=0,0,IF(SUM(BUDGET)=0,0, ROUND((SUM(SALES)/SUM(BUDGET) *100),2)))) from CON_KPI_SALES WHERE OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8'  AND FY=",V.global.lcurryear," GROUP BY MONTH_INT,YEAR",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.local.ssql)
	F.Intrinsic.String.Concat("SELECT SUM(SALES),",V.Local.fReturn,",IF(SUM(SALES)=0,0,IF(",V.local.freturn,"=0,0,ROUND(SUM(SALES)/",V.Local.fReturn,",2)*100)) FROM CON_KPI_RU_05",V.Local.SSQL)
	F.ODBC.Connection!con.ExecuteAndReturn(V.Local.ssql,V.Local.sReturn)
	F.Intrinsic.String.Split(V.Local.sReturn,"*!*",V.Local.sReturn)
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_05")
	F.intrinsic.String.concat("INSERT INTO CON_KPI_RU_05(RU_YEAR,RU_MONTH,SALES,BUDGET,PER_OF_BUDGET) VALUES (",V.global.lCurrYear,",0,",V.Local.sReturn(0),",",V.Local.sReturn(1),",",V.Local.sReturn(2),")",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.EndIf

'GM Percent by Month, Year
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_06")
F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_06(RU_YEAR,RU_MONTH,GM_PERCENT) SELECT if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) as FY,MONTH_INT,IF(SUM(SALES)=0,0,IF(SUM(COST)=0,0,ROUND((SUM(SALES)-SUM(COST))/SUM(SALES)*100,2))) FROM CON_KPI_SALES WHERE OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8'  GROUP BY MONTH_INT,FY","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_06 SET MONTH_CHAR=LEFT(MONTHNAME(CONCAT(CONCAT('1900-',RU_MONTH),'-1')),3)")
F.ODBC.Connection!CON.OpenRecordsetRW("rsU","SELECT * FROM CON_KPI_RU_06")
F.Intrinsic.Control.DoUntil(V.ODBC.con!rsU.EOF,=,True)
	F.Intrinsic.String.Concat("SELECT PERIOD FROM V_CON_KPI_CALENDAR WHERE MONTH(BEG_DATE)=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!ru_month," AND START_YEAR=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!RU_YEAR," AND PERIOD<>'13' ",V.LOCAL.ssql)
	F.ODBC.connection!con.ExecuteANDReturn(V.Local.ssql,V.Local.ltemp)
	F.ODBC.con!rsU.Set!PERIOD(V.Local.ltemp)
	F.ODBC.con!rsU.MoveNext
F.Intrinsic.Control.Loop
F.ODBC.con!rsU.Close

'GM Percent Previous Year
'ACCOMODATE FOR 0 PREVIOUS YEAR SALES
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_07")
F.Intrinsic.String.Build("SELECT IFNULL(SUM(SALES),0) FROM CON_KPI_RU_03 WHERE RU_YEAR='{0}'",V.Global.lPrevYear,V.Local.ssql)
F.ODBC.connection!con.ExecuteAndReturn(v.Local.ssql,v.Local.fReturn)
F.Intrinsic.Control.If(V.Local.fReturn,=,0)
	
	F.Intrinsic.String.Build("{0} -- Error in script {1}{2}Sub: {3}{2}Error: Previous Year Data not found for GM Percent, inserting temporary value of zero.",V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	
	F.intrinsic.string.concat("INSERT INTO CON_KPI_RU_07(RU_YEAR,RU_MONTH,GM_PERCENT,SALES,COST) VALUES (",V.Global.lPrevYear,",0,0,0,0)",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.local.ssql)
F.Intrinsic.Control.Else
	F.Intrinsic.STRING.Concat("INSERT INTO CON_KPI_RU_07(RU_YEAR,RU_MONTH,GM_PERCENT,SALES,COST) SELECT if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) as FY,MONTH_INT,IF(SUM(SALES)=0,0,IF(SUM(COST)=0,0,(SUM(SALES)/SUM(COST))*100)),SUM(SALES),SUM(COST) FROM CON_KPI_SALES WHERE FY=",V.global.lprevyear," AND OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8'  group by month_int,year ",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.ExecuteAndReturn("SELECT SUM(SALES),SUM(COST),IF(SUM(SALES)=0,0,IF(SUM(COST)=0,0,ROUND((SUM(SALES)-SUM(COST))/SUM(SALES),2)*100)) FROM CON_KPI_RU_07",V.Local.sReturn)
	F.Intrinsic.String.Split(V.Local.sReturn,"*!*",V.Local.sReturn)
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_07")
	F.intrinsic.String.concat("INSERT INTO CON_KPI_RU_07(RU_YEAR,RU_MONTH,SALES,COST,GM_PERCENT) VALUES (",V.global.lprevyear,",0,",V.Local.sReturn(0),",",V.Local.sReturn(1),",",V.Local.sReturn(2),")",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.EndIf


'GM Percent Current Year
'ACCOMODATE FOR 0 CURRENT YEAR SALES
F.Intrinsic.String.Build("SELECT IFNULL(SUM(SALES),0) FROM CON_KPI_RU_03 WHERE RU_YEAR='{0}'",V.Global.lCurrYear,V.Local.ssql)
F.ODBC.connection!con.ExecuteAndReturn(v.Local.ssql,v.Local.fReturn)
F.Intrinsic.Control.If(V.Local.fReturn,=,0)
	
	F.Intrinsic.String.Build("{0} -- Error in script {1}{2}Sub: {3}{2}Error: Current Year Data not found for GM Percent Current Year, inserting temporary value of zero.",V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	
	F.intrinsic.string.concat("INSERT INTO CON_KPI_RU_08(RU_YEAR,RU_MONTH,GM_PERCENT,SALES,COST) VALUES (",V.Global.lCurrYear,",0,0,0,0)",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.local.ssql)
F.Intrinsic.Control.Else
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_08")
	F.Intrinsic.STRING.Concat("INSERT INTO CON_KPI_RU_08(RU_YEAR,RU_MONTH,GM_PERCENT,SALES,COST) SELECT if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) as FY,MONTH_INT,IF(SUM(SALES)=0,0,IF(SUM(COST)=0,0,(SUM(SALES)/SUM(COST))*100)),SUM(SALES),SUM(COST) FROM CON_KPI_SALES WHERE FY=",V.global.lcurryear," AND OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8'  group by month_int,year ",V.Local.sSQL)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.ExecuteAndReturn("SELECT SUM(SALES),SUM(COST),IF(SUM(SALES)=0,0,IF(SUM(COST)=0,0,ROUND((SUM(SALES)-SUM(COST))/SUM(SALES),2)*100)) FROM CON_KPI_RU_08",V.Local.sReturn)
	F.Intrinsic.String.Split(V.Local.sReturn,"*!*",V.Local.sReturn)
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_08")
	F.intrinsic.String.concat("INSERT INTO CON_KPI_RU_08(RU_YEAR,RU_MONTH,SALES,COST,GM_PERCENT) VALUES (",V.global.lCurrYear,",0,",V.Local.sReturn(0),",",V.Local.sReturn(1),",",V.Local.sReturn(2),")",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.EndIf

'SIC Sales by code..Order of exeuction is different
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_09")
F.INTRINSIC.String.Concat("INSERT INTO CON_KPI_RU_09 (RU_YEAR,RU_MONTH,SIC_CODE,SALES) SELECT if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) as FY, MONTH_INT, INDUSTRY_CODE,SUM(SALES) FROM CON_KPI_SALES WHERE OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8'  GROUP BY MONTH_INT,YEAR,INDUSTRY_CODE",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
'SIC Sales Previous Year
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_10")
F.Intrinsic.Control.If(V.Local.fReturnPrev,=,0)
	
	F.Intrinsic.String.Build("{0} -- Error in script {1}{2}Sub: {3}{2}Error: Previous Year Data not found for SIC Sales by Code, inserting temporary value of zero.",V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	
	F.intrinsic.string.concat("INSERT INTO CON_KPI_RU_10(RU_YEAR,SALES,SIC_CODE) VALUES (",V.Global.lPrevYear,",0,0)",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.local.ssql)
F.Intrinsic.Control.Else
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_10 (RU_YEAR,SALES,SIC_CODE) SELECT RU_YEAR,SUM(SALES),SIC_CODE FROM CON_KPI_RU_09 WHERE RU_YEAR=",V.global.lprevyear," GROUP BY RU_YEAR,SIC_CODE","",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.EndIf

'SIC Sales Current Year
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_11")
F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_11 (RU_YEAR,SALES,SIC_CODE) SELECT RU_YEAR,SUM(SALES),SIC_CODE FROM CON_KPI_RU_09 WHERE RU_YEAR=",V.global.lcurryear," GROUP BY RU_YEAR,SIC_CODE","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)

'SIC Code All Time
F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_09 (RU_YEAR,RU_MONTH,SALES,SIC_CODE) SELECT RU_YEAR,'0',SUM(SALES),SIC_CODE FROM CON_KPI_RU_09 GROUP BY RU_YEAR,SIC_CODE","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.String.Concat("DELETE FROM CON_KPI_RU_09 WHERE RU_MONTH<>0","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)

'Top 5 Customers
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_12")
F.Intrinsic.String.Concat("SELECT NAME, SUM(SALES) AS TSALES, if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) AS FY ","",V.Local.ssql)
F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_SALES WHERE OPENHIST='HIST' AND FY='",V.global.lcurryear,"' AND LEFT(ORDER_LINE,1)<>'8'  GROUP BY FY, NAME ORDER BY TSALES DESC;",V.Local.ssql)
F.ODBC.Connection!CON.OpenRecordsetRW("rsTop5",V.Local.ssql)

V.Local.lTopCount.Declare(Long)
V.Local.lTopCount.Set(0)
V.Local.sname.Declare(String)
F.Intrinsic.Control.DoUntil(V.ODBC.con!rsTop5.EOF,=,True)
	F.Intrinsic.Control.If(V.Local.lTopCount,<,5)
		F.Intrinsic.String.Replace(V.ODBC.con!rsTop5.FIELDVALTRIMPSQL!NAME,"'","",V.Local.sname)
		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_12(CUSTOMER_NAME, SALES, RU_YEAR) VALUES ('",V.Local.sname,"',",V.ODBC.con!rsTop5.FIELDVALTRIMPSQL!TSALES,",'",V.ODBC.con!rsTop5.FIELDVALTRIMPSQL!FY,"')",V.LOCAL.ssql)
		F.ODBC.Connection!CON.Execute(V.Local.ssql)
		F.Intrinsic.Math.Add(V.local.lTopCount,1,V.Local.lTopCount)
	F.Intrinsic.Control.EndIf
	F.ODBC.con!rsTop5.MoveNext
F.Intrinsic.Control.Loop
F.ODBC.con!rsTop5.Close

F.Intrinsic.String.Concat("SELECT NAME, SUM(SALES) AS TSALES, if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) AS FY ","",V.Local.ssql)
F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_SALES WHERE OPENHIST='HIST' AND FY='",V.global.lprevyear,"' AND LEFT(ORDER_LINE,1)<>'8' GROUP BY FY, NAME ORDER BY TSALES DESC;",V.Local.ssql)
F.ODBC.Connection!CON.OpenRecordsetRW("rsTop5",V.Local.ssql)

V.Local.lTopCount.Set(0)
F.Intrinsic.Control.DoUntil(V.ODBC.con!rsTop5.EOF,=,True)
	F.Intrinsic.Control.If(V.Local.lTopCount,<,5)
		F.Intrinsic.String.Replace(V.ODBC.con!rsTop5.FIELDVALTRIMPSQL!NAME,"'","",V.Local.sname)
		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_12(CUSTOMER_NAME, SALES, RU_YEAR) VALUES ('",V.local.sname,"',",V.ODBC.con!rsTop5.FIELDVALTRIMPSQL!TSALES,",'",V.ODBC.con!rsTop5.FIELDVALTRIMPSQL!FY,"')",V.LOCAL.ssql)
		F.ODBC.Connection!CON.Execute(V.Local.ssql)
		F.Intrinsic.Math.Add(V.local.lTopCount,1,V.Local.lTopCount)
	F.Intrinsic.Control.EndIf
	F.ODBC.con!rsTop5.MoveNext
F.Intrinsic.Control.Loop
F.ODBC.con!rsTop5.Close

'Sales by Salesman
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_13")
F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_13 (SALES,SALESMAN,RU_YEAR) select SUM(SALES),SALESMAN,if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) AS FY from CON_KPI_SALES WHERE OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8' group by FY, Salesman","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)

'Average Sale per Invoice
F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_14(RU_YEAR,RU_MONTH,AVG_SALES_INV,AVG_SALES_UNIT) select if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) AS FY, MONTH_INT, if(SUM(SALES)=0,0,if(COUNT(ORDER_NO)=0,0,sum(sales)/COUNT(ORDER_NO))) AS AVGINV, if(SUM(SALES)=0,0,IF(SUM(QTY)=0,0,sum(sales)/SUM(QTY))) AS AVGUNIT from CON_KPI_SALES where OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8'  group by FY,month_int","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_14 SET MONTH_CHAR=LEFT(MONTHNAME(CONCAT(CONCAT('1900-',RU_MONTH),'-1')),3)")
F.ODBC.Connection!CON.OpenRecordsetRW("rsU","SELECT * FROM CON_KPI_RU_14")
F.Intrinsic.Control.DoUntil(V.ODBC.con!rsU.EOF,=,True)
	F.Intrinsic.String.Concat("SELECT PERIOD FROM V_CON_KPI_CALENDAR WHERE MONTH(BEG_DATE)=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!ru_month," AND START_YEAR=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!RU_YEAR," AND PERIOD<>'13' ",V.LOCAL.ssql)
	F.ODBC.connection!con.ExecuteANDReturn(V.Local.ssql,V.Local.ltemp)
	F.ODBC.con!rsU.Set!PERIOD(V.Local.ltemp)
	F.ODBC.con!rsU.MoveNext
F.Intrinsic.Control.Loop
F.ODBC.con!rsU.Close

'Average Saleper Invoice prior year
F.Intrinsic.String.Build("SELECT IFNULL(SUM(SALES),0) FROM CON_KPI_RU_03 WHERE RU_YEAR='{0}'",V.Global.lPrevYear,V.Local.ssql)
F.ODBC.connection!con.ExecuteAndReturn(v.Local.ssql,v.Local.fReturn)
F.Intrinsic.Control.If(V.Local.fReturn,=,0)
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_15")
	
	F.Intrinsic.String.Build("{0} -- Error in script {1}{2}Sub: {3}{2}Error: Previous Year Data not found for Average Sales per Invoice, inserting temporary value of zero.",V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)

	F.intrinsic.string.concat("INSERT INTO CON_KPI_RU_15(RU_YEAR,RU_MONTH,AVG_SALES_INV,AVG_SALES_UNIT) VALUES (",V.Global.lPrevYear,",0,0,0)",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.local.ssql)
F.Intrinsic.Control.Else
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_15")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_15(RU_YEAR,RU_MONTH,AVG_SALES_INV,AVG_SALES_UNIT) SELECT if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) as FY, MONTH_INT, if(SUM(SALES)=0,0,if(COUNT(ORDER_NO)=0,0,sum(sales)/COUNT(ORDER_NO))),if(SUM(SALES)=0,0,IF(SUM(QTY)=0,0,sum(sales)/SUM(QTY))) FROM CON_KPI_SALES WHERE OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8'  AND FY=",V.global.lPrevYear," GROUP BY YEAR,MONTH_INT",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.Intrinsic.String.Concat("SELECT SUM(AVG_SALES_INV)/COUNT(RU_YEAR), SUM(AVG_SALES_UNIT)/COUNT(RU_YEAR),RU_YEAR FROM CON_KPI_RU_15 WHERE RU_YEAR=",V.global.lPrevYear," GROUP BY RU_YEAR","",V.Local.sSQL)
	F.ODBC.Connection!con.ExecuteAndReturn(V.Local.ssql,V.Local.sReturn)
	F.Intrinsic.String.Split(V.Local.sReturn,"*!*",V.Local.fReturn)
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_15")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_15 (RU_YEAR,RU_MONTH,AVG_SALES_INV,AVG_SALES_UNIT) VALUES (",V.global.lPrevYear,",0,",V.Local.fReturn(0),",",V.Local.fReturn(1),")",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.intrinsic.Control.EndIf

'Average Sale per Invoice current year
F.Intrinsic.String.Build("SELECT IFNULL(SUM(SALES),0) FROM CON_KPI_RU_03 WHERE RU_YEAR='{0}'",V.Global.lCurrYear,V.Local.ssql)
F.ODBC.connection!con.ExecuteAndReturn(v.Local.ssql,v.Local.fReturn)
F.Intrinsic.Control.If(V.Local.fReturn,=,0)
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_16")
	
	F.Intrinsic.String.Build("{0} -- Error in script {1}{2}Sub: {3}{2}Error: Current Year Data not found for Average Sale per Invoice, inserting temporary value of zero.",V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	
	F.intrinsic.string.concat("INSERT INTO CON_KPI_RU_16(RU_YEAR,RU_MONTH,AVG_SALES_INV,AVG_SALES_UNIT) VALUES (",V.Global.lCurrYear,",0,0,0)",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.local.ssql)
F.Intrinsic.Control.Else
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_16")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_16(RU_YEAR,RU_MONTH,AVG_SALES_INV,AVG_SALES_UNIT) SELECT if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) as FY, MONTH_INT, if(SUM(SALES)=0,0,if(COUNT(ORDER_NO)=0,0,sum(sales)/COUNT(ORDER_NO))),if(SUM(SALES)=0,0,IF(SUM(QTY)=0,0,sum(sales)/SUM(QTY))) FROM CON_KPI_SALES where FY=",V.global.lCurrYear," GROUP BY YEAR,MONTH_INT",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.Intrinsic.String.Concat("SELECT SUM(AVG_SALES_INV)/COUNT(RU_YEAR), SUM(AVG_SALES_UNIT)/COUNT(RU_YEAR),RU_YEAR FROM CON_KPI_RU_16 WHERE RU_YEAR=",V.global.lCurrYear," GROUP BY RU_YEAR","",V.Local.sSQL)
	F.ODBC.Connection!con.ExecuteAndReturn(V.Local.ssql,V.Local.sReturn)
	F.Intrinsic.String.Split(V.Local.sReturn,"*!*",V.Local.fReturn)
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_16")
	F.Intrinsic.Control.If(V.Local.fReturn.Trim,<>,"")
		F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_16 (RU_YEAR,RU_MONTH,AVG_SALES_INV,AVG_SALES_UNIT) VALUES (",V.global.lCurrYear,",0,",V.Local.fReturn(0),",",V.Local.fReturn(1),")",V.Local.ssql)
	F.Intrinsic.Control.EndIf
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.EndIf

'Product Line Sales
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_17")
F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_17(PRODUCT_LINE,SALES, RU_YEAR) SELECT PRODUCT_LINE, SUM(SALES),if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) AS FY FROM CON_KPI_SALES WHERE OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8' GROUP BY FY,PRODUCT_LINE","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.STRING.Concat("UPDATE CON_KPI_RU_17 SET GM_PERCENT=(SELECT AVG(GM_PERCENT) FROM CON_KPI_SALES WHERE if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year)=CON_KPI_RU_17.RU_YEAR AND PRODUCT_LINE=CON_KPI_RU_17.PRODUCT_LINE AND OPENHIST='HIST')","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)

'TOP 10 CUSTOMER BUDGET %
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_18")
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_TEMP")
F.intrinsic.String.Concat("INSERT INTO CON_KPI_RU_TEMP (FIGURE1,CUSTOMER) SELECT DISTINCT BUDGET, CUSTOMER FROM CON_KPI_SALES WHERE CATEGORY='TOP10' AND OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8' GROUP BY CUSTOMER ORDER BY CUSTOMER","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.ODBC.Connection!con.ExecuteAndReturn("SELECT ifnull(SUM(FIGURE1),0) FROM CON_KPI_RU_TEMP ",V.Local.fReturn)
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_TEMP")
F.intrinsic.String.Concat("INSERT INTO CON_KPI_RU_TEMP (FIGURE1,FIGURE2,FIGURE3) SELECT (if(",V.local.freturn,"=0,0,(SUM(SALES)/",V.Local.fReturn,")*100)),",V.local.freturn,",if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) AS FY FROM CON_KPI_SALES WHERE CATEGORY='TOP10' AND OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8'  GROUP BY FY",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.intrinsic.String.concat("INSERT INTO CON_KPI_RU_18 (CATEGORY,BUDGET,RU_YEAR) SELECT 'TOP10',FIGURE1,FIGURE3 FROM CON_KPI_RU_TEMP","",V.LOCAL.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_18 SET BUDGET_BELOW=IF(100-BUDGET<0,0,100-BUDGET)")

'RISING STAR CUSTOMER BUDGET %
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_19")
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_TEMP")
F.intrinsic.String.Concat("INSERT INTO CON_KPI_RU_TEMP (FIGURE1,CUSTOMER) SELECT DISTINCT BUDGET, CUSTOMER FROM CON_KPI_SALES WHERE CATEGORY='RISING STAR' AND OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8' GROUP BY CUSTOMER ORDER BY CUSTOMER","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.ODBC.Connection!con.ExecuteAndReturn("SELECT ifnull(SUM(FIGURE1),0) FROM CON_KPI_RU_TEMP ",V.Local.fReturn)
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_TEMP")
F.intrinsic.String.Concat("INSERT INTO CON_KPI_RU_TEMP (FIGURE1,FIGURE2,FIGURE3) SELECT (IF(",V.local.freturn,"=0,0,(SUM(SALES)/",V.Local.fReturn,")*100)), ",V.local.freturn,", if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) AS FY FROM CON_KPI_SALES WHERE CATEGORY='RISING STAR' AND OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8'  GROUP BY FY ",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.intrinsic.String.concat("INSERT INTO CON_KPI_RU_19 (CATEGORY,BUDGET,RU_YEAR) SELECT 'RISING STAR',FIGURE1,FIGURE3 FROM CON_KPI_RU_TEMP","",V.LOCAL.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_19 SET BUDGET_BELOW=IF(100-BUDGET<0,0,100-BUDGET)")

'TARGET CUSTOMER BUDGET %
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_20")
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_TEMP")
F.intrinsic.String.Concat("INSERT INTO CON_KPI_RU_TEMP (FIGURE1,CUSTOMER) SELECT DISTINCT BUDGET, CUSTOMER FROM CON_KPI_SALES WHERE CATEGORY='TARGET' AND OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8' GROUP BY CUSTOMER ORDER BY CUSTOMER","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.ODBC.Connection!con.ExecuteAndReturn("SELECT ifnull(SUM(FIGURE1),0) FROM CON_KPI_RU_TEMP ",V.Local.fReturn)
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_TEMP")
F.intrinsic.String.Concat("INSERT INTO CON_KPI_RU_TEMP (FIGURE1,FIGURE2,FIGURE3) SELECT (IF(",V.local.freturn,"=0,0,(SUM(SALES)/",V.Local.fReturn,")*100)), ",V.local.freturn,", if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) AS FY FROM CON_KPI_SALES WHERE CATEGORY='TARGET' AND OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8'  GROUP BY FY ",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.intrinsic.String.concat("INSERT INTO CON_KPI_RU_20 (CATEGORY,BUDGET,RU_YEAR) SELECT 'TARGET',FIGURE1,FIGURE3 FROM CON_KPI_RU_TEMP","",V.LOCAL.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_20 SET BUDGET_BELOW=IF(100-BUDGET<0,0,100-BUDGET)")

'OTHER CUSTOMER BUDGET %
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_21")
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_TEMP")
F.intrinsic.String.Concat("INSERT INTO CON_KPI_RU_TEMP (FIGURE1,CUSTOMER) SELECT DISTINCT BUDGET, CUSTOMER FROM CON_KPI_SALES WHERE CATEGORY='OTHER' AND OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8' GROUP BY CUSTOMER ORDER BY CUSTOMER","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.ODBC.Connection!con.ExecuteAndReturn("SELECT ifnull(SUM(FIGURE1),0) FROM CON_KPI_RU_TEMP ",V.Local.fReturn)
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_TEMP")
F.intrinsic.String.Concat("INSERT INTO CON_KPI_RU_TEMP (FIGURE1,FIGURE2,FIGURE3) SELECT (IF(",V.local.freturn,"=0,0,(SUM(SALES)/",V.Local.fReturn,")*100)), ",V.local.freturn,", if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) AS FY FROM CON_KPI_SALES WHERE CATEGORY='OTHER' AND OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8'  GROUP BY FY ",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.intrinsic.String.concat("INSERT INTO CON_KPI_RU_21 (CATEGORY,BUDGET,RU_YEAR) SELECT 'OTHER',FIGURE1,FIGURE3 FROM CON_KPI_RU_TEMP","",V.LOCAL.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_21 SET BUDGET_BELOW=IF(100-BUDGET<0,0,100-BUDGET)")

'CUSTOMER SALES HISTORY FOR LAST 5 YEARS
V.Local.lyear.Declare(Long)
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_22")
F.ODBC.Connection!con.Execute("INSERT INTO CON_KPI_RU_22 (CUSTOMER_NAME,CUSTOMER) SELECT NAME_CUSTOMER,CUSTOMER FROM V_CUSTOMER_MASTER")
F.Intrinsic.String.Concat("UPDATE CON_KPI_RU_22 SET YEAR1=(SELECT SUM(SALES) FROM CON_KPI_SALES WHERE if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) =",V.global.LCURRYEAR," AND CON_KPI_RU_22.CUSTOMER = CON_KPI_SALES.CUSTOMER AND OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8' )","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Math.Sub(V.global.lCurrYear,1,V.Local.lyear)
F.Intrinsic.String.Concat("UPDATE CON_KPI_RU_22 SET YEAR2=(SELECT SUM(SALES) FROM CON_KPI_SALES WHERE if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) =",V.local.LYEAR," AND CON_KPI_RU_22.CUSTOMER = CON_KPI_SALES.CUSTOMER AND OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8' )","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Math.Sub(V.Local.LYEAR,1,V.Local.lyear)
F.Intrinsic.String.Concat("UPDATE CON_KPI_RU_22 SET YEAR3=(SELECT SUM(SALES) FROM CON_KPI_SALES WHERE if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) =",V.local.LYEAR," AND CON_KPI_RU_22.CUSTOMER = CON_KPI_SALES.CUSTOMER AND OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8' )","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Math.Sub(V.Local.LYEAR,1,V.Local.lyear)
F.Intrinsic.String.Concat("UPDATE CON_KPI_RU_22 SET YEAR4=(SELECT SUM(SALES) FROM CON_KPI_SALES WHERE if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) =",V.local.LYEAR," AND CON_KPI_RU_22.CUSTOMER = CON_KPI_SALES.CUSTOMER AND OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8' )","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Math.Sub(V.Local.LYEAR,1,V.Local.lyear)
F.Intrinsic.String.Concat("UPDATE CON_KPI_RU_22 SET YEAR5=(SELECT SUM(SALES) FROM CON_KPI_SALES WHERE if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) =",V.local.LYEAR," AND CON_KPI_RU_22.CUSTOMER = CON_KPI_SALES.CUSTOMER AND OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8' )","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_TEMP")

'CUSTOMER HIST & OPEN
F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_23")
F.INTRINSIC.STRING.CONCAT("INSERT INTO CON_KPI_RU_23 (CUSTOMER,RU_YEAR) SELECT DISTINCT CUSTOMER,if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) AS FY FROM CON_KPI_SALES GROUP BY FY, CUSTOMER","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_23 SET CUSTOMER_NAME=(SELECT NAME_CUSTOMER FROM V_CUSTOMER_MASTER WHERE CUSTOMER=CON_KPI_RU_23.CUSTOMER)")
F.Intrinsic.String.Concat("UPDATE CON_KPI_RU_23 SET HIST=(SELECT SUM(SALES) FROM CON_KPI_SALES WHERE OPENHIST='HIST' AND LEFT(ORDER_LINE,1)<>'8' AND CON_KPI_RU_23.CUSTOMER=CON_KPI_SALES.CUSTOMER AND CON_KPI_RU_23.RU_YEAR=if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) )","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.String.Concat("UPDATE CON_KPI_RU_23 SET OPENA=(SELECT SUM(SALES) FROM CON_KPI_SALES WHERE OPENHIST='OPEN' AND CON_KPI_RU_23.CUSTOMER=CON_KPI_SALES.CUSTOMER AND CON_KPI_RU_23.RU_YEAR=if(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year+1,year) )","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.String.Concat("UPDATE CON_KPI_RU_23 SET GRAND_TOTAL=(ifnull(OPENA,0)+ifnull(HIST,0))","",V.Local.ssql)
F.ODBC.Connection!con.Execute(V.Local.ssql)

F.Intrinsic.String.Build("{0} -- Sales Calculation Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)




Program.Sub.calcSales.End

Program.Sub.calcQuality.Start
V.Local.ssql.Declare(String)
F.Intrinsic.String.Concat("","",V.Local.ssql)
V.Local.ltemp.Declare(Long)

'CON_KPI_RU_38
F.Intrinsic.Control.Try
	F.ODBC.connection!con.Execute("DELETE FROM CON_KPI_RU_38")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_38(RU_YEAR,RU_MONTH,COST)","",V.local.ssql)
	F.intrinsiC.String.concat(V.local.ssql,"SELECT If(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year_int+1,year_int) as FY,MONTH_INT, ",V.local.ssql)
	F.intrinsic.string.concat(V.local.ssql,"SUM(IFNULL(DOLLARS,0)) ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_QUALITY GROUP BY MONTH_INT,FY",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_38 SET MONTH_CHAR=LEFT(MONTHNAME(CONCAT(CONCAT('1900-',RU_MONTH),'-1')),3)")
	F.ODBC.Connection!CON.OpenRecordsetRW("rsU","SELECT * FROM CON_KPI_RU_38")
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsU.EOF,=,True)
		F.Intrinsic.String.Concat("SELECT PERIOD FROM V_CON_KPI_CALENDAR WHERE MONTH(BEG_DATE)=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!ru_month," AND START_YEAR=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!RU_YEAR," AND PERIOD<>'13' ",V.LOCAL.ssql)
		F.ODBC.connection!con.ExecuteANDReturn(V.Local.ssql,V.Local.ltemp)
		F.ODBC.con!rsU.Set!PERIOD(V.Local.ltemp)
		F.ODBC.con!rsU.MoveNext
	F.Intrinsic.Control.Loop
	F.ODBC.con!rsU.Close
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_38 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_39
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_39")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_39(RU_YEAR,RU_MONTH,SALES)","",V.local.ssql)
	F.intrinsiC.String.concat(V.local.ssql,"SELECT RU_YEAR, RU_MONTH, SALES ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_RU_03 ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.Intrinsic.String.Concat("UPDATE CON_KPI_RU_39 SET REWORK=(SELECT COST FROM CON_KPI_RU_38 WHERE ","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.local.SSQL,"CON_KPI_RU_39.RU_MONTH=CON_KPI_RU_38.RU_MONTH AND CON_KPI_RU_39.RU_YEAR=CON_KPI_RU_38.RU_YEAR)","",V.local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.Intrinsic.String.Concat("UPDATE CON_KPI_RU_39 SET RW_PERCENT_SALES=(REWORK/SALES)*100 ","",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_39 SET MONTH_CHAR=LEFT(MONTHNAME(CONCAT(CONCAT('1900-',RU_MONTH),'-1')),3)")
	F.ODBC.Connection!CON.OpenRecordsetRW("rsU","SELECT * FROM CON_KPI_RU_39")
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsU.EOF,=,True)
		F.Intrinsic.String.Concat("SELECT PERIOD FROM V_CON_KPI_CALENDAR WHERE MONTH(BEG_DATE)=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!ru_month," AND START_YEAR=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!RU_YEAR," AND PERIOD<>'13' ",V.LOCAL.ssql)
		F.ODBC.connection!con.ExecuteANDReturn(V.Local.ssql,V.Local.ltemp)
		F.ODBC.con!rsU.Set!PERIOD(V.Local.ltemp)
		F.ODBC.con!rsU.MoveNext
	F.Intrinsic.Control.Loop
	F.ODBC.con!rsU.Close
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_39 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_40
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_40")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_40(RU_YEAR,RU_MONTH,RW_PERCENT_SALES)","",V.local.ssql)
	F.intrinsiC.String.concat(V.local.ssql,"SELECT RU_YEAR, '0', (SUM(REWORK)/SUM(SALES))*100 ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_RU_39 WHERE RU_YEAR=",V.global.lprevyear," GROUP BY RU_YEAR ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_40 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_41
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_41")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_41(RU_YEAR,RU_MONTH,RW_PERCENT_SALES)","",V.local.ssql)
	F.intrinsiC.String.concat(V.local.ssql,"SELECT RU_YEAR, '0', (SUM(REWORK)/SUM(SALES))*100 ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_RU_39 WHERE RU_YEAR=",V.global.lcurryear," GROUP BY RU_YEAR ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_41 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_42
F.Intrinsic.Control.Try
	F.ODBC.connection!con.Execute("DELETE FROM CON_KPI_RU_42")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_42(RU_YEAR,RU_MONTH,CODE,COST,QUANTITY)","",V.local.ssql)
	F.intrinsiC.String.concat(V.local.ssql,"SELECT If(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year_int+1,year_int) as FY,MONTH_INT, ",V.local.ssql)
	F.intrinsic.string.concat(V.local.ssql,"SCRAPCODE, SUM(IFNULL(DOLLARS,0)),SUM(IFNULL(QUANTITY,0)) ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_QUALITY GROUP BY FY,MONTH_INT, SCRAPCODE",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_42 SET MONTH_CHAR=LEFT(MONTHNAME(CONCAT(CONCAT('1900-',RU_MONTH),'-1')),3)")
	F.ODBC.Connection!CON.OpenRecordsetRW("rsU","SELECT * FROM CON_KPI_RU_42")
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsU.EOF,=,True)
		F.Intrinsic.String.Concat("SELECT PERIOD FROM V_CON_KPI_CALENDAR WHERE MONTH(BEG_DATE)=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!ru_month," AND START_YEAR=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!RU_YEAR," AND PERIOD<>'13' ",V.LOCAL.ssql)
		F.ODBC.connection!con.ExecuteANDReturn(V.Local.ssql,V.Local.ltemp)
		F.ODBC.con!rsU.Set!PERIOD(V.Local.ltemp)
		F.ODBC.con!rsU.MoveNext
	F.Intrinsic.Control.Loop
	F.ODBC.con!rsU.Close
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_42 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_43
F.Intrinsic.Control.Try
	F.ODBC.connection!con.Execute("DELETE FROM CON_KPI_RU_43")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_43(RU_YEAR,RU_MONTH,COST)","",V.local.ssql)
	F.intrinsiC.String.concat(V.local.ssql,"SELECT RU_YEAR,'0', ",V.local.ssql)
	F.intrinsic.string.concat(V.local.ssql,"SUM(COST) ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_RU_42 WHERE RU_YEAR=",V.global.lprevyear," GROUP BY RU_YEAR",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_43 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_44
F.Intrinsic.Control.Try
	F.ODBC.connection!con.Execute("DELETE FROM CON_KPI_RU_44")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_44(RU_YEAR,RU_MONTH,COST)","",V.local.ssql)
	F.intrinsiC.String.concat(V.local.ssql,"SELECT RU_YEAR,'0', ",V.local.ssql)
	F.intrinsic.string.concat(V.local.ssql,"SUM(COST) ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_RU_42 WHERE RU_YEAR=",V.global.lcurryear," GROUP BY RU_YEAR",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_44 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_45
F.Intrinsic.Control.Try
	F.ODBC.connection!con.Execute("DELETE FROM CON_KPI_RU_45")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_45(RU_YEAR,RU_MONTH,DEPT,COST)","",V.local.ssql)
	F.intrinsiC.String.concat(V.local.ssql,"SELECT If(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year_int+1,year_int) as FY,MONTH_INT, ",V.local.ssql)
	F.intrinsic.string.concat(V.local.ssql,"EMPLOYEEDEPT, SUM(IFNULL(DOLLARS,0)) ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_QUALITY GROUP BY FY,MONTH_INT,EMPLOYEEDEPT",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_45 SET MONTH_CHAR=LEFT(MONTHNAME(CONCAT(CONCAT('1900-',RU_MONTH),'-1')),3)")
	F.ODBC.Connection!CON.OpenRecordsetRW("rsU","SELECT * FROM CON_KPI_RU_45")
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsU.EOF,=,True)
		F.Intrinsic.String.Concat("SELECT PERIOD FROM V_CON_KPI_CALENDAR WHERE MONTH(BEG_DATE)=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!ru_month," AND START_YEAR=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!RU_YEAR," AND PERIOD<>'13' ",V.LOCAL.ssql)
		F.ODBC.connection!con.ExecuteANDReturn(V.Local.ssql,V.Local.ltemp)
		F.ODBC.con!rsU.Set!PERIOD(V.Local.ltemp)
		F.ODBC.con!rsU.MoveNext
	F.Intrinsic.Control.Loop
	F.ODBC.con!rsU.Close
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_45 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_46
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_46")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_46 (RU_YEAR,RU_MONTH,RMA_COUNT)","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT If(MONTH(DATE_RECEIVED)>=",V.global.lmonth," and ",V.global.lmonth,"<>1,YEAR(DATE_RECEIVED)+1,YEAR(DATE_RECEIVED)) as FY, ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"MONTH(DATE_RECEIVED) AS MONTH_INT, COUNT(RMA_ID) ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM V_RMA_LINES GROUP BY FY, MONTH_INT",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_46 (RU_YEAR,RU_MONTH,RMA_COUNT)","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT If(MONTH(DATE_RECEIVED)>=",V.global.lmonth," and ",V.global.lmonth,"<>1,YEAR(DATE_RECEIVED)+1,YEAR(DATE_RECEIVED)) as FY, ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"MONTH(DATE_RECEIVED) AS MONTH_INT, COUNT(RMA_ID) ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM V_RMA_HIST_LINES GROUP BY FY, MONTH_INT",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_46 SET MONTH_CHAR=LEFT(MONTHNAME(CONCAT(CONCAT('1900-',RU_MONTH),'-1')),3)")
		
	F.ODBC.Connection!CON.OpenRecordsetRW("rsU","SELECT * FROM CON_KPI_RU_46")
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsU.EOF,=,True)
		F.Intrinsic.String.Concat("SELECT PERIOD FROM V_CON_KPI_CALENDAR WHERE MONTH(BEG_DATE)=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!ru_month," AND START_YEAR=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!RU_YEAR," AND PERIOD<>'13' ",V.LOCAL.ssql)
		F.ODBC.connection!con.ExecuteANDReturn(V.Local.ssql,V.Local.ltemp)
		F.ODBC.con!rsU.Set!PERIOD(V.Local.ltemp)
		F.ODBC.con!rsU.MoveNext
	F.Intrinsic.Control.Loop
	F.ODBC.con!rsU.Close
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_46 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

F.Intrinsic.String.Build("{0} -- Quality Calculation Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)


Program.Sub.calcQuality.End

Program.Sub.calcQuotes1.Start
V.Local.ssql.Declare(String)
F.Intrinsic.String.Concat("","",V.Local.ssql)
V.Local.ltemp.Declare(Long)

'CON_KPI_RU_24
F.Intrinsic.Control.Try
	F.ODBC.connection!con.Execute("DELETE FROM CON_KPI_RU_24")
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_TEMP")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_TEMP(YEAR_INT,MONTH_INT,FIGURE1,CUSTOMER) ","",V.local.ssql)
	F.intrinsiC.String.concat(V.local.ssql,"SELECT If(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year_int+1,year_int) as FY,MONTH_INT, ",V.local.ssql)
	F.intrinsic.string.concat(V.local.ssql,"COUNT(QUOTENO),CUSTOMER  ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_QUOTES GROUP BY MONTH_INT,YEAR_INT,CUSTOMER ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.Intrinsic.String.Concat("UPDATE CON_KPI_RU_TEMP SET FIGURE2=(SELECT COUNT(QUOTENO)  ","",V.local.ssql)
	F.intrinsiC.String.concat(V.local.ssql,"FROM CON_KPI_QUOTES WHERE WLC='W' ",V.local.ssql)
	F.intrinsic.string.concat(V.local.ssql,"AND MONTH_INT=CON_KPI_RU_TEMP.MONTH_INT ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"AND If(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year_int+1,year_int)=CON_KPI_RU_TEMP.YEAR_INT ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"AND CUSTOMER=CON_KPI_RU_TEMP.CUSTOMER GROUP BY MONTH_INT,YEAR_INT,CUSTOMER) ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.Intrinsic.String.Concat("UPDATE CON_KPI_RU_TEMP SET FIGURE3=(SELECT COUNT(QUOTENO)  ","",V.local.ssql)
	F.intrinsiC.String.concat(V.local.ssql,"FROM CON_KPI_QUOTES WHERE WLC='L' ",V.local.ssql)
	F.intrinsic.string.concat(V.local.ssql,"AND MONTH_INT=CON_KPI_RU_TEMP.MONTH_INT ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"AND If(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year_int+1,year_int)=CON_KPI_RU_TEMP.YEAR_INT ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"AND CUSTOMER=CON_KPI_RU_TEMP.CUSTOMER GROUP BY MONTH_INT,YEAR_INT,CUSTOMER) ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.Intrinsic.String.Concat("UPDATE CON_KPI_RU_TEMP SET FIGURE4=(SELECT COUNT(QUOTENO)  ","",V.local.ssql)
	F.intrinsiC.String.concat(V.local.ssql,"FROM CON_KPI_QUOTES WHERE WLC='C' ",V.local.ssql)
	F.intrinsic.string.concat(V.local.ssql,"AND MONTH_INT=CON_KPI_RU_TEMP.MONTH_INT ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"AND If(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year_int+1,year_int)=CON_KPI_RU_TEMP.YEAR_INT ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"AND CUSTOMER=CON_KPI_RU_TEMP.CUSTOMER GROUP BY MONTH_INT,YEAR_INT,CUSTOMER) ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.Intrinsic.String.Concat("UPDATE CON_KPI_RU_TEMP SET FIGURE5=(SELECT COUNT(QUOTENO)  ","",V.local.ssql)
	F.intrinsiC.String.concat(V.local.ssql,"FROM CON_KPI_QUOTES WHERE WLC='' ",V.local.ssql)
	F.intrinsic.string.concat(V.local.ssql,"AND MONTH_INT=CON_KPI_RU_TEMP.MONTH_INT ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"AND If(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year_int+1,year_int)=CON_KPI_RU_TEMP.YEAR_INT ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"AND CUSTOMER=CON_KPI_RU_TEMP.CUSTOMER GROUP BY MONTH_INT,YEAR_INT,CUSTOMER) ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_24 (RU_YEAR,RU_MONTH,PERCENT_WON,PERCENT_LOSS,PERCENT_CLOSE,PERCENT_OPEN,CUSTOMER)  ","",V.local.ssql)
	F.intrinsiC.String.concat(V.local.ssql,"SELECT YEAR_INT,MONTH_INT,ROUND((FIGURE2/FIGURE1)*100,2),ROUND((FIGURE3/FIGURE1)*100,2),",V.local.ssql)
	F.intrinsic.string.concat(V.local.ssql,"ROUND((FIGURE4/FIGURE1)*100,2),ROUND((FIGURE5/FIGURE1)*100,2),CUSTOMER ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_RU_TEMP ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_24 SET CUSTOMER_NAME=(SELECT NAME_CUSTOMER FROM V_CUSTOMER_MASTER WHERE CUSTOMER=CON_KPI_RU_24.CUSTOMER)")
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_24 SET MONTH_CHAR=LEFT(MONTHNAME(CONCAT(CONCAT('1900-',RU_MONTH),'-1')),3)")
	F.ODBC.Connection!CON.OpenRecordsetRW("rsU","SELECT * FROM CON_KPI_RU_24")
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsU.EOF,=,True)
		F.Intrinsic.String.Concat("SELECT PERIOD FROM V_CON_KPI_CALENDAR WHERE MONTH(BEG_DATE)=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!ru_month," AND START_YEAR=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!RU_YEAR," AND PERIOD<>'13' ",V.LOCAL.ssql)
		F.ODBC.connection!con.ExecuteANDReturn(V.Local.ssql,V.Local.ltemp)
		F.ODBC.con!rsU.Set!PERIOD(V.Local.ltemp)
		F.ODBC.con!rsU.MoveNext
	F.Intrinsic.Control.Loop
	F.ODBC.con!rsU.Close
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_24 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_25
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_25")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_25 (RU_YEAR,RU_MONTH,PERCENT_WON,PERCENT_LOSS,PERCENT_CLOSE,PERCENT_OPEN) ","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT YEAR_INT,'0',ROUND(((SUM(FIGURE2)/SUM(FIGURE1))*100),2),","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"ROUND(((SUM(FIGURE3)/SUM(FIGURE1))*100),2),ROUND(((SUM(FIGURE4)/SUM(FIGURE1))*100),2),","",V.LOCAL.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"ROUND(((SUM(FIGURE5)/SUM(FIGURE1))*100),2) FROM CON_KPI_RU_TEMP WHERE YEAR_INT=",V.global.lprevyear,"",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql," GROUP BY YEAR_INT ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_25 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_26
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_26")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_26 (RU_YEAR,RU_MONTH,PERCENT_WON,PERCENT_LOSS,PERCENT_CLOSE,PERCENT_OPEN) ","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT YEAR_INT,'0',ROUND(((SUM(FIGURE2)/SUM(FIGURE1))*100),2),","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"ROUND(((SUM(FIGURE3)/SUM(FIGURE1))*100),2),ROUND(((SUM(FIGURE4)/SUM(FIGURE1))*100),2),","",V.LOCAL.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"ROUND(((SUM(FIGURE5)/SUM(FIGURE1))*100),2) FROM CON_KPI_RU_TEMP ","",V.local.SSQL)
	F.intrinsic.string.concat(V.local.ssql,"WHERE YEAR_INT=",V.global.lcurryear," GROUP BY YEAR_INT",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_TEMP")
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_26 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_27
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_27")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_27 (RU_YEAR,RU_MONTH,AVERAGE) ","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT If(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year_int+1,year_int), ",V.local.SSQL)
	F.INTRINSIC.STRING.CONCAT(V.local.ssql,"MONTH_INT,ROUND(AVG(DATEDIFF(DAY,DATESUBMITTED,DATEQUOTEDUE)),0) ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_QUOTES GROUP BY MONTH_INT,YEAR_INT ","",V.LOCAL.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!CON.OpenRecordsetRW("rsU","SELECT * FROM CON_KPI_RU_27")
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsU.EOF,=,True)
		F.Intrinsic.String.Concat("SELECT PERIOD FROM V_CON_KPI_CALENDAR WHERE MONTH(BEG_DATE)=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!ru_month," AND START_YEAR=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!RU_YEAR," AND PERIOD<>'13' ",V.LOCAL.ssql)
		F.ODBC.connection!con.ExecuteANDReturn(V.Local.ssql,V.Local.ltemp)
		F.ODBC.con!rsU.Set!PERIOD(V.Local.ltemp)
		F.ODBC.con!rsU.MoveNext
	F.Intrinsic.Control.Loop
	F.ODBC.con!rsU.Close
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_27 SET MONTH_CHAR=LEFT(MONTHNAME(CONCAT(CONCAT('1900-',RU_MONTH),'-1')),3)")
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_27 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_28
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_28")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_28 (RU_YEAR,RU_MONTH,AVERAGE) ","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT RU_YEAR,'0',AVG(AVERAGE) ",V.local.SSQL)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_RU_27 WHERE RU_YEAR=",V.global.lprevyear," GROUP BY RU_YEAR ","",V.LOCAL.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_62 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_29
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_29")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_29 (RU_YEAR,RU_MONTH,AVERAGE) ","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT RU_YEAR,'0',AVG(AVERAGE) ",V.local.SSQL)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_RU_27 WHERE RU_YEAR=",V.global.lcurryear," GROUP BY RU_YEAR ","",V.LOCAL.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_29 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_30
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_30")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_30 (RU_YEAR,RU_MONTH,AVERAGE) ","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT If(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year_int+1,year_int) AS FY, ",V.local.SSQL)
	F.Intrinsic.String.Concat(V.Local.ssql,"MONTH_INT, AVG(MINDOLLAR) ",V.local.SSQL)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_QUOTES GROUP BY MONTH_INT,FY ","",V.LOCAL.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_30 SET MONTH_CHAR=LEFT(MONTHNAME(CONCAT(CONCAT('1900-',RU_MONTH),'-1')),3)")
	F.ODBC.Connection!CON.OpenRecordsetRW("rsU","SELECT * FROM CON_KPI_RU_30")
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsU.EOF,=,True)
		F.Intrinsic.String.Concat("SELECT PERIOD FROM V_CON_KPI_CALENDAR WHERE MONTH(BEG_DATE)=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!ru_month," AND START_YEAR=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!RU_YEAR," AND PERIOD<>'13' ",V.LOCAL.ssql)
		F.ODBC.connection!con.ExecuteANDReturn(V.Local.ssql,V.Local.ltemp)
		F.ODBC.con!rsU.Set!PERIOD(V.Local.ltemp)
		F.ODBC.con!rsU.MoveNext
	F.Intrinsic.Control.Loop
	F.ODBC.con!rsU.Close
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_30 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_31
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_31")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_31 (RU_YEAR,RU_MONTH,AVERAGE) ","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT RU_Year,'0', AVG(AVERAGE) ",V.local.SSQL)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_RU_30 WHERE RU_YEAR=",V.global.lprevyear," GROUP BY RU_YEAR ","",V.LOCAL.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_31 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_32
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_32")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_32 (RU_YEAR,RU_MONTH,AVERAGE) ","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT RU_YEAR,'0', AVG(AVERAGE) ",V.local.SSQL)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_RU_30 WHERE RU_YEAR=",V.global.lcurryear," GROUP BY RU_YEAR ","",V.LOCAL.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_32 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

F.Intrinsic.String.Build("{0} -- Quotes 1 Calculation Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
Program.Sub.calcQuotes1.End

Program.Sub.calcWC.Start
V.Local.ssql.Declare(String)
V.Local.ltemp.Declare(Long)

'CON_KPI_RU_56
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_56")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_56 (WC,RU_YEAR,RU_MONTH,HOURS_WORKED,HOURS_AVAIL,WC_UTIL)","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT WORKCENTER, If(MONTH_INT>=",V.global.lmonth," and ",V.global.lmonth,"<>1,YEAR_INT+1,YEAR_INT) as FY, ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"MONTH_INT, SUM(HOURS_WORKED),SUM(AVAIL_TIME),IF(SUM(HOURS_WORKED)=0,0,IF(SUM(AVAIL_TIME)=0,0,SUM(HOURS_WORKED)/SUM(AVAIL_TIME))) ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_WCUSE GROUP BY FY, MONTH_INT,WORKCENTER ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_56 SET MONTH_CHAR=LEFT(MONTHNAME(CONCAT(CONCAT('1900-',RU_MONTH),'-1')),3)")
	F.ODBC.Connection!CON.OpenRecordsetRW("rsU","SELECT * FROM CON_KPI_RU_56")
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsU.EOF,=,True)
		F.Intrinsic.String.Concat("SELECT PERIOD FROM V_CON_KPI_CALENDAR WHERE MONTH(BEG_DATE)=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!ru_month," AND START_YEAR=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!RU_YEAR," AND PERIOD<>'13' ",V.LOCAL.ssql)
		F.ODBC.connection!con.ExecuteANDReturn(V.Local.ssql,V.Local.ltemp)
		F.ODBC.con!rsU.Set!PERIOD(V.Local.ltemp)
		F.ODBC.con!rsU.MoveNext
	F.Intrinsic.Control.Loop
	F.ODBC.con!rsU.Close
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_56 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_57
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_57")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_57 (RU_YEAR,WC_UTIL)","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT RU_YEAR, IF(SUM(HOURS_WORKED)=0,0,IF(SUM(HOURS_AVAIL)=0,0,IF(SUM(HOURS_WORKED)=0,0,SUM(hours_worked)/sum(hours_avail)*100))) ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_RU_56 WHERE RU_YEAR=",V.global.lprevyear,V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql," GROUP BY RU_YEAR ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_57 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_58
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_58")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_58 (RU_YEAR,WC_UTIL)","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT RU_YEAR, IF(SUM(HOURS_WORKED)=0,0,IF(SUM(HOURS_AVAIL)=0,0,IF(SUM(HOURS_WORKED)=0,0,SUM(hours_worked)/sum(hours_avail)*100))) ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_RU_56 WHERE RU_YEAR=",V.global.lcurryear,V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql," GROUP BY RU_YEAR ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_58 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_59
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_59")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_59 (RU_YEAR,RU_MONTH,UNITS_PRODUCED,UNITS_SCRAPPED,PERCENT_SCRAP)","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT If(MONTH_INT>=",V.global.lmonth," and ",V.global.lmonth,"<>1,YEAR_INT+1,YEAR_INT) as FY, ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"MONTH_INT, SUM(PIECES_COMPLTD),SUM(PIECES_SCRAP), IF(SUM(PIECES_SCRAP)=0,0,IF(SUM(PIECES_COMPLTD)=0,0,ROUND(SUM(PIECES_SCRAP)/SUM(PIECES_COMPLTD),2))) ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_WCUSE GROUP BY FY,MONTH_INT",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_59 SET MONTH_CHAR=LEFT(MONTHNAME(CONCAT(CONCAT('1900-',RU_MONTH),'-1')),3)")
	F.ODBC.Connection!CON.OpenRecordsetRW("rsU","SELECT * FROM CON_KPI_RU_59")
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsU.EOF,=,True)
		F.Intrinsic.String.Concat("SELECT PERIOD FROM V_CON_KPI_CALENDAR WHERE MONTH(BEG_DATE)=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!ru_month," AND START_YEAR=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!RU_YEAR," AND PERIOD<>'13' ",V.LOCAL.ssql)
		F.ODBC.connection!con.ExecuteANDReturn(V.Local.ssql,V.Local.ltemp)
		F.ODBC.con!rsU.Set!PERIOD(V.Local.ltemp)
		F.ODBC.con!rsU.MoveNext
	F.Intrinsic.Control.Loop
	F.ODBC.con!rsU.Close
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_59 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_60
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_60")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_60 (RU_YEAR,PERCENT_SCRAP)","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT RU_YEAR, ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"IF(SUM(UNITS_SCRAPPED)=0,0,IF(SUM(UNITS_PRODUCED)=0,0,ROUND(SUM(UNITS_SCRAPPED)/SUM(UNITS_PRODUCED),2))) ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_RU_59 WHERE RU_YEAR=",V.global.lprevyear," GROUP BY RU_YEAR",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_60 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_61
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_61")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_61 (RU_YEAR,PERCENT_SCRAP)","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT RU_YEAR, ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"IF(SUM(UNITS_SCRAPPED)=0,0,IF(SUM(UNITS_PRODUCED)=0,0,ROUND(SUM(UNITS_SCRAPPED)/SUM(UNITS_PRODUCED),2))) ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_RU_59 WHERE RU_YEAR=",V.global.lcurryear," GROUP BY RU_YEAR",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_61 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

F.Intrinsic.String.Build("{0} -- WC Calculation Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)


Program.Sub.calcWC.End

Program.Sub.calcProd.Start
V.Local.ssql.Declare(String)
V.Local.ltemp.Declare(Long)

'CON_KPI_RU_65, HOURS ESTIMATED
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_65")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_65(RU_YEAR,RU_MONTH,HOURS_EST)","",V.local.ssql)
	F.intrinsiC.String.concat(V.local.ssql,"SELECT If(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year_int+1,year_int) as FY,MONTH_INT, ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SUM(IFNULL(ESTLABOHHRS,0)) ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_JOBS_EST_ACT GROUP BY MONTH_INT,FY",V.Local.ssql)
	
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_65 SET MONTH_CHAR=LEFT(MONTHNAME(CONCAT(CONCAT('1900-',RU_MONTH),'-1')),3)")
	F.ODBC.Connection!CON.OpenRecordsetRW("rsU","SELECT * FROM CON_KPI_RU_65")
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsU.EOF,=,True)
		F.Intrinsic.String.Concat("SELECT PERIOD FROM V_CON_KPI_CALENDAR WHERE MONTH(BEG_DATE)=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!ru_month," AND START_YEAR=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!RU_YEAR," AND PERIOD<>'13' ",V.LOCAL.ssql)
		F.ODBC.connection!con.ExecuteANDReturn(V.Local.ssql,V.Local.ltemp)
		F.ODBC.con!rsU.Set!PERIOD(V.Local.ltemp)
		F.ODBC.con!rsU.MoveNext
	F.Intrinsic.Control.Loop
	F.ODBC.con!rsU.Close
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_65 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_66, HOURS ACTUAL
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_66")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_66 (RU_YEAR,RU_MONTH,HOURS_ACT)","",V.Local.ssql)
	F.intrinsiC.String.concat(V.local.ssql,"SELECT If(month_int>=",V.global.lmonth," and ",V.global.lmonth,"<>1,year_int+1,year_int) as FY,MONTH_INT, ",V.local.ssql)
	F.intrinsic.string.concat(V.local.ssql,"SUM(IFNULL(ACTLABOHHRS,0)) ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_JOBS_EST_ACT GROUP BY MONTH_INT,FY",V.Local.ssql)
	
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_66 SET MONTH_CHAR=LEFT(MONTHNAME(CONCAT(CONCAT('1900-',RU_MONTH),'-1')),3)")
	F.ODBC.Connection!CON.OpenRecordsetRW("rsU","SELECT * FROM CON_KPI_RU_66")
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsU.EOF,=,True)
		F.Intrinsic.String.Concat("SELECT PERIOD FROM V_CON_KPI_CALENDAR WHERE MONTH(BEG_DATE)=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!ru_month," AND START_YEAR=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!RU_YEAR," AND PERIOD<>'13' ",V.LOCAL.ssql)
		F.ODBC.connection!con.ExecuteANDReturn(V.Local.ssql,V.Local.ltemp)
		F.ODBC.con!rsU.Set!PERIOD(V.Local.ltemp)
		F.ODBC.con!rsU.MoveNext
	F.Intrinsic.Control.Loop
	F.ODBC.con!rsU.Close
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_66 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_67
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_67")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_67 (RU_YEAR,RU_MONTH,HOURS_ACT)","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT RU_YEAR,RU_MONTH,HOURS_ACT ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_RU_66 ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.Intrinsic.String.Concat("UPDATE CON_KPI_RU_67 SET HOURS_EST=(SELECT HOURS_EST FROM CON_KPI_RU_65 WHERE RU_MONTH=CON_KPI_RU_67.RU_MONTH AND RU_YEAR=CON_KPI_RU_67.RU_YEAR)","",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_67 SET PERCENT_OF=IF(HOURS_EST=0,0,(HOURS_ACT/HOURS_EST)*100)")
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_67 SET MONTH_CHAR=LEFT(MONTHNAME(CONCAT(CONCAT('1900-',RU_MONTH),'-1')),3)")
	F.ODBC.Connection!CON.OpenRecordsetRW("rsU","SELECT * FROM CON_KPI_RU_67")
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsU.EOF,=,True)
		F.Intrinsic.String.Concat("SELECT PERIOD FROM V_CON_KPI_CALENDAR WHERE MONTH(BEG_DATE)=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!ru_month," AND START_YEAR=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!RU_YEAR," AND PERIOD<>'13' ",V.LOCAL.ssql)
		F.ODBC.connection!con.ExecuteANDReturn(V.Local.ssql,V.Local.ltemp)
		F.ODBC.con!rsU.Set!PERIOD(V.Local.ltemp)
		F.ODBC.con!rsU.MoveNext
	F.Intrinsic.Control.Loop
	F.ODBC.con!rsU.Close
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_67 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_68, PRIOR YEAR
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_68")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_68 (RU_YEAR,HOURS_ACT)","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT RU_YEAR,SUM(HOURS_ACT) ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_RU_66 WHERE RU_YEAR=",V.global.lprevyear," GROUP BY RU_YEAR ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.Intrinsic.String.Concat("UPDATE CON_KPI_RU_68 SET HOURS_EST=(SELECT SUM(HOURS_EST) FROM CON_KPI_RU_65 WHERE RU_YEAR=",V.Global.lprevyear,")","",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_68 SET PERCENT_OF=IF(HOURS_EST=0,0,(HOURS_ACT/HOURS_EST)*100)")
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_68 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_69, CURRENT YEAR
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_69")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_69 (RU_YEAR,HOURS_ACT)","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT RU_YEAR,SUM(HOURS_ACT) ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_RU_66 WHERE RU_YEAR=",V.global.lcurryear," GROUP BY RU_YEAR",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.Intrinsic.String.Concat("UPDATE CON_KPI_RU_69 SET HOURS_EST=(SELECT SUM(HOURS_EST) FROM CON_KPI_RU_65 WHERE RU_YEAR=",V.Global.lcurryear,")","",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_69 SET PERCENT_OF=IF(HOURS_EST=0,0,(HOURS_ACT/HOURS_EST)*100)")
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_69 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

F.Intrinsic.String.Build("{0} -- Production Calculation Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)

Program.Sub.calcProd.End

Program.Sub.calcOntime.Start
V.Local.ssql.Declare(String)
V.Local.ltemp.Declare(Long)

'CON_KPI_RU_62
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_62")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_62 (RU_YEAR,RU_MONTH,EARLY,ONTIME,LATE,PERCENT_ON_TIME)","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT If(MONTH(DUE_DATE)>=",V.global.lmonth," and ",V.global.lmonth,"<>1,YEAR(DUE_DATE)+1,YEAR(DUE_DATE)) as FY, ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"MONTH(DUE_DATE) AS MTH, SUM(EARLY),SUM(ONTIME),SUM(LATE), ",V.Local.ssql)
	F.iNTRINSIC.String.concat(V.local.ssql,"if((SUM(LATE))=0,100,(SUM(EARLY)+SUM(ONTIME))/(SUM(EARLY)+SUM(ONTIME)+SUM(LATE))*100)",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM v_BI_DASH2 GROUP BY FY, MTH ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_62 SET MONTH_CHAR=LEFT(MONTHNAME(CONCAT(CONCAT('1900-',RU_MONTH),'-1')),3)")
	F.ODBC.Connection!CON.OpenRecordsetRW("rsU","SELECT * FROM CON_KPI_RU_62")
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsU.EOF,=,True)
		F.Intrinsic.String.Concat("SELECT PERIOD FROM V_CON_KPI_CALENDAR WHERE MONTH(BEG_DATE)=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!ru_month," AND START_YEAR=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!RU_YEAR," AND PERIOD<>'13' ",V.LOCAL.ssql)
		F.ODBC.connection!con.ExecuteANDReturn(V.Local.ssql,V.Local.ltemp)
		F.ODBC.con!rsU.Set!PERIOD(V.Local.ltemp)
		F.ODBC.con!rsU.MoveNext
	F.Intrinsic.Control.Loop
	F.ODBC.con!rsU.Close
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_62 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_63
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_63")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_63 (RU_YEAR,PERCENT_ON_TIME)","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT RU_YEAR,AVG(PERCENT_ON_TIME) ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_RU_62 WHERE RU_YEAR=",V.global.lprevyear," GROUP BY RU_YEAR ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_63 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH, V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_64
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_64")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_64 (RU_YEAR,PERCENT_ON_TIME)","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT RU_YEAR,AVG(PERCENT_ON_TIME) ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_RU_62 WHERE RU_YEAR=",V.global.lcurryear," GROUP BY RU_YEAR ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_64 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

F.Intrinsic.String.Build("{0} -- On-Time Calculation Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)

Program.Sub.calcOntime.End

Program.Sub.calcLaborUnit.Start
V.Local.ssql.Declare(String)
V.Local.ltemp.Declare(Long)

'CON_KPI_RU_70
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_70")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_70 (RU_YEAR,RU_MONTH,AVG_COST)","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT If(MONTH(DATE_CLOSED)>=",V.global.lmonth," and ",V.global.lmonth,"<>1,YEAR(DATE_CLOSED)+1,YEAR(DATE_CLOSED)) as FY, ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"MONTH(DATE_CLOSED) AS MONTH_INT, AVG(COST_PER_UNIT) ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_LABORCOST GROUP BY FY, MONTH_INT ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_70 SET MONTH_CHAR=LEFT(MONTHNAME(CONCAT(CONCAT('1900-',RU_MONTH),'-1')),3)")
	F.ODBC.Connection!CON.OpenRecordsetRW("rsU","SELECT * FROM CON_KPI_RU_70")
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsU.EOF,=,True)
		F.Intrinsic.String.Concat("SELECT PERIOD FROM V_CON_KPI_CALENDAR WHERE MONTH(BEG_DATE)=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!ru_month," AND START_YEAR=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!RU_YEAR," AND PERIOD<>'13' ",V.LOCAL.ssql)
		F.ODBC.connection!con.ExecuteANDReturn(V.Local.ssql,V.Local.ltemp)
		F.ODBC.con!rsU.Set!PERIOD(V.Local.ltemp)
		F.ODBC.con!rsU.MoveNext
	F.Intrinsic.Control.Loop
	F.ODBC.con!rsU.Close
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_70 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_71
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_71")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_71 (RU_YEAR,AVG_COST)","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT If(MONTH(DATE_CLOSED)>=",V.global.lmonth," and ",V.global.lmonth,"<>1,YEAR(DATE_CLOSED)+1,YEAR(DATE_CLOSED)) as FY, ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"AVG(COST_PER_UNIT) FROM CON_KPI_LABORCOST WHERE FY=",V.global.lprevyear," GROUP BY FY ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_71 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_72
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_72")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_72 (RU_YEAR,AVG_COST)","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT If(MONTH(DATE_CLOSED)>=",V.global.lmonth," and ",V.global.lmonth,"<>1,YEAR(DATE_CLOSED)+1,YEAR(DATE_CLOSED)) as FY, ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"AVG(COST_PER_UNIT) FROM CON_KPI_LABORCOST WHERE FY=",V.global.lcurryear," GROUP BY FY ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_72 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

F.Intrinsic.String.Build("{0} -- Labor Calculation Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)



Program.Sub.calcLaborUnit.End

Program.Sub.calcP16.Start
V.Local.ssql.Declare(String)
V.Local.ltemp.Declare(Long)

'CON_KPI_RU_73
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_73")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_73 (RU_YEAR,RU_MONTH,TOTAL)","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT If(MONTH(DATE)>=",V.global.lmonth," and ",V.global.lmonth,"<>1,YEAR(DATE)+1,YEAR(DATE)) as FY, ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"MONTH(DATE) AS MONTH_INT, SUM(COST*QTY) ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_INV_HIST GROUP BY FY, MONTH_INT ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_RU_73 SET MONTH_CHAR=LEFT(MONTHNAME(CONCAT(CONCAT('1900-',RU_MONTH),'-1')),3)")
	F.ODBC.Connection!CON.OpenRecordsetRW("rsU","SELECT * FROM CON_KPI_RU_73")
	F.Intrinsic.Control.DoUntil(V.ODBC.con!rsU.EOF,=,True)
		F.Intrinsic.String.Concat("SELECT PERIOD FROM V_CON_KPI_CALENDAR WHERE MONTH(BEG_DATE)=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!ru_month," AND START_YEAR=",V.ODBC.con!rsU.FIELDVALTRIMPSQL!RU_YEAR," AND PERIOD<>'13' ",V.LOCAL.ssql)
		F.ODBC.connection!con.ExecuteANDReturn(V.Local.ssql,V.Local.ltemp)
		F.ODBC.con!rsU.Set!PERIOD(V.Local.ltemp)
		F.ODBC.con!rsU.MoveNext
	F.Intrinsic.Control.Loop
	F.ODBC.con!rsU.Close
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_73 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_74
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_74")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_74 (RU_YEAR,TOTAL)","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT RU_YEAR,SUM(TOTAL) ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_RU_73 WHERE RU_YEAR=",V.global.lprevyear," GROUP BY RU_YEAR ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_74 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_75
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_75")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_75 (RU_YEAR,TOTAL)","",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"SELECT RU_YEAR,SUM(TOTAL) ",V.local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"FROM CON_KPI_RU_73 WHERE RU_YEAR=",V.global.lcurryear," GROUP BY RU_YEAR  ",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_75 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

F.Intrinsic.String.Build("{0} -- P16 Calculation Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)



Program.Sub.calcP16.End

Program.Sub.calcAP.Start
V.Local.ssql.Declare(String)

'CON_KPI_RU_76
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("UPDATE CON_KPI_APOPEN SET DAYS_DUE=NOW()-DATE_INVOICE")
	F.ODBC.connection!con.Execute("UPDATE CON_KPI_APOPEN SET CURRENT_A=IF(DAYS_DUE<30,AMT_INVOICE,0)")
	F.ODBC.connection!con.Execute("UPDATE CON_KPI_APOPEN SET DAYS_30_60=IF(DAYS_DUE>=31 AND DAYS_DUE<=60,AMT_INVOICE,0)")
	F.ODBC.connection!con.Execute("UPDATE CON_KPI_APOPEN SET DAYS_60_90=IF(DAYS_DUE>=61 AND DAYS_DUE<=90,AMT_INVOICE,0)")
	F.ODBC.connection!con.Execute("UPDATE CON_KPI_APOPEN SET DAYS_90_OVER=IF(DAYS_DUE>90,AMT_INVOICE,0)")
	
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_76")
	F.ODBC.Connection!con.Execute("INSERT INTO CON_KPI_RU_76 (CURRENT_A,DAYS_30,DAYS_60,DAYS_90,TOTAL) SELECT SUM(CURRENT_A),SUM(DAYS_30_60),SUM(DAYS_60_90),SUM(DAYS_90_OVER),SUM(AMT_INVOICE) FROM CON_KPI_APOPEN")
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_76 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

'CON_KPI_RU_77
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_77")
	F.Intrinsic.String.Concat("INSERT INTO CON_KPI_RU_77 (VENDOR, NAME_VENDOR_PAY,AMT_YTD_PUR)  ","",V.Local.ssql)
	F.INTRINSIC.STRING.CONCAT(V.local.ssql,"SELECT TOP 5 VENDOR, NAME_VENDOR_PAY,AMT_YTD_PUR FROM V_VENDOR_PAY_TO T1 ",V.local.SSQL)
	F.Intrinsic.String.Concat(V.Local.ssql,"INNER JOIN V_VENDOR_MASTER T2 ON T1.VENDOR = T2.VENDOR ",V.Local.ssql)
	F.Intrinsic.String.Concat(V.Local.ssql,"WHERE locate('NOKPI',UCASE(T2.OTHER),0) <= 0 ",V.Local.ssql)
	F.INTRINSIC.STRING.CONCAT(V.local.ssql,"ORDER BY AMT_YTD_PUR DESC;",V.Local.ssql)
	F.ODBC.Connection!con.Execute(V.Local.ssql)
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_77 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

F.Intrinsic.String.Build("{0} -- AP Calculation Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)


Program.Sub.calcAP.End

Program.Sub.calcAR.Start
V.Local.ssql.Declare(String)

F.ODBC.Connection!con.Execute("UPDATE CON_KPI_AROPEN SET DAYS_DUE=NOW()-DATE_INVOICE")
F.ODBC.connection!con.Execute("UPDATE CON_KPI_AROPEN SET CURRENT_A=IF(DAYS_DUE<30,AMT_INVOICE,0)")
F.ODBC.connection!con.Execute("UPDATE CON_KPI_AROPEN SET DAYS_30_60=IF(DAYS_DUE>=31 AND DAYS_DUE<=60,AMT_INVOICE,0)")
F.ODBC.connection!con.Execute("UPDATE CON_KPI_AROPEN SET DAYS_60_90=IF(DAYS_DUE>=61 AND DAYS_DUE<=90,AMT_INVOICE,0)")
F.ODBC.connection!con.Execute("UPDATE CON_KPI_AROPEN SET DAYS_90_OVER=IF(DAYS_DUE>90,AMT_INVOICE,0)")

'CON_KPI_RU_78
F.Intrinsic.Control.Try
	F.ODBC.Connection!con.Execute("DELETE FROM CON_KPI_RU_78")
	F.ODBC.Connection!con.Execute("INSERT INTO CON_KPI_RU_78 (CURRENT_A,DAYS_30,DAYS_60,DAYS_90,TOTAL) SELECT SUM(CURRENT_A),SUM(DAYS_30_60),SUM(DAYS_60_90),SUM(DAYS_90_OVER),SUM(AMT_INVOICE) FROM CON_KPI_AROPEN")
F.Intrinsic.Control.Catch
	F.Intrinsic.String.Build("{0} -- GAB Error in script {1}{2}Sub: {3}{2}Error: {4}{2}CON_KPI_RU_78 Not Built.", V.Ambient.Now, "CON_KPI_LIBRARY.lib", " ----- ", v.Ambient.CurrentSubroutine, v.Ambient.ErrorDescription, V.Global.sErr)
	F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)
	F.Intrinsic.Control.ClearErrors
F.Intrinsic.Control.EndTry

F.Intrinsic.String.Build("{0} -- AR Calculation Completed.", V.Ambient.Now, V.Global.sErr)
F.Intrinsic.File.Append2FileNewLine(V.Global.SFILEPATH,V.Global.sErr)

Program.Sub.calcAR.End


